{
  "url": "https://api.github.com/repos/shap/shap/issues/2441",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2441/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2441/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2441/events",
  "html_url": "https://github.com/shap/shap/issues/2441",
  "id": 1174131783,
  "node_id": "I_kwDOBHDcK85F-9RH",
  "number": 2441,
  "title": "How to extract information from  ``shap.utils.hclust`` to remove redundant features not only by visual inspection barplot?",
  "user": {
    "login": "julio-luna-nubank",
    "id": 96085806,
    "node_id": "U_kgDOBbonLg",
    "avatar_url": "https://avatars.githubusercontent.com/u/96085806?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/julio-luna-nubank",
    "html_url": "https://github.com/julio-luna-nubank",
    "followers_url": "https://api.github.com/users/julio-luna-nubank/followers",
    "following_url": "https://api.github.com/users/julio-luna-nubank/following{/other_user}",
    "gists_url": "https://api.github.com/users/julio-luna-nubank/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/julio-luna-nubank/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/julio-luna-nubank/subscriptions",
    "organizations_url": "https://api.github.com/users/julio-luna-nubank/orgs",
    "repos_url": "https://api.github.com/users/julio-luna-nubank/repos",
    "events_url": "https://api.github.com/users/julio-luna-nubank/events{/privacy}",
    "received_events_url": "https://api.github.com/users/julio-luna-nubank/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-03-19T01:01:42Z",
  "updated_at": "2022-03-19T14:27:25Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm using ``shap.utils.hclust`` to figure out which features are redundant.\r\n\r\n\r\nReproducible example:\r\n```import pandas as pd\r\nimport numpy as np\r\nimport shap\r\n\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.metrics import roc_auc_score\r\n\r\nfrom lightgbm import LGBMClassifier\r\n\r\ndata = pd.read_csv(\"https://raw.githubusercontent.com/gdmarmerola/random-stuff/master/probability_calibration/UCI_Credit_Card.csv\")\r\n\r\n# getting design matrix and target\r\nX = data.copy().drop(['ID','default.payment.next.month'], axis=1)\r\ny = data.copy()['default.payment.next.month']\r\n\r\nX_train, X_test, y_train, y_test = train_test_split(X,y,test_size = .2, random_state = 42)\r\n\r\nmodel = LGBMClassifier(random_state = 42).fit(X_train, y_train)\r\n\r\n# compute SHAP values\r\nexplainer = shap.Explainer(model, X_test)\r\nshap_values = explainer(X_test)\r\n\r\nclustering = shap.utils.hclust(X_train, y_train) # by default this trains (X.shape[1] choose 2) 2-feature XGBoost models\r\nshap.plots.bar(shap_values, clustering=clustering)\r\n```\r\n1. In the implementation why is [this](https://github.com/slundberg/shap/blob/46b3800b31df04745416da27c71b216f91d61775/shap/utils/_clustering.py#L110) an ``XGBRegressor`` even for classification tasks?\r\n2. Should ``clustering`` be calculated on train or test samples?\r\n3. My ``X_train`` has shape ``(2300,23)`` whereas clustering has ``(22, 4)`` what does the shape of that matrix represent?\r\n4. How can I use ``clustering``to remove redundant features, beyond the bar plot visual inspection?\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2441/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2441/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
