{
  "url": "https://api.github.com/repos/shap/shap/issues/972",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/972/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/972/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/972/events",
  "html_url": "https://github.com/shap/shap/issues/972",
  "id": 542389685,
  "node_id": "MDU6SXNzdWU1NDIzODk2ODU=",
  "number": 972,
  "title": "shap dependence_plot does not work in version 0.33 for lightgbm",
  "user": {
    "login": "bhishanpdl",
    "id": 13811914,
    "node_id": "MDQ6VXNlcjEzODExOTE0",
    "avatar_url": "https://avatars.githubusercontent.com/u/13811914?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bhishanpdl",
    "html_url": "https://github.com/bhishanpdl",
    "followers_url": "https://api.github.com/users/bhishanpdl/followers",
    "following_url": "https://api.github.com/users/bhishanpdl/following{/other_user}",
    "gists_url": "https://api.github.com/users/bhishanpdl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bhishanpdl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bhishanpdl/subscriptions",
    "organizations_url": "https://api.github.com/users/bhishanpdl/orgs",
    "repos_url": "https://api.github.com/users/bhishanpdl/repos",
    "events_url": "https://api.github.com/users/bhishanpdl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bhishanpdl/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-12-25T22:13:37Z",
  "updated_at": "2019-12-27T18:50:08Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I was using shap dependence plot for lightgbm model, but it fails with following error.\r\n\r\n# setup\r\n```python\r\nimport numpy as np\r\nimport pandas as pd\r\nimport seaborn as sns\r\n\r\nimport lightgbm as lgb\r\nimport shap\r\nshap.initjs()\r\n\r\nprint([(x.__name__,x.__version__) for x in [np,pd,lgb,shap]])\r\n[('numpy', '1.16.4'), ('pandas', '0.25.3'), ('lightgbm', '2.1.2.4'), ('shap', '0.33.0')]\r\n```\r\n\r\n# data preparation\r\n```python\r\nimport sklearn\r\nfrom sklearn.model_selection import train_test_split\r\n\r\ndf = sns.load_dataset('titanic')\r\ndf = df[['survived','sex','fare','who']]\r\ndf['sex'] = df['sex'].map({'male': 0, 'female': 1})\r\ndf['who'] = df['who'].map({'man': 0, 'woman': 1, 'child': 3})\r\n\r\ntarget = 'survived'\r\nXtrain,Xtest,ytrain,ytest = train_test_split(df.drop(target,axis=1),\r\n                                            df[target],\r\n                                            stratify=df[target],\r\n                                            random_state=100)\r\n\r\nXtrain.head(2)\r\n```\r\n\r\n# modelling\r\n```python\r\nclf_lgb = lgb.LGBMClassifier()\r\nclf_lgb.fit(Xtrain,ytrain)\r\n```\r\n\r\n# model interpretation using shap\r\n```python\r\nexplainer = shap.TreeExplainer(clf_lgb)\r\nshap_values = explainer.shap_values(Xtest)\r\n\r\nSetting feature_perturbation = \"tree_path_dependent\" because no background data was given.\r\nLightGBM binary classifier with TreeExplainer shap values output has changed to a list of ndarray\r\n\r\nshap_values_arr = np.array(shap_values)\r\n```\r\n\r\n# force plot works\r\n```python\r\nidx = 5\r\nshap.force_plot(explainer.expected_value[1],\r\n                shap_values[1][idx,:],\r\n                Xtest.iloc[idx,:] # this is just for giving feature names\r\n               )\r\n```\r\n\r\n# dependence plot fails\r\n```python\r\nshap.dependence_plot(\"fare\", shap_values, Xtest)\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-21-ea37e74c9d12> in <module>()\r\n----> 1 shap.dependence_plot(\"fare\", shap_values, Xtest)\r\n\r\n~/miniconda3/envs/dataSc/lib/python3.7/site-packages/shap/plots/dependence.py in dependence_plot(ind, shap_values, features, feature_names, display_features, interaction_index, color, axis_color, cmap, dot_size, x_jitter, alpha, title, xmin, xmax, ax, show)\r\n    100 \r\n    101     # allow vectors to be passed\r\n--> 102     if len(shap_values.shape) == 1:\r\n    103         shap_values = np.reshape(shap_values, len(shap_values), 1)\r\n    104     if len(features.shape) == 1:\r\n\r\nAttributeError: 'list' object has no attribute 'shape'\r\n```\r\n\r\n# dependence plot fails \r\n```python\r\nshap.dependence_plot(\"fare\", shap_values_arr, Xtest)\r\n\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-22-886e45af4e87> in <module>()\r\n----> 1 shap.dependence_plot(\"fare\", shap_values_arr, Xtest)\r\n\r\n~/miniconda3/envs/dataSc/lib/python3.7/site-packages/shap/plots/dependence.py in dependence_plot(ind, shap_values, features, feature_names, display_features, interaction_index, color, axis_color, cmap, dot_size, x_jitter, alpha, title, xmin, xmax, ax, show)\r\n    108 \r\n    109     # plotting SHAP interaction values\r\n--> 110     if len(shap_values.shape) == 3 and len(ind) == 2:\r\n    111         ind1 = convert_name(ind[0], shap_values, feature_names)\r\n    112         ind2 = convert_name(ind[1], shap_values, feature_names)\r\n\r\nTypeError: object of type 'numpy.int64' has no len()\r\n```\r\n\r\n**HOW TO FIX THE PROBLEM?**",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/972/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/972/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
