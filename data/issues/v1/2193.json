{
  "url": "https://api.github.com/repos/shap/shap/issues/2193",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2193/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2193/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2193/events",
  "html_url": "https://github.com/shap/shap/issues/2193",
  "id": 1004490131,
  "node_id": "I_kwDOBHDcK847302T",
  "number": 2193,
  "title": "Why is Shap report not giving me a split by class for Binary Classifier?",
  "user": {
    "login": "zahs123",
    "id": 23192374,
    "node_id": "MDQ6VXNlcjIzMTkyMzc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/23192374?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zahs123",
    "html_url": "https://github.com/zahs123",
    "followers_url": "https://api.github.com/users/zahs123/followers",
    "following_url": "https://api.github.com/users/zahs123/following{/other_user}",
    "gists_url": "https://api.github.com/users/zahs123/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zahs123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zahs123/subscriptions",
    "organizations_url": "https://api.github.com/users/zahs123/orgs",
    "repos_url": "https://api.github.com/users/zahs123/repos",
    "events_url": "https://api.github.com/users/zahs123/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zahs123/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-09-22T16:23:06Z",
  "updated_at": "2021-09-22T16:26:33Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have a pipeline object i pickled and below is what it looks like: \r\n\r\n```\r\n    Pipeline(steps=[('preprocessor',\r\n                     ColumnTransformer(transformers=[('num',\r\n                                                      Pipeline(steps=[('imputer',\r\n                                                                   SimpleImputer(fill_value=0)),\r\n                                                                      ('scaler',\r\n                                                                       StandardScaler())]),\r\n                                                      ['amount','sales','costs',....']),\r\n                                                     ('cat',\r\n                                                      OneHotEncoder(handle_unknown='ignore'),\r\n                                                      [\r\n                                                       'country'\r\n                                                       ])])),\r\n                    ('var', VarianceThreshold()),\r\n                    ('sel', SelectKBest(k=60)),\r\n                    ('clf',\r\n                     OneVsRestClassifier(estimator=XGBClassifier(max_depth=3,\r\n                                                             missing=nan,\r\n                                                             n_estimators=800,\r\n                                                             n_jobs=-1,\r\n                                                             random_state=42)]) \r\n```\r\n##### Note the objective for XGBClassifier is set to : objective='binary:logistic' when doing the gridsearch iniitally \r\nWhen i upload this model: \r\n\r\n\r\n\r\n```\r\nwith open('model.pkl', 'rb') as file: \r\n        Pickled_model= pickle.load(file)\r\n\r\n```\r\n\r\n\r\nI would like to build a shap report per model. Since it is oneVsRest i have 4 models for every class (4 classes). I thought i could build a shap report like so: \r\ne.g for class 3\r\n\r\n    model_3 = Pickled_model['clf'].estimators_[3] #this extracts just the xgbclassifier\r\n    explainer = shap.TreeExplainer(model_3)\r\n    shap_values = explainer.shap_values(Pickled_model[:-1].transform(validation_data))\r\n    #get features \r\n    mask = Pickled_model['sel'].get_support(indices=True)\r\n    columns_array = np.array(features)\r\n    features_shap = columns_array[mask]\r\n    data_1 = pd.DataFrame(Pickled_model[:-1].transform(vaidation_data),columns=features_shap)\r\n    shap.summary_plot(shap_values, features=data_1, feature_names=features_shap, class_names=[0,1],plot_type=\"bar\")\r\n\r\n\r\n\r\n\r\n\r\n\r\ni would get a split by class 0 or 1 for this but instead it looks like it is one colour: \r\n![shap](https://user-images.githubusercontent.com/23192374/134383482-b8decc03-b1be-4f94-9e21-db467c023bae.PNG)\r\n\r\ni..e usually i would expect a split by 0 or 1 in these barcharts. Since oneVSrEST trains 4 binary classifiers why is it that when i follow  the above process i get a bar chart from what i am expecting. Am i doing something wrong?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2193/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2193/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
