{
  "url": "https://api.github.com/repos/shap/shap/issues/1741",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1741/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1741/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1741/events",
  "html_url": "https://github.com/shap/shap/issues/1741",
  "id": 785837375,
  "node_id": "MDU6SXNzdWU3ODU4MzczNzU=",
  "number": 1741,
  "title": "tf.Keras and shap.Explainer fail with shap v0.37",
  "user": {
    "login": "juanramonua",
    "id": 14908342,
    "node_id": "MDQ6VXNlcjE0OTA4MzQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/14908342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/juanramonua",
    "html_url": "https://github.com/juanramonua",
    "followers_url": "https://api.github.com/users/juanramonua/followers",
    "following_url": "https://api.github.com/users/juanramonua/following{/other_user}",
    "gists_url": "https://api.github.com/users/juanramonua/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/juanramonua/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/juanramonua/subscriptions",
    "organizations_url": "https://api.github.com/users/juanramonua/orgs",
    "repos_url": "https://api.github.com/users/juanramonua/repos",
    "events_url": "https://api.github.com/users/juanramonua/events{/privacy}",
    "received_events_url": "https://api.github.com/users/juanramonua/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 19,
  "created_at": "2021-01-14T09:41:08Z",
  "updated_at": "2023-04-19T13:24:15Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Is it possible to compute shap values with new shap.Explainer using tf.keras (v2.4.0)? This way you can also use the bar graphs, beeswarm, etc.\r\n\r\nThe code in v0.37 fails and in the last git update shows:\r\n\r\n```python\r\nimport numpy as np\r\nimport pandas as pd\r\nimport tensorflow as tf\r\nfrom tensorflow import keras\r\nfrom tensorflow.keras import layers\r\nimport shap\r\n\r\nn=100\r\n# Data \r\ndata = pd.DataFrame({'var1':np.random.random(n), 'var2':np.random.random(n), 'output':np.random.random(n)})\r\n\r\n# tf.keras model (MLP)\r\ninp = layers.Input(shape=(2,), dtype=tf.float32)\r\nprint('inp',inp.shape)\r\nx = layers.Dense(10)(inp)\r\nprint('output',x.shape)\r\nx = layers.Dense(1)(x)\r\nprint('output',x.shape)\r\n\r\nmodel = keras.models.Model(inputs=inp, outputs=x)\r\nmodel.compile(optimizer='adam',loss='mse')\r\n\r\nmodel.fit(data[['var1','var2']], data['output'], epochs=2, batch_size=8)\r\n\r\nexplainer_new = shap.Explainer(model) # the same error with 'model.predict'\r\nshap_values_new = explainer_new(data[['var1','var2']])\r\n```\r\n\r\nThe output is:\r\n\r\n```\r\ninp (None, 2)\r\noutput (None, 10)\r\noutput (None, 1)\r\nEpoch 1/2\r\n13/13 [==============================] - 0s 2ms/step - loss: 1.8949\r\nEpoch 2/2\r\n13/13 [==============================] - 0s 1ms/step - loss: 1.3625\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-8-ae2850945237> in <module>()\r\n     24 \r\n     25 explainer_new = shap.Explainer(model) # the same error with 'model.predict'\r\n---> 26 shap_values_new = explainer_new(data[['var1','var2']])\r\n\r\n3 frames\r\n/usr/local/lib/python3.6/dist-packages/shap/utils/_masked_model.py in _full_masking_call(self, masks, batch_size)\r\n     85                 masked_inputs = self.masker(delta_ind, *self.args).copy()\r\n     86             else:\r\n---> 87                 masked_inputs = self.masker(mask, *self.args)\r\n     88 \r\n     89             # wrap the masked inputs if they are not already in a tuple\r\n\r\nTypeError: 'NoneType' object is not callable\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1741/reactions",
    "total_count": 25,
    "+1": 19,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 6
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1741/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
