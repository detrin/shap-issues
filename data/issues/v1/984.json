{
  "url": "https://api.github.com/repos/shap/shap/issues/984",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/984/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/984/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/984/events",
  "html_url": "https://github.com/shap/shap/issues/984",
  "id": 545346283,
  "node_id": "MDU6SXNzdWU1NDUzNDYyODM=",
  "number": 984,
  "title": "Tree.Explainer giving different shap values when training xgboost with sparse matrix vs. Pandas DataFrame",
  "user": {
    "login": "dwoodlock",
    "id": 5075821,
    "node_id": "MDQ6VXNlcjUwNzU4MjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5075821?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dwoodlock",
    "html_url": "https://github.com/dwoodlock",
    "followers_url": "https://api.github.com/users/dwoodlock/followers",
    "following_url": "https://api.github.com/users/dwoodlock/following{/other_user}",
    "gists_url": "https://api.github.com/users/dwoodlock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dwoodlock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dwoodlock/subscriptions",
    "organizations_url": "https://api.github.com/users/dwoodlock/orgs",
    "repos_url": "https://api.github.com/users/dwoodlock/repos",
    "events_url": "https://api.github.com/users/dwoodlock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dwoodlock/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-01-04T23:43:03Z",
  "updated_at": "2020-01-05T22:14:56Z",
  "closed_at": "2020-01-05T22:14:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "If I train an XGBoost model with data created from a Pandas DataFrame, I get very different shap_values than when I train the model with the same data as a sparse matrix.  I don't know why and I don't know which is correct.  I would like sparse to work as I'm using the 'out of core' learning feature of xgboost beta which only works from libsvm files (which behave in the manner that sparse matrices do).  \r\n\r\nTo recreate, take your Census Income Classification for XGBoost notebook and change your second code cell to:\r\nX, y = shap.datasets.adult()\r\nX_display, y_display = shap.datasets.adult(display=True)\r\n\r\ncols = X.columns\r\nX = scipy.sparse.csr_matrix(X.values)\r\n\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=7)\r\nd_train = xgboost.DMatrix(X_train, label=y_train, feature_names=cols)\r\nd_test = xgboost.DMatrix(X_test, label=y_test, feature_names=cols) \r\n\r\nYou'll see the features that are important in the summary plot have changed.  Please advise.  \r\nDon\r\n",
  "closed_by": {
    "login": "dwoodlock",
    "id": 5075821,
    "node_id": "MDQ6VXNlcjUwNzU4MjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5075821?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dwoodlock",
    "html_url": "https://github.com/dwoodlock",
    "followers_url": "https://api.github.com/users/dwoodlock/followers",
    "following_url": "https://api.github.com/users/dwoodlock/following{/other_user}",
    "gists_url": "https://api.github.com/users/dwoodlock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dwoodlock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dwoodlock/subscriptions",
    "organizations_url": "https://api.github.com/users/dwoodlock/orgs",
    "repos_url": "https://api.github.com/users/dwoodlock/repos",
    "events_url": "https://api.github.com/users/dwoodlock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dwoodlock/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/984/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/984/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
