{
  "url": "https://api.github.com/repos/shap/shap/issues/147",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/147/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/147/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/147/events",
  "html_url": "https://github.com/shap/shap/issues/147",
  "id": 339722074,
  "node_id": "MDU6SXNzdWUzMzk3MjIwNzQ=",
  "number": 147,
  "title": "Calculating shap values with scikit learn algorithms",
  "user": {
    "login": "GitAnalyst",
    "id": 23650341,
    "node_id": "MDQ6VXNlcjIzNjUwMzQx",
    "avatar_url": "https://avatars.githubusercontent.com/u/23650341?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/GitAnalyst",
    "html_url": "https://github.com/GitAnalyst",
    "followers_url": "https://api.github.com/users/GitAnalyst/followers",
    "following_url": "https://api.github.com/users/GitAnalyst/following{/other_user}",
    "gists_url": "https://api.github.com/users/GitAnalyst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/GitAnalyst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/GitAnalyst/subscriptions",
    "organizations_url": "https://api.github.com/users/GitAnalyst/orgs",
    "repos_url": "https://api.github.com/users/GitAnalyst/repos",
    "events_url": "https://api.github.com/users/GitAnalyst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/GitAnalyst/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-07-10T07:19:33Z",
  "updated_at": "2018-07-11T18:32:54Z",
  "closed_at": "2018-07-11T18:32:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am having a problem to calculate shap values for scikit-learn implementation of XGBoost. Below there is a minimal example where shap values are supposed to be calculated with `TreeExplainer` for `LGBMRegressor` and `XGBRegressor`. But this works only for LightGBM when passing `lgb_model_grid.best_estimator_.booster_` to `TreeExplainer`. In XGBoost case I tried to select different attributes of `xgb_model_grid` but I had no luck in getting shap values.\r\nAlso, has anyone had success in calculating shap values with other scikit-learn algorithms like `GradientBoostingRegressor` or `RandomForestRegressor` and could share examples?\r\n\r\n```\r\nimport pandas as pd\r\nfrom sklearn import datasets\r\nimport lightgbm as lgb\r\nimport xgboost as xgb\r\nfrom sklearn.model_selection import GridSearchCV\r\nimport shap\r\n\r\n# Load dataset\r\nboston = datasets.load_boston()\r\n# Create feature DF\r\nX = pd.DataFrame(data = boston.data, columns = boston['feature_names'])\r\n# Create target DF\r\ny = pd.DataFrame(data = boston.target, columns = ['MEDV'])\r\n\r\n# Train LightGBM\r\nparameters = {}\r\nlgb_model = lgb.LGBMRegressor()\r\nrgr = GridSearchCV(lgb_model, parameters, n_jobs=-1, cv=2, verbose=1)\r\nlgb_model_grid = rgr.fit(X,y.MEDV)\r\n# Calculate SHAP values\r\nprint(\"LightGBM type:\", type(lgb_model_grid.best_estimator_.booster_))\r\nshap.TreeExplainer(lgb_model_grid.best_estimator_.booster_).shap_values(X)\r\n\r\n# Train XGBoost\r\nxgb_model = xgb.XGBRegressor()\r\nrgr = GridSearchCV(xgb_model, parameters, n_jobs=-1, cv=2, verbose=1)\r\nxgb_model_grid = rgr.fit(X,y.MEDV)\r\n# Calculate SHAP values (DOESN'T WORK)\r\nprint(\"XGBoost type:\", type(xgb_model_grid.best_estimator_.booster))\r\nshap.TreeExplainer(xgb_model_grid.best_estimator_.booster).shap_values(X)\r\nprint(\"XGBoost type:\", type(xgb_model_grid.best_estimator_))\r\nshap.TreeExplainer(xgb_model_grid.best_estimator_).shap_values(X)\r\n\r\n```\r\n",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/147/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/147/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
