{
  "url": "https://api.github.com/repos/shap/shap/issues/2124",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2124/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2124/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2124/events",
  "html_url": "https://github.com/shap/shap/issues/2124",
  "id": 961986696,
  "node_id": "MDU6SXNzdWU5NjE5ODY2OTY=",
  "number": 2124,
  "title": "Non-full backward hook with shap.DeepExplainer + PyTorch",
  "user": {
    "login": "mlpotter",
    "id": 35242331,
    "node_id": "MDQ6VXNlcjM1MjQyMzMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35242331?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mlpotter",
    "html_url": "https://github.com/mlpotter",
    "followers_url": "https://api.github.com/users/mlpotter/followers",
    "following_url": "https://api.github.com/users/mlpotter/following{/other_user}",
    "gists_url": "https://api.github.com/users/mlpotter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mlpotter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mlpotter/subscriptions",
    "organizations_url": "https://api.github.com/users/mlpotter/orgs",
    "repos_url": "https://api.github.com/users/mlpotter/repos",
    "events_url": "https://api.github.com/users/mlpotter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mlpotter/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-08-05T16:16:35Z",
  "updated_at": "2023-05-10T20:13:06Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Error: `Using a non-full backward hook when the forward contains multiple autograd Nodes is deprecated and will be removed in future versions. This hook will be missing some grad_input. Please use register_full_backward_hook to get the documented behavior.`\r\n\r\nPyTorch Model: \r\n```\r\nclass aggregation_model(nn.Module):\r\n    def __init__(self,fit_iterations,n_features):\r\n        super(aggregation_model,self).__init__()\r\n        self.models = nn.ModuleDict()\r\n        self.fit_iterations = fit_iterations\r\n        self.n_features = n_features\r\n\r\n        for iter_ in tqdm(np.arange(fit_iterations)):\r\n            model_weights = torch.load(\"model_iterations/model_iteration_cat_{:d}.pt\".format(iter_))\r\n            self.models[\"model_iterations/model_iteration_cat_{:d}\".format(iter_)] = nn.Sequential(nn.Linear(n_features,1),nn.Sigmoid())\r\n            self.models[\"model_iterations/model_iteration_cat_{:d}\".format(iter_)].load_state_dict(model_weights)\r\n\r\n    print(\"Initialized Aggregation Model\")\r\n    def forward(self, x):\r\n        model_iteration_predictions_open = []#torch.zeros((x.shape[0],1),requires_grad=False)\r\n        for iter_ in np.arange(self.fit_iterations):\r\n            model_iteration_predictions_open.append(self.models[\"model_iterations/model_iteration_cat_{:d}\".format(iter_)](x).view(-1,1))\r\n         \r\n        model_iteration_mean = torch.cat(model_iteration_predictions_open,dim=1).mean(1).unsqueeze(1)\r\n        return model_iteration_mean \r\n\r\nmodel = aggregation_model(fit_iterations,27)\r\ne = shap.DeepExplainer(model,X_pytorch)\r\nshap_values = e.shap_values(X_pytorch)\r\n```\r\n\r\nVersions: PyTorch 1.8.0 , Shap 0.39.0\r\n\r\nI have seen similar posts in the closed / open section but no resolution to this issue... Is there a way to rewrite the PyTorch model to avoid this warning? Does this warning mean that it is only using 1 of the models in the nn.Module() function for the shap value calculation? \r\n\r\nAny suggestions would help a lot.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2124/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2124/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
