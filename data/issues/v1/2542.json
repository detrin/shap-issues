{
  "url": "https://api.github.com/repos/shap/shap/issues/2542",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2542/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2542/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2542/events",
  "html_url": "https://github.com/shap/shap/issues/2542",
  "id": 1232739324,
  "node_id": "I_kwDOBHDcK85Jehv8",
  "number": 2542,
  "title": "BUG: predict_parts with type=\"shape_wrapper\" does not work with scikit pipelines",
  "user": {
    "login": "nilslacroix",
    "id": 56065345,
    "node_id": "MDQ6VXNlcjU2MDY1MzQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/56065345?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nilslacroix",
    "html_url": "https://github.com/nilslacroix",
    "followers_url": "https://api.github.com/users/nilslacroix/followers",
    "following_url": "https://api.github.com/users/nilslacroix/following{/other_user}",
    "gists_url": "https://api.github.com/users/nilslacroix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nilslacroix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nilslacroix/subscriptions",
    "organizations_url": "https://api.github.com/users/nilslacroix/orgs",
    "repos_url": "https://api.github.com/users/nilslacroix/repos",
    "events_url": "https://api.github.com/users/nilslacroix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nilslacroix/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-05-11T14:26:34Z",
  "updated_at": "2022-05-11T14:45:18Z",
  "closed_at": "2022-05-11T14:45:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I found a bug or missing feature with scikit pipelines in dalex.\r\n\r\nWhen you try to create an explainer with `predict_parts` and `type=\"shap_wrapper`  like this:\r\n\r\n`sh_mary = exp.predict_parts(mary, type='shap_wrapper', B = 10, label=mary.index[0])`\r\n\r\n\r\nIt causes an error. This bug is reproducible with your titanic example.\r\nI would be thankful for any workaround.  \r\n\r\nThe error message is:\r\n\r\n\r\n```\r\nTypeError                                 Traceback (most recent call last)\r\nInput In [9], in <cell line: 2>()\r\n      1 import shap\r\n----> 2 sh_mary = exp.predict_parts(mary, type='shap_wrapper', B = 10, label=mary.index[0])\r\n\r\nFile ~\\miniconda3\\envs\\Master_ML\\lib\\site-packages\\dalex\\_explainer\\object.py:320, in Explainer.predict_parts(self, new_observation, type, order, interaction_preference, path, N, B, keep_distributions, label, processes, random_state, **kwargs)\r\n    317 else:\r\n    318     raise TypeError(\"Wrong type parameter.\")\r\n--> 320 _predict_parts.fit(self, new_observation, **kwargs)\r\n    322 if label:\r\n    323     _predict_parts.result['label'] = label\r\n\r\nFile ~\\miniconda3\\envs\\Master_ML\\lib\\site-packages\\dalex\\wrappers\\_shap\\object.py:71, in ShapWrapper.fit(self, explainer, new_observation, shap_explainer_type, **kwargs)\r\n     49 \"\"\"Calculate the result of explanation\r\n     50 \r\n     51 Fit method makes calculations in place and changes the attributes.\r\n   (...)\r\n     67 None\r\n     68 \"\"\"\r\n     69 from shap import TreeExplainer, DeepExplainer, GradientExplainer, LinearExplainer, KernelExplainer\r\n---> 71 checks.check_compatibility(explainer)\r\n     72 shap_explainer_type = checks.check_shap_explainer_type(shap_explainer_type, explainer.model)\r\n     74 if self.type == 'predict_parts':\r\n\r\nFile ~\\miniconda3\\envs\\Master_ML\\lib\\site-packages\\dalex\\wrappers\\_shap\\checks.py:48, in check_compatibility(explainer)\r\n     46 if 'arrays_accepted' in explainer.model_info:\r\n     47     if not explainer.model_info['arrays_accepted']:\r\n---> 48         raise TypeError(\"'predict_function' not compatible with the 'shap' package\")\r\n     49 else:\r\n     50     # data was None but now is available\r\n     51     try:\r\n\r\nTypeError: 'predict_function' not compatible with the 'shap' package\r\n```",
  "closed_by": {
    "login": "nilslacroix",
    "id": 56065345,
    "node_id": "MDQ6VXNlcjU2MDY1MzQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/56065345?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nilslacroix",
    "html_url": "https://github.com/nilslacroix",
    "followers_url": "https://api.github.com/users/nilslacroix/followers",
    "following_url": "https://api.github.com/users/nilslacroix/following{/other_user}",
    "gists_url": "https://api.github.com/users/nilslacroix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nilslacroix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nilslacroix/subscriptions",
    "organizations_url": "https://api.github.com/users/nilslacroix/orgs",
    "repos_url": "https://api.github.com/users/nilslacroix/repos",
    "events_url": "https://api.github.com/users/nilslacroix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nilslacroix/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2542/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2542/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
