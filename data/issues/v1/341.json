{
  "url": "https://api.github.com/repos/shap/shap/issues/341",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/341/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/341/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/341/events",
  "html_url": "https://github.com/shap/shap/issues/341",
  "id": 385343463,
  "node_id": "MDU6SXNzdWUzODUzNDM0NjM=",
  "number": 341,
  "title": "using shap_values matrix in ordet to get value impact on target variable ",
  "user": {
    "login": "adishpak",
    "id": 26356831,
    "node_id": "MDQ6VXNlcjI2MzU2ODMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/26356831?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adishpak",
    "html_url": "https://github.com/adishpak",
    "followers_url": "https://api.github.com/users/adishpak/followers",
    "following_url": "https://api.github.com/users/adishpak/following{/other_user}",
    "gists_url": "https://api.github.com/users/adishpak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adishpak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adishpak/subscriptions",
    "organizations_url": "https://api.github.com/users/adishpak/orgs",
    "repos_url": "https://api.github.com/users/adishpak/repos",
    "events_url": "https://api.github.com/users/adishpak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adishpak/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-11-28T16:11:40Z",
  "updated_at": "2018-11-30T04:14:08Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi, \r\nI have been using shap in order to analyze feature importance on a XGB classifier model that predicts CTR rate.\r\nmost of my predicting variables are categorical. and I was wondering if I could use the shap_values matrix in order to find how every category of some variable impact the CTR.\r\n\r\nmy code is: \r\n\r\n```\r\n\r\nparams2 = {'n_estimators': 100,\r\n               'learning_rate': 0.5,\r\n               'seed': 0,\r\n               'subsample': 0.8,\r\n               'n_jobs': 50,\r\n               'colsample_bytree': 0.8,\r\n               'objective': 'binary:logistic',\r\n               'max_depth': 10,\r\n               'min_child_weight': 300,\r\n               'gamma': 2,\r\n               'max_delta_step': 6\r\n               }\r\n\r\nestimator = xgb.XGBClassifier(**params2)\r\nmapper = DataFrameMapper([(i, None) if j != 'object' and j != 'bool' else (i,\r\n                          [CategoricalDomain(\r\n                           missing_value_treatment=\"as_value\",\r\n                           invalid_value_treatment=\"as_missing\",\r\n                           missing_value_replacement=\r\n                           train_x[i].value_counts().idxmax(),\r\n\t\t\t\t\t\t   invalid_value_replacement=\r\n\t\t\t\t\t\t   train_x[i].value_counts().idxmax()),\r\n                           LabelEncoder()])\r\n                           for i, j in zip(train_x.columns.values, train_x.dtypes.values)],\r\n\t\t\t\t\t\t   input_df=True, df_out=True)\r\n\r\npmml_pipeline = PMMLPipeline([(\"mapper\", mapper),(\"classifier\", estimator)])\r\npmml_pipeline.fit(train_x, train_y.as_matrix())\r\ntrain_x_encode = pmml_pipeline.named_steps['mapper'].fit_transform(train_x)\r\nexplainer = shap.TreeExplainer(pmml_pipeline.named_steps['classifier'])\r\nshap_values = explainer.shap_values(train_x_encode)\r\n\r\nshap_values_1 = pd.DataFrame(shap_values)\r\nshap_values_1.columns = train_x.columns\r\n\r\nshap_values_1.columns = ['shap_' + str(col) for col in shap_values_1.columns]\r\ntrain_x.columns = ['vals_' + str(col) for col in train_x.columns]\r\nall_data  = pd.concat([shap_values_1, train_x], axis=1)\r\n\r\ndomains = pd.DataFrame(all_data.groupby(['vals_domain']).agg({'shap_domain':'mean'})).reset_index()\r\n```\r\n\r\nwhen I'm expecting that higher value for each domain means higher impact on CTR .\r\nDoes that make sense ? \r\nThanks  ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/341/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/341/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
