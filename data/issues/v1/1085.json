{
  "url": "https://api.github.com/repos/shap/shap/issues/1085",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1085/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1085/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1085/events",
  "html_url": "https://github.com/shap/shap/issues/1085",
  "id": 576177735,
  "node_id": "MDU6SXNzdWU1NzYxNzc3MzU=",
  "number": 1085,
  "title": "Error using DeepExplainer and KernelExplainer for NN model of TF 2.0",
  "user": {
    "login": "smallfade",
    "id": 34301355,
    "node_id": "MDQ6VXNlcjM0MzAxMzU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/34301355?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smallfade",
    "html_url": "https://github.com/smallfade",
    "followers_url": "https://api.github.com/users/smallfade/followers",
    "following_url": "https://api.github.com/users/smallfade/following{/other_user}",
    "gists_url": "https://api.github.com/users/smallfade/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smallfade/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smallfade/subscriptions",
    "organizations_url": "https://api.github.com/users/smallfade/orgs",
    "repos_url": "https://api.github.com/users/smallfade/repos",
    "events_url": "https://api.github.com/users/smallfade/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smallfade/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2020-03-05T11:15:19Z",
  "updated_at": "2022-11-14T11:25:25Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The model I trained is a 3-layer feedforward neural network with tabular data.\r\nThe DeepExplainer could be initialized but error when calling shap_values at second line:\r\n```\r\ne = shap.DeepExplainer(model, background)\r\nshap_values = e.shap_values(x_test[1:5])\r\n```\r\n```\r\nTypeError: in converted code:\r\n    relative to /home/small/miniconda3/envs/scML/lib/python3.7/site-packages:\r\n\r\n    shap/explainers/deep/deep_tf.py:239 grad_graph  *\r\n        out = self.model(shap_rAnD)\r\n    tensorflow_core/python/keras/engine/base_layer.py:847 __call__\r\n        outputs = call_fn(cast_inputs, *args, **kwargs)\r\n    tensorflow_core/python/keras/engine/network.py:708 call\r\n        convert_kwargs_to_constants=base_layer_utils.call_context().saving)\r\n    tensorflow_core/python/keras/engine/network.py:860 _run_internal_graph\r\n        output_tensors = layer(computed_tensors, **kwargs)\r\n    tensorflow_core/python/keras/engine/base_layer.py:847 __call__\r\n        outputs = call_fn(cast_inputs, *args, **kwargs)\r\n    tensorflow_core/python/keras/layers/core.py:1056 call\r\n        outputs = gen_math_ops.mat_mul(inputs, self.kernel)\r\n    tensorflow_core/python/ops/gen_math_ops.py:6136 mat_mul\r\n        name=name)\r\n    tensorflow_core/python/framework/op_def_library.py:536 _apply_op_helper\r\n        repr(values), type(values).__name__, err))\r\n\r\n    TypeError: Expected float32 passed to parameter 'b' of op 'MatMul', got <tf.Variable 'dense_1/kernel:0' shape=(13642, 128) dtype=float32> of type 'ResourceVariable' instead. Error: custom_record_gradient() takes 4 positional arguments but 5 were given\r\n```\r\nThe KernelExplainer had similar error:\r\n`explainer = shap.KernelExplainer(model.evaluate, x_train.values, link=\"logit\")\r\n`\r\n```\r\nTypeError: in converted code:\r\n    relative to /home/small/miniconda3/envs/scML/lib/python3.7/site-packages/tensorflow_core/python:\r\n\r\n    keras/engine/data_adapter.py:279 permutation\r\n        indices = math_ops.range(num_samples, dtype=dtypes.int64)\r\n    ops/math_ops.py:1417 range\r\n        start = cast(start, dtype=dtype, name=\"start\")\r\n    util/dispatch.py:180 wrapper\r\n        return target(*args, **kwargs)\r\n    ops/math_ops.py:704 cast\r\n        x = gen_math_ops.cast(x, base_type, name=name)\r\n    ops/gen_math_ops.py:2225 cast\r\n        \"Cast\", _inputs_flat, _attrs, _result, name)\r\n\r\n    TypeError: custom_record_gradient() takes 4 positional arguments but 5 were given\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1085/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1085/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
