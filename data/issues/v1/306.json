{
  "url": "https://api.github.com/repos/shap/shap/issues/306",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/306/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/306/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/306/events",
  "html_url": "https://github.com/shap/shap/issues/306",
  "id": 375759516,
  "node_id": "MDU6SXNzdWUzNzU3NTk1MTY=",
  "number": 306,
  "title": "ResourceExhaustedError with DeepExplainer after Keras model load",
  "user": {
    "login": "austinmw",
    "id": 12224358,
    "node_id": "MDQ6VXNlcjEyMjI0MzU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/12224358?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/austinmw",
    "html_url": "https://github.com/austinmw",
    "followers_url": "https://api.github.com/users/austinmw/followers",
    "following_url": "https://api.github.com/users/austinmw/following{/other_user}",
    "gists_url": "https://api.github.com/users/austinmw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/austinmw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/austinmw/subscriptions",
    "organizations_url": "https://api.github.com/users/austinmw/orgs",
    "repos_url": "https://api.github.com/users/austinmw/repos",
    "events_url": "https://api.github.com/users/austinmw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/austinmw/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-10-31T01:21:35Z",
  "updated_at": "2019-06-18T09:00:18Z",
  "closed_at": "2018-11-09T16:45:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have my `x_train` and `x_test` data loaded, and gpu memory utilization is 0%.\r\nThey are both np.arrays of size `(10000,224,224,3)`.\r\n\r\nI then load my Keras model:\r\n\r\n```\r\nfrom tensorflow.keras.models import load_model\r\nmodel = load_model(./model.h5)\r\noptimizer = tf.keras.optimizers.SGD(lr=0.0001, momentum=0.99, nesterov=True)\r\nmodel.compile(loss='categorical_crossentropy', optimizer=optimizer)\r\n```\r\nAnd GPU memory utilization jumps to around 96%.\r\n\r\nI then try to use DeepExplainer just like the MNIST example:\r\n\r\n```\r\nimport shap\r\nimport numpy as np\r\n\r\n# select a set of background examples to take an expectation over\r\nbackground = x_train[np.random.choice(x_train.shape[0], 100, replace=False)]\r\n\r\n# explain predictions of the model on three images\r\ne = shap.DeepExplainer(model, background)\r\n\r\nshap_values = e.shap_values(x_test[1:5])\r\n```\r\nHowever I end up getting:\r\n\r\n> ResourceExhaustedError: OOM when allocating tensor with shape[200,64,224,224] and type float on /job:localhost/replica:0/task:0/device:GPU:0 by allocator GPU_0_bfc\r\n\r\nAm I doing something incorrectly?",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/306/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/306/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
