{
  "url": "https://api.github.com/repos/shap/shap/issues/1203",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1203/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1203/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1203/events",
  "html_url": "https://github.com/shap/shap/issues/1203",
  "id": 614761133,
  "node_id": "MDU6SXNzdWU2MTQ3NjExMzM=",
  "number": 1203,
  "title": "DeepExplainer returns extremely high shap values for conv1d model on spectral input data",
  "user": {
    "login": "philibb",
    "id": 23077713,
    "node_id": "MDQ6VXNlcjIzMDc3NzEz",
    "avatar_url": "https://avatars.githubusercontent.com/u/23077713?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/philibb",
    "html_url": "https://github.com/philibb",
    "followers_url": "https://api.github.com/users/philibb/followers",
    "following_url": "https://api.github.com/users/philibb/following{/other_user}",
    "gists_url": "https://api.github.com/users/philibb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/philibb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/philibb/subscriptions",
    "organizations_url": "https://api.github.com/users/philibb/orgs",
    "repos_url": "https://api.github.com/users/philibb/repos",
    "events_url": "https://api.github.com/users/philibb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/philibb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-05-08T14:00:12Z",
  "updated_at": "2022-01-14T03:35:54Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi Scott,\r\n\r\nthanks for the great work. \r\n\r\nUnfortunately I am having some trouble with the DeepExplainer. For my multi-class tensorflow.keras.sequential (tf 2.1) model (12 classes with softmax output) the DeepExplainer returns shap values in the range of -20 to +20. And most of the shap values are close to zero.\r\n\r\nThe input data to the model is a light absorption spectrum, so neighbouring features/channels in the spectrum are strongly correlated:\r\n![data](https://user-images.githubusercontent.com/23077713/81412761-a3322e80-9144-11ea-9163-8036e0e89e88.PNG)\r\n\r\nThe model I use contains following layers: Reshape (adding a dim for Conv1D), Conv1D, MaxPooling1D, Dropout, Flatten, Dense.\r\n\r\nAnd following actitivations: ReLu and Softmax in the output layer.\r\n\r\nAs background I use 1000 datapoints (distributed in a stratified manner along the classes).\r\n\r\nI tried calculate shap_values for 30 datapoints from the 1000 background datapoints, but also for 30 completely new datapoints. Always with the same result. The shap values are always ridiculously high (-20,+20) with most of them being close to zero.\r\n\r\nThe distribution of predicted probabilites for all classes are visualized in this plot:\r\n![hist](https://user-images.githubusercontent.com/23077713/81412824-bb09b280-9144-11ea-9b7f-f346d749f3cc.PNG)\r\n\r\nI am wondering what might be the cause for these high shap values. To demonstrate I also attached the shap summary dot plot:\r\n![dots](https://user-images.githubusercontent.com/23077713/81412836-c1982a00-9144-11ea-87e1-88f5f4b10e69.PNG)\r\n\r\nMy guesses are/were:\r\n\r\n- the shap values are not properly scaled (e.g. logit output) or\r\n- the correlated input features are a problem or\r\n- the model partially overfits and therefore a small shift in the input space causes a complete different model-output screwing up the shap values or\r\n- using the same datapoints for background and then shap-value-calculation is a problem\r\n\r\nIn comparison my xgboost model on a pca transform of the same input data is working great with the TreeExplainer.\r\n\r\nI would be super thankful, if you have a suggestion what might cause this problem.\r\n\r\nThanks in advance and best wishes\r\nPhilipp\r\n\r\nBtw: \r\nI think the following import is missing in the DeepExplainer 'from tensorflow.keras.models import Model' as I got an exception when using the tuple model-formulation saying: \r\nNameError: name 'Model' is not defined",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1203/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1203/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
