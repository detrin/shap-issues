{
  "url": "https://api.github.com/repos/shap/shap/issues/2129",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2129/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2129/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2129/events",
  "html_url": "https://github.com/shap/shap/issues/2129",
  "id": 964169172,
  "node_id": "MDU6SXNzdWU5NjQxNjkxNzI=",
  "number": 2129,
  "title": "Discrepancies between GPUTree and TreeExplainer",
  "user": {
    "login": "roiech91",
    "id": 43335574,
    "node_id": "MDQ6VXNlcjQzMzM1NTc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/43335574?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roiech91",
    "html_url": "https://github.com/roiech91",
    "followers_url": "https://api.github.com/users/roiech91/followers",
    "following_url": "https://api.github.com/users/roiech91/following{/other_user}",
    "gists_url": "https://api.github.com/users/roiech91/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roiech91/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roiech91/subscriptions",
    "organizations_url": "https://api.github.com/users/roiech91/orgs",
    "repos_url": "https://api.github.com/users/roiech91/repos",
    "events_url": "https://api.github.com/users/roiech91/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roiech91/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-08-09T16:30:45Z",
  "updated_at": "2021-08-09T16:30:45Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hey, I'm using GPUTree and found mismatches between GPUTree and TreeExplainer:\r\nTree Explainer Code:\r\n`explainer = shap.TreeExplainer(model)\r\nshap_values_per_entity = explainer.shap_values(x_predict)`\r\n\r\nGPUTree Explainer Code:\r\n`shap.explainers.GPUTree(model)\r\nshap_values_per_entity = explainer.shap_values(x_predict)`\r\n\r\nmodel = lgbm \r\n\r\n1.  When I'm using the GPUTree Explainer Code I'm getting the following exception (while using the Tree explainer for the same model and prediction I got the shape values without any exceptions):\r\n`Additivity check failed in TreeExplainer! Please ensure the data matrix you passed to the explainer is the same shape that the model was trained on. If your data shape is correct then please report this on GitHub. Consider retrying with the feature_perturbation='interventional' option. This check failed because for one of the samples the sum of the SHAP values was -0.036761, while the model output was -1.979285. If this difference is acceptable you can set check_additivity=False to disable this check.`\r\nIn addition, this exception is unclear since the prediction is different from the one that I used in order to train the model.\r\n\r\n2.  following the previous error I ran the shap_values function with the flag check_additivity=False:\r\n`shap_values_per_entity = explainer.shap_values(x_predict,check_additivity=False)`\r\nand the results I got is different from the result I got for TreeExplainer, for example:\r\nTree shap results:\r\n0.000679,-0.000121,0.000143,0.000715,0.0\r\n\r\nGpu tree shap results:\r\n0.00478, -0.000650, 0.000106, 0.000587, 0.0",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2129/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2129/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
