{
  "url": "https://api.github.com/repos/shap/shap/issues/1519",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1519/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1519/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1519/events",
  "html_url": "https://github.com/shap/shap/issues/1519",
  "id": 720040838,
  "node_id": "MDU6SXNzdWU3MjAwNDA4Mzg=",
  "number": 1519,
  "title": "shap.decision_plot model output value is different to the model predicted value",
  "user": {
    "login": "DrMerjo",
    "id": 20502214,
    "node_id": "MDQ6VXNlcjIwNTAyMjE0",
    "avatar_url": "https://avatars.githubusercontent.com/u/20502214?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DrMerjo",
    "html_url": "https://github.com/DrMerjo",
    "followers_url": "https://api.github.com/users/DrMerjo/followers",
    "following_url": "https://api.github.com/users/DrMerjo/following{/other_user}",
    "gists_url": "https://api.github.com/users/DrMerjo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DrMerjo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DrMerjo/subscriptions",
    "organizations_url": "https://api.github.com/users/DrMerjo/orgs",
    "repos_url": "https://api.github.com/users/DrMerjo/repos",
    "events_url": "https://api.github.com/users/DrMerjo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DrMerjo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-10-13T09:18:31Z",
  "updated_at": "2020-10-13T09:21:47Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Scott, \r\n\r\nFirst of all, thank you so much for making easier our life with this library! \r\n\r\nI am facing an issue with lightGBM regression predicted value and the predicted value sum of SHAP values and the expected value. These two values are different: \r\n- expected value = 6.3, \r\n- SHAP model output = 8,\r\n- and LightGBM regression prediction = 63.6.\r\n\r\nBefore posting this issue, I searched for the solution on Google, without success. Here is my code: \r\n\r\nX_test = train_model.X_test\r\nmodel = train_model.gbm_test\r\nexplainer = shap.TreeExplainer(model)\r\nX = X_test[:1]\r\ny_pred = model.predict(X)\r\nshap_values = explainer.shap_values(X)\r\nexpected_value = explainer.expected_value\r\nshap.decision_plot(expected_value, shap_values, X, feature_order='hclust', link='identity')\r\n\r\nIf I understood it correcty, the expected value is the average of predicted values. Here I have only one observation, hence one predcition. So the expected value should be 63.6. \r\n\r\nWhere is the problem? Did I a mistake in my code or is it an issue from SHAP?\r\n\r\nThnak you for your time. \r\n\r\n![Untitled](https://user-images.githubusercontent.com/20502214/95841878-28e68580-0d46-11eb-87db-c4225f41b5bb.jpg)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1519/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1519/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
