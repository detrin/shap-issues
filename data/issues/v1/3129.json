{
  "url": "https://api.github.com/repos/shap/shap/issues/3129",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/3129/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/3129/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/3129/events",
  "html_url": "https://github.com/shap/shap/issues/3129",
  "id": 1818307515,
  "node_id": "I_kwDOBHDcK85sYSu7",
  "number": 3129,
  "title": "BUG: Empty waterfall plot",
  "user": {
    "login": "CarlaFernandez",
    "id": 9136877,
    "node_id": "MDQ6VXNlcjkxMzY4Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9136877?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/CarlaFernandez",
    "html_url": "https://github.com/CarlaFernandez",
    "followers_url": "https://api.github.com/users/CarlaFernandez/followers",
    "following_url": "https://api.github.com/users/CarlaFernandez/following{/other_user}",
    "gists_url": "https://api.github.com/users/CarlaFernandez/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/CarlaFernandez/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/CarlaFernandez/subscriptions",
    "organizations_url": "https://api.github.com/users/CarlaFernandez/orgs",
    "repos_url": "https://api.github.com/users/CarlaFernandez/repos",
    "events_url": "https://api.github.com/users/CarlaFernandez/events{/privacy}",
    "received_events_url": "https://api.github.com/users/CarlaFernandez/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 486901329,
      "node_id": "MDU6TGFiZWw0ODY5MDEzMjk=",
      "url": "https://api.github.com/repos/shap/shap/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Indicates an unexpected problem or unintended behaviour"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-07-24T12:17:09Z",
  "updated_at": "2023-07-29T15:06:14Z",
  "closed_at": "2023-07-29T15:06:14Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Issue Description\r\n\r\nI'm trying to plot a waterfall plot from a (seemingly) correct Explanation object, but I'm obtaining an empty plot and the following exception:\r\n```python\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<command-1167888546861017> in <module>\r\n----> 1 shap.plots.waterfall(wrong[0])\r\n\r\n/local_disk0/.ephemeral_nfs/envs/pythonEnv-1a2ab749-87b1-4ef4-bb01-f8a919e5acef/lib/python3.8/site-packages/shap/plots/_waterfall.py in waterfall(shap_values, max_display, show)\r\n    156     points = pos_lefts + list(np.array(pos_lefts) + np.array(pos_widths)) + neg_lefts + \\\r\n    157         list(np.array(neg_lefts) + np.array(neg_widths))\r\n--> 158     dataw = np.max(points) - np.min(points)\r\n    159 \r\n    160     # draw invisible bars just for sizing the axes\r\n\r\n/local_disk0/.ephemeral_nfs/envs/pythonEnv-1a2ab749-87b1-4ef4-bb01-f8a919e5acef/lib/python3.8/site-packages/numpy/core/overrides.py in amax(*args, **kwargs)\r\n\r\n/local_disk0/.ephemeral_nfs/envs/pythonEnv-1a2ab749-87b1-4ef4-bb01-f8a919e5acef/lib/python3.8/site-packages/numpy/core/fromnumeric.py in amax(a, axis, out, keepdims, initial, where)\r\n   2789     5\r\n   2790     \"\"\"\r\n-> 2791     return _wrapreduction(a, np.maximum, 'max', axis, None, out,\r\n   2792                           keepdims=keepdims, initial=initial, where=where)\r\n   2793 \r\n\r\n/local_disk0/.ephemeral_nfs/envs/pythonEnv-1a2ab749-87b1-4ef4-bb01-f8a919e5acef/lib/python3.8/site-packages/numpy/core/fromnumeric.py in _wrapreduction(obj, ufunc, method, axis, dtype, out, **kwargs)\r\n     84                 return reduction(axis=axis, out=out, **passkwargs)\r\n     85 \r\n---> 86     return ufunc.reduce(obj, axis, dtype, out, **passkwargs)\r\n     87 \r\n     88 \r\n\r\nValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\r\n```\r\nThis is the resulting image, I assume it's incomplete due to the exception:\r\n![image](https://github.com/shap/shap/assets/9136877/0ee36288-fec7-4031-ad3d-8a5c27d87c26)\r\n\r\nI'm attaching here the **pickled Explanation object** so you can load it as the MRE. It is the result of explaining a single instance from the dataset:\r\n[waterfall_explanation_error.zip](https://github.com/shap/shap/files/12145774/waterfall_explanation_error.zip)\r\n\r\n**I can paint other plots just fine, I've tried a bar plot, a scatter plot, a force plot and a beeswarm plot**\r\n\r\n### Minimal Reproducible Example\r\n\r\n```python\r\nimport shap\r\nimport pickle\r\n\r\n# load the pickled Explanation object\r\nwith open(\"path_to/waterfall_explanation_error.pkl\", \"rb\") as f:\r\n    explanation = pickle.load(f)\r\n\r\n# paint waterfall plot\r\nshap.plots.waterfall(explanation[0])\r\n```\r\n\r\n\r\n### Expected Behavior\r\n\r\nA working waterfall plot.\r\n\r\n### Bug report checklist\r\n\r\n- [X] I have checked that this issue has not already been reported.\r\n- [X] I have confirmed this bug exists on the [latest release](https://github.com/slundberg/shap/releases) of shap.\r\n- [ ] I have confirmed this bug exists on the [master branch](https://github.com/slundberg/shap/blob/master/CONTRIBUTING.md#installing-from-the-master-branch) of shap.\r\n- [ ] I'd be interested in making a PR to fix this bug\r\n\r\n### Installed Versions\r\n\r\nshap==0.42.1\r\nscikit-learn==1.3.0",
  "closed_by": {
    "login": "thatlittleboy",
    "id": 30731072,
    "node_id": "MDQ6VXNlcjMwNzMxMDcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thatlittleboy",
    "html_url": "https://github.com/thatlittleboy",
    "followers_url": "https://api.github.com/users/thatlittleboy/followers",
    "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
    "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
    "repos_url": "https://api.github.com/users/thatlittleboy/repos",
    "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/3129/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/3129/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
