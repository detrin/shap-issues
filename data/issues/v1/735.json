{
  "url": "https://api.github.com/repos/shap/shap/issues/735",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/735/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/735/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/735/events",
  "html_url": "https://github.com/shap/shap/issues/735",
  "id": 478106226,
  "node_id": "MDU6SXNzdWU0NzgxMDYyMjY=",
  "number": 735,
  "title": "XGBoost GPU raise Segmentation Fault when explainer is instantiated.",
  "user": {
    "login": "otaviocv",
    "id": 11459089,
    "node_id": "MDQ6VXNlcjExNDU5MDg5",
    "avatar_url": "https://avatars.githubusercontent.com/u/11459089?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/otaviocv",
    "html_url": "https://github.com/otaviocv",
    "followers_url": "https://api.github.com/users/otaviocv/followers",
    "following_url": "https://api.github.com/users/otaviocv/following{/other_user}",
    "gists_url": "https://api.github.com/users/otaviocv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/otaviocv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/otaviocv/subscriptions",
    "organizations_url": "https://api.github.com/users/otaviocv/orgs",
    "repos_url": "https://api.github.com/users/otaviocv/repos",
    "events_url": "https://api.github.com/users/otaviocv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/otaviocv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-08-07T19:42:45Z",
  "updated_at": "2020-02-14T13:33:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "We (@rvilarino and I) were testing the shap tree explainer with a xgboost model trained using `tree_method=\"gpu_hist\"`, we got a silent segmentation fault, not sure how to fix that.\r\n\r\nA minimal example is provided below.\r\n\r\n```\r\nfrom xgboost import XGBClassifier\r\nfrom sklearn.datasets import load_breast_cancer\r\nfrom sklearn.model_selection import train_test_split\r\nfrom sklearn.metrics import roc_auc_score\r\nimport shap\r\n\r\n\r\ndata = load_breast_cancer()\r\nX = data.data\r\ny = data.target\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y)\r\n\r\n\r\nclf = XGBClassifier(tree_method=\"gpu_hist\")\r\nclf.fit(X_train, y_train)\r\n\r\nexplainer = shap.TreeExplainer(clf)\r\n```\r\n\r\nWe are using conda environments, here is our env specs:\r\n\r\nenv yaml:\r\n```\r\nname: shap-env\r\nchannels:\r\n  - conda-forge\r\n  - defaults\r\ndependencies:\r\n  - _libgcc_mutex=0.1=main\r\n  - _py-xgboost-mutex=1.0=gpu_0\r\n  - backcall=0.1.0=py_0\r\n  - bzip2=1.0.8=h516909a_0\r\n  - ca-certificates=2019.6.16=hecc5488_0\r\n  - certifi=2019.6.16=py37_1\r\n  - cloudpickle=1.2.1=py_0\r\n  - cudatoolkit=10.0.130=0\r\n  - cycler=0.10.0=py_1\r\n  - cytoolz=0.10.0=py37h516909a_0\r\n  - dask-core=2.2.0=py_0\r\n  - dbus=1.13.6=he372182_0\r\n  - decorator=4.4.0=py_0\r\n  - expat=2.2.5=he1b5a44_1003\r\n  - fontconfig=2.13.1=h86ecdb6_1001\r\n  - freetype=2.10.0=he983fc9_0\r\n  - gettext=0.19.8.1=hc5be6a0_1002\r\n  - glib=2.58.3=h6f030ca_1002\r\n  - gst-plugins-base=1.14.5=h0935bb2_0\r\n  - gstreamer=1.14.5=h36ae1b5_0\r\n  - icu=64.2=he1b5a44_0\r\n  - imageio=2.5.0=py37_0\r\n  - ipython=7.7.0=py37h5ca1d4c_0\r\n  - ipython_genutils=0.2.0=py_1\r\n  - jedi=0.14.1=py37_0\r\n  - joblib=0.13.2=py_0\r\n  - jpeg=9c=h14c3975_1001\r\n  - kiwisolver=1.1.0=py37hc9558a2_0\r\n  - libblas=3.8.0=11_openblas\r\n  - libcblas=3.8.0=11_openblas\r\n  - libffi=3.2.1=he1b5a44_1006\r\n  - libgcc-ng=9.1.0=hdf63c60_0\r\n  - libgfortran-ng=7.3.0=hdf63c60_0\r\n  - libiconv=1.15=h516909a_1005\r\n  - liblapack=3.8.0=11_openblas\r\n  - libopenblas=0.3.6=h6e990d7_6\r\n  - libpng=1.6.37=hed695b0_0\r\n  - libstdcxx-ng=9.1.0=hdf63c60_0\r\n  - libtiff=4.0.10=h57b8799_1003\r\n  - libuuid=2.32.1=h14c3975_1000\r\n  - libxcb=1.13=h14c3975_1002\r\n  - libxgboost=0.90=h688424c_0\r\n  - libxml2=2.9.9=hee79883_2\r\n  - lz4-c=1.8.3=he1b5a44_1001\r\n  - matplotlib=3.1.1=py37_1\r\n  - matplotlib-base=3.1.1=py37he7580a8_1\r\n  - ncurses=6.1=hf484d3e_1002\r\n  - networkx=2.3=py_0\r\n  - numpy=1.17.0=py37h95a1406_0\r\n  - olefile=0.46=py_0\r\n  - openssl=1.1.1c=h516909a_0\r\n  - pandas=0.25.0=py37hb3f55d8_0\r\n  - parso=0.5.1=py_0\r\n  - pcre=8.41=hf484d3e_1003\r\n  - pexpect=4.7.0=py37_0\r\n  - pickleshare=0.7.5=py37_1000\r\n  - pillow=6.1.0=py37h6b7be26_1\r\n  - pip=19.2.1=py37_0\r\n  - prompt_toolkit=2.0.9=py_0\r\n  - pthread-stubs=0.4=h14c3975_1001\r\n  - ptyprocess=0.6.0=py_1001\r\n  - py-xgboost=0.90=py37h688424c_0\r\n  - py-xgboost-gpu=0.90=py37h28bbb66_0\r\n  - pygments=2.4.2=py_0\r\n  - pyparsing=2.4.2=py_0\r\n  - pyqt=5.9.2=py37hcca6a23_2\r\n  - python=3.7.3=h33d41f4_1\r\n  - python-dateutil=2.8.0=py_0\r\n  - pytz=2019.2=py_0\r\n  - pywavelets=1.0.3=py37hd352d35_1\r\n  - qt=5.9.7=h0c104cb_3\r\n  - readline=8.0=hf8c457e_0\r\n  - scikit-image=0.15.0=py37hb3f55d8_2\r\n  - scikit-learn=0.21.3=py37hcdab131_0\r\n  - scipy=1.3.0=py37h921218d_1\r\n  - setuptools=41.0.1=py37_0\r\n  - shap=0.29.3=py37hb3f55d8_0\r\n  - sip=4.19.8=py37hf484d3e_1000\r\n  - six=1.12.0=py37_1000\r\n  - sqlite=3.29.0=hcee41ef_0\r\n  - tk=8.6.9=hed695b0_1002\r\n  - toolz=0.10.0=py_0\r\n  - tornado=6.0.3=py37h516909a_0\r\n  - tqdm=4.32.2=py_0\r\n  - traitlets=4.3.2=py37_1000\r\n  - wcwidth=0.1.7=py_1\r\n  - wheel=0.33.4=py37_0\r\n  - xorg-libxau=1.0.9=h14c3975_0\r\n  - xorg-libxdmcp=1.1.3=h516909a_0\r\n  - xz=5.2.4=h14c3975_1001\r\n  - zlib=1.2.11=h516909a_1005\r\n  - zstd=1.4.0=h3b9ef0a_0\r\n```\r\nspec file:\r\n```\r\n# This file may be used to create an environment using:\r\n# $ conda create --name <env> --file <this file>\r\n# platform: linux-64\r\n@EXPLICIT\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/_libgcc_mutex-0.1-main.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/_py-xgboost-mutex-1.0-gpu_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/ca-certificates-2019.6.16-hecc5488_0.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/cudatoolkit-10.0.130-0.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/libgfortran-ng-7.3.0-hdf63c60_0.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/libstdcxx-ng-9.1.0-hdf63c60_0.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/libgcc-ng-9.1.0-hdf63c60_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/bzip2-1.0.8-h516909a_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/expat-2.2.5-he1b5a44_1003.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/icu-64.2-he1b5a44_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/jpeg-9c-h14c3975_1001.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libffi-3.2.1-he1b5a44_1006.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libiconv-1.15-h516909a_1005.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libopenblas-0.3.6-h6e990d7_6.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libuuid-2.32.1-h14c3975_1000.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/libxgboost-0.90-h688424c_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/lz4-c-1.8.3-he1b5a44_1001.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/ncurses-6.1-hf484d3e_1002.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/openssl-1.1.1c-h516909a_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pcre-8.41-hf484d3e_1003.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pthread-stubs-0.4-h14c3975_1001.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/xorg-libxau-1.0.9-h14c3975_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/xorg-libxdmcp-1.1.3-h516909a_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/xz-5.2.4-h14c3975_1001.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/zlib-1.2.11-h516909a_1005.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/gettext-0.19.8.1-hc5be6a0_1002.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libblas-3.8.0-11_openblas.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libpng-1.6.37-hed695b0_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libxcb-1.13-h14c3975_1002.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libxml2-2.9.9-hee79883_2.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/readline-8.0-hf8c457e_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/tk-8.6.9-hed695b0_1002.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/zstd-1.4.0-h3b9ef0a_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/freetype-2.10.0-he983fc9_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/glib-2.58.3-h6f030ca_1002.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libcblas-3.8.0-11_openblas.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/liblapack-3.8.0-11_openblas.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/libtiff-4.0.10-h57b8799_1003.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/sqlite-3.29.0-hcee41ef_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/dbus-1.13.6-he372182_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/fontconfig-2.13.1-h86ecdb6_1001.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/gstreamer-1.14.5-h36ae1b5_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/python-3.7.3-h33d41f4_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/backcall-0.1.0-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/certifi-2019.6.16-py37_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/cloudpickle-1.2.1-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/dask-core-2.2.0-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/decorator-4.4.0-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/gst-plugins-base-1.14.5-h0935bb2_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/ipython_genutils-0.2.0-py_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/joblib-0.13.2-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/kiwisolver-1.1.0-py37hc9558a2_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/numpy-1.17.0-py37h95a1406_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/olefile-0.46-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/parso-0.5.1-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pickleshare-0.7.5-py37_1000.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/ptyprocess-0.6.0-py_1001.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/pyparsing-2.4.2-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/pytz-2019.2-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/sip-4.19.8-py37hf484d3e_1000.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/six-1.12.0-py37_1000.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/toolz-0.10.0-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/tornado-6.0.3-py37h516909a_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/tqdm-4.32.2-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/wcwidth-0.1.7-py_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/cycler-0.10.0-py_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/cytoolz-0.10.0-py37h516909a_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/jedi-0.14.1-py37_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pexpect-4.7.0-py37_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pillow-6.1.0-py37h6b7be26_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/python-dateutil-2.8.0-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pywavelets-1.0.3-py37hd352d35_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/qt-5.9.7-h0c104cb_3.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/scipy-1.3.0-py37h921218d_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/setuptools-41.0.1-py37_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/traitlets-4.3.2-py37_1000.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/imageio-2.5.0-py37_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/matplotlib-base-3.1.1-py37he7580a8_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/networkx-2.3-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pandas-0.25.0-py37hb3f55d8_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/pygments-2.4.2-py_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pyqt-5.9.2-py37hcca6a23_2.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/scikit-learn-0.21.3-py37hcdab131_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/wheel-0.33.4-py37_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/matplotlib-3.1.1-py37_1.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/pip-19.2.1-py37_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/noarch/prompt_toolkit-2.0.9-py_0.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/py-xgboost-0.90-py37h688424c_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/scikit-image-0.15.0-py37hb3f55d8_2.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/ipython-7.7.0-py37h5ca1d4c_0.tar.bz2\r\nhttps://repo.anaconda.com/pkgs/main/linux-64/py-xgboost-gpu-0.90-py37h28bbb66_0.tar.bz2\r\nhttps://conda.anaconda.org/conda-forge/linux-64/shap-0.29.3-py37hb3f55d8_0.tar.bz2\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/735/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/735/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
