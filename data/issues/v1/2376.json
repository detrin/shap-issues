{
  "url": "https://api.github.com/repos/shap/shap/issues/2376",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2376/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2376/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2376/events",
  "html_url": "https://github.com/shap/shap/issues/2376",
  "id": 1119070576,
  "node_id": "I_kwDOBHDcK85Cs6lw",
  "number": 2376,
  "title": "Image Partition Explainer does not work with PyTorch",
  "user": {
    "login": "igygi",
    "id": 43819944,
    "node_id": "MDQ6VXNlcjQzODE5OTQ0",
    "avatar_url": "https://avatars.githubusercontent.com/u/43819944?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/igygi",
    "html_url": "https://github.com/igygi",
    "followers_url": "https://api.github.com/users/igygi/followers",
    "following_url": "https://api.github.com/users/igygi/following{/other_user}",
    "gists_url": "https://api.github.com/users/igygi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/igygi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/igygi/subscriptions",
    "organizations_url": "https://api.github.com/users/igygi/orgs",
    "repos_url": "https://api.github.com/users/igygi/repos",
    "events_url": "https://api.github.com/users/igygi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/igygi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-31T07:36:15Z",
  "updated_at": "2022-02-21T08:44:10Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Following the example in https://shap.readthedocs.io/en/latest/example_notebooks/image_examples/image_classification/Image%20Multi%20Class.html but using a PyTorch ResNet model instead of Tensorflow ResNet results to an error. \r\n\r\nTensorflow's `preprocess_input` outputs `numpy` objects, which is supported by both the Tensorflow ResNet model and shap's `masker`. However, PyTorch's ResNet expects `Tensor` type, which causes the error below in shap's `masker`. \r\n\r\n```\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n/tmp/ipykernel_9878/30609154.py in <module>\r\n----> 1 shap_values = explainer(to_explain, max_evals=100, batch_size=10, outputs=shap.Explanation.argsort.flip[:4])\r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/explainers/_partition.py in __call__(self, max_evals, fixed_context, main_effects, error_bounds, batch_size, outputs, silent, *args)\r\n    135         return super().__call__(\r\n    136             *args, max_evals=max_evals, fixed_context=fixed_context, main_effects=main_effects, error_bounds=error_bounds, batch_size=batch_size,\r\n--> 137             outputs=outputs, silent=silent\r\n    138         )\r\n    139 \r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/explainers/_explainer.py in __call__(self, max_evals, main_effects, error_bounds, batch_size, outputs, silent, *args, **kwargs)\r\n    258             row_result = self.explain_row(\r\n    259                 *row_args, max_evals=max_evals, main_effects=main_effects, error_bounds=error_bounds,\r\n--> 260                 batch_size=batch_size, outputs=outputs, silent=silent, **kwargs\r\n    261             )\r\n    262             values.append(row_result.get(\"values\", None))\r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/explainers/_partition.py in explain_row(self, max_evals, main_effects, error_bounds, batch_size, outputs, silent, fixed_context, *row_args)\r\n    158         # if not fixed background or no base value assigned then compute base value for a row\r\n    159         if self._curr_base_value is None or not getattr(self.masker, \"fixed_background\", False):\r\n--> 160             self._curr_base_value = fm(m00.reshape(1, -1), zero_index=0)[0] # the zero index param tells the masked model what the baseline is\r\n    161         f11 = fm(~m00.reshape(1, -1))[0]\r\n    162 \r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/utils/_masked_model.py in __call__(self, masks, zero_index, batch_size)\r\n     65 \r\n     66         else:\r\n---> 67             return self._full_masking_call(masks, batch_size=batch_size)\r\n     68 \r\n     69     def _full_masking_call(self, masks, zero_index=None, batch_size=None):\r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/utils/_masked_model.py in _full_masking_call(self, masks, zero_index, batch_size)\r\n     91                     masked_inputs = self.masker(delta_ind, *self.args).copy()\r\n     92                 else:\r\n---> 93                     masked_inputs = self.masker(mask, *self.args)\r\n     94 \r\n     95                 # wrap the masked inputs if they are not already in a tuple\r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/maskers/_image.py in __call__(self, mask, x)\r\n     88 \r\n     89             elif self.mask_value == \"inpaint_telea\":\r\n---> 90                 out = self.inpaint(x, ~mask, \"INPAINT_TELEA\")\r\n     91             elif self.mask_value == \"inpaint_ns\":\r\n     92                 out = self.inpaint(x, ~mask, \"INPAINT_NS\")\r\n\r\n/opt/conda/lib/python3.7/site-packages/shap/maskers/_image.py in inpaint(self, x, mask, method)\r\n    102         reshaped_mask = mask.reshape(self.input_shape).astype(np.uint8).max(2)\r\n    103         if reshaped_mask.sum() == np.prod(self.input_shape[:-1]):\r\n--> 104             out = x.reshape(self.input_shape).copy()\r\n    105             out[:] = out.mean((0, 1))\r\n    106             return out.flatten()\r\n\r\nAttributeError: 'Tensor' object has no attribute 'copy'\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2376/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2376/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
