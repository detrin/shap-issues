{
  "url": "https://api.github.com/repos/shap/shap/issues/1671",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1671/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1671/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1671/events",
  "html_url": "https://github.com/shap/shap/issues/1671",
  "id": 771110516,
  "node_id": "MDU6SXNzdWU3NzExMTA1MTY=",
  "number": 1671,
  "title": "RuntimeError: only Tensors of floating point dtype can require gradients",
  "user": {
    "login": "kevkid",
    "id": 1369930,
    "node_id": "MDQ6VXNlcjEzNjk5MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1369930?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kevkid",
    "html_url": "https://github.com/kevkid",
    "followers_url": "https://api.github.com/users/kevkid/followers",
    "following_url": "https://api.github.com/users/kevkid/following{/other_user}",
    "gists_url": "https://api.github.com/users/kevkid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kevkid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kevkid/subscriptions",
    "organizations_url": "https://api.github.com/users/kevkid/orgs",
    "repos_url": "https://api.github.com/users/kevkid/repos",
    "events_url": "https://api.github.com/users/kevkid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kevkid/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2020-12-18T19:10:31Z",
  "updated_at": "2023-07-06T20:45:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "NOTE: I am using this fork: https://github.com/ceshine/shap/ @ceshine\r\n\r\nI have an MLP that has 2 inputs X_continuous and X_categorical. X_continuous is a tensor that is of type float and X_categorical is of type long. I use this long tensor to look up my categorical embeddings in the forward function. My model trains fine, but when trying to use the package I get:\r\n```\r\n    153     def gradient(self, idx, inputs):\r\n    154         self.model.zero_grad()\r\n--> 155         X = [x.requires_grad_() for x in inputs]\r\n    156         outputs = self.model(*X)\r\n    157         selected = [val for val in outputs[:, idx]]\r\n\r\nRuntimeError: only Tensors of floating point dtype can require gradients\r\n```\r\nHere is what my setup looks like:\r\n\r\n```\r\nclass Net(nn.Module):\r\n    def __init__(self, embeddings):\r\n        super(Net, self).__init__()\r\n        self.cat_emb = embeddings# get the embeddings we have created\r\n        self.dropout = nn.Dropout(p=0.1)\r\n        \r\n        self.fc1 = nn.Linear(in_dim, 5)\r\n        self.fc2 = nn.Linear(100, 50)\r\n        self.fc3 = nn.Linear(50, 10)\r\n        self.fc4 = nn.Linear(5, 2)\r\n\r\n    def forward(self, x, x_cat):# If we have a second input (categorical) then we use it\r\n        x_num = x\r\n        x_cat = [e(x_cat[:,i]) for i,e in enumerate(self.cat_emb)]# [num_emb, bs, emb_dim], pulls each embedded vector out of embedding\r\n        x_cat = torch.cat(x_cat, 1)# flattens the weight vectors into 1 vector of weights [bs, num_emb*emb_dim]\r\n        x = torch.cat((x, x_cat), 1)# gives us our numeric and our categorical in 1 vector\r\n        x = self.dropout(F.elu(self.fc1(x)))\r\n        x = self.fc4(x)\r\n        return x\r\n```\r\n```\r\n%%time\r\n#Approximate shap values for DL models\r\ne = shap.DeepExplainer(\r\n        net, [numeric_list.float(), categorical_list.long()])\r\n%%time\r\nshap_values = e.shap_values([numeric_list.float(), categorical_list.long()])\r\n```\r\n\r\nAny advice?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1671/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1671/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
