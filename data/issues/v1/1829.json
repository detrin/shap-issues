{
  "url": "https://api.github.com/repos/shap/shap/issues/1829",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1829/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1829/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1829/events",
  "html_url": "https://github.com/shap/shap/pull/1829",
  "id": 811678469,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NTc2MTY3OTYw",
  "number": 1829,
  "title": "WiP: [feature] Adds utils.to_dataframe",
  "user": {
    "login": "brendalf",
    "id": 10671410,
    "node_id": "MDQ6VXNlcjEwNjcxNDEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/10671410?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brendalf",
    "html_url": "https://github.com/brendalf",
    "followers_url": "https://api.github.com/users/brendalf/followers",
    "following_url": "https://api.github.com/users/brendalf/following{/other_user}",
    "gists_url": "https://api.github.com/users/brendalf/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brendalf/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brendalf/subscriptions",
    "organizations_url": "https://api.github.com/users/brendalf/orgs",
    "repos_url": "https://api.github.com/users/brendalf/repos",
    "events_url": "https://api.github.com/users/brendalf/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brendalf/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-02-19T04:33:34Z",
  "updated_at": "2022-07-15T17:36:06Z",
  "closed_at": "2022-07-15T17:36:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/shap/shap/pulls/1829",
    "html_url": "https://github.com/shap/shap/pull/1829",
    "diff_url": "https://github.com/shap/shap/pull/1829.diff",
    "patch_url": "https://github.com/shap/shap/pull/1829.patch",
    "merged_at": null
  },
  "body": "Hi everyone,\r\nI'm opening this PR as a WiP for discussion.\r\nI have been using this function for a while now inside my projects, because I need a better way to handle the shap_values for local interpretability, eg: saving to a database or displaying on a dashboard.\r\n\r\n**How to use**\r\nWe generate shap values, like this;\r\n```\r\nimport xgboost\r\nimport shap\r\n\r\n# load JS visualization code to notebook\r\nshap.initjs()\r\n\r\n# train XGBoost model\r\nX,y = shap.datasets.boston()\r\nmodel = xgboost.train({\"learning_rate\": 0.01}, xgboost.DMatrix(X, label=y), 100)\r\n\r\n# explain the model's predictions using SHAP\r\n# (same syntax works for LightGBM, CatBoost, scikit-learn and spark models)\r\nexplainer = shap.TreeExplainer(model)\r\nshap_values = explainer.shap_values(X)\r\n```\r\n\r\nBut, instead of calling force_plot or some other visualization function, we call to_dataframe with type=\"local\" to get a structured dataframe for every sample:\r\n```\r\n>> explanations = shap.utils.to_dataframe(X, shap_values, type='local')\r\n>> explanations[0] # one for each sample\r\nfeature_name  shap_value  feature_value\r\n0          CRIM    0.214554        0.00632\r\n1            ZN    0.001347       18.00000\r\n2         INDUS    0.018625        2.31000\r\n3          CHAS    0.000000        0.00000\r\n4           NOX   -0.407199        0.53800\r\n5            RM   -1.161836        6.57500\r\n6           AGE   -0.051294       65.20000\r\n7           DIS   -0.342014        4.09000\r\n8           RAD   -0.040446        1.00000\r\n9           TAX    0.005487      296.00000\r\n10      PTRATIO    0.050437       15.30000\r\n11            B    0.027335      396.90000\r\n12        LSTAT    3.944320        4.98000\r\n```\r\n\r\nCalling with type=\"global\":\r\n```\r\n>> shap.utils.to_dataframe(X, shap_values)\r\n         CRIM        ZN     INDUS  CHAS       NOX        RM       AGE       DIS       RAD       TAX   PTRATIO         B     LSTAT\r\n0    0.214554  0.001347  0.018625   0.0 -0.407199 -1.161836 -0.051294 -0.342014 -0.040446  0.005487  0.050437  0.027335  3.944320\r\n1    0.155329 -0.000145  0.015380   0.0  0.202683 -1.421003  0.007839 -0.218202 -0.011172  0.068912  0.067537  0.030773  1.776321\r\n2    0.215071 -0.000197  0.010976   0.0  0.300025  2.662230 -0.048194 -0.195486 -0.004875  0.074755  0.059504  0.040972  4.079880\r\n3    0.198795 -0.000197  0.010976   0.0  0.296236  2.100869 -0.047799 -0.202624 -0.004593  0.078215  0.051829  0.041348  4.501813\r\n4    0.225711 -0.000197  0.010976   0.0  0.296236  2.622418 -0.048483 -0.067217 -0.004875  0.078215  0.049482  0.040972  3.991424\r\n..        ...       ...       ...   ...       ...       ...       ...       ...       ...       ...       ...       ...       ...\r\n501  0.217806 -0.003630  0.017437   0.0  0.064196 -0.255168 -0.033671 -0.029691 -0.170089  0.061408 -0.299804  0.044502  1.350070\r\n502  0.135671 -0.003630  0.017437   0.0  0.077881 -1.770273 -0.017433 -0.063375 -0.170089  0.061408 -0.345686  0.028841  1.554053\r\n503  0.205472 -0.003651  0.010618   0.0  0.182431  1.608566 -0.056352  0.008796 -0.170089  0.032885 -1.108893  0.031912  2.081848\r\n504  0.235165 -0.003630  0.017462   0.0  0.059240 -0.260752 -0.056548 -0.055961 -0.170089  0.032741 -0.285619  0.028463  2.270567\r\n505  0.039219 -0.028915  0.014358   0.0  0.107744 -2.511637 -0.165713 -0.072159 -0.332363  0.061408 -0.344520  0.027025  1.118829\r\n\r\n[506 rows x 13 columns]\r\n```\r\n\r\nThis implementation is just the overall idea.  I don't know if the utils is the right place for it or if the name and arguments are in the right \"shap pattern\".\r\n\r\nAlso, I've only tested with TreeExplainer.\r\n\r\nWhat do you think about @slundberg?\r\nIf you like these changes, I guess there is still a couple things to do, like:\r\n- [ ] Documentation\r\n- [ ] Examples\r\n- [ ] Tests? \r\n\r\nThis should close #1724 ",
  "closed_by": {
    "login": "brendalf",
    "id": 10671410,
    "node_id": "MDQ6VXNlcjEwNjcxNDEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/10671410?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brendalf",
    "html_url": "https://github.com/brendalf",
    "followers_url": "https://api.github.com/users/brendalf/followers",
    "following_url": "https://api.github.com/users/brendalf/following{/other_user}",
    "gists_url": "https://api.github.com/users/brendalf/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brendalf/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brendalf/subscriptions",
    "organizations_url": "https://api.github.com/users/brendalf/orgs",
    "repos_url": "https://api.github.com/users/brendalf/repos",
    "events_url": "https://api.github.com/users/brendalf/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brendalf/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1829/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1829/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
