{
  "url": "https://api.github.com/repos/shap/shap/issues/566",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/566/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/566/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/566/events",
  "html_url": "https://github.com/shap/shap/pull/566",
  "id": 437964555,
  "node_id": "MDExOlB1bGxSZXF1ZXN0Mjc0MTIwMzEy",
  "number": 566,
  "title": "fix zero division in compute_expectations",
  "user": {
    "login": "dvpolyakov",
    "id": 11911648,
    "node_id": "MDQ6VXNlcjExOTExNjQ4",
    "avatar_url": "https://avatars.githubusercontent.com/u/11911648?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dvpolyakov",
    "html_url": "https://github.com/dvpolyakov",
    "followers_url": "https://api.github.com/users/dvpolyakov/followers",
    "following_url": "https://api.github.com/users/dvpolyakov/following{/other_user}",
    "gists_url": "https://api.github.com/users/dvpolyakov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dvpolyakov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dvpolyakov/subscriptions",
    "organizations_url": "https://api.github.com/users/dvpolyakov/orgs",
    "repos_url": "https://api.github.com/users/dvpolyakov/repos",
    "events_url": "https://api.github.com/users/dvpolyakov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dvpolyakov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-04-27T17:14:14Z",
  "updated_at": "2019-05-03T16:18:56Z",
  "closed_at": "2019-05-03T16:18:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/shap/shap/pulls/566",
    "html_url": "https://github.com/shap/shap/pull/566",
    "diff_url": "https://github.com/shap/shap/pull/566.diff",
    "patch_url": "https://github.com/shap/shap/pull/566.patch",
    "merged_at": "2019-05-03T16:18:56Z"
  },
  "body": "Hello, @slundberg ) Thank you for writing this tool.\r\n\r\nI have a request with a really short implementation. \r\n\r\nI want to add new SHAP functionality to Yandex CatBoost. But due to the special structure of trees in CatBoost, there might be nodes with right and left leafs with both zero sample weights in them. As a result, after calling the `_cext.compute_expectations` function https://github.com/slundberg/shap/blob/master/shap/explainers/tree.py#L899\r\nwhich calls `compute_expectations` function here https://github.com/slundberg/shap/blob/master/shap/_cext.cc#L99 and finally calling `compute_expectations` function here https://github.com/slundberg/shap/blob/master/shap/tree_shap.h#L509, if `(left_weight + right_weight)` equals to `0`, this leads to zero division and `nan`s in returned Python array of expected values in nodes of trees.\r\n\r\nIn other tree-based algorithms, such as XGBClassifier and RandomForestClassifier, at least one sample must be in each leaf, so this problem does not appear. But in CatBoost trees it appears.\r\n\r\nI just have added additional if-statement to check that `left_weight` and `right_weight` are not zeroes.  ",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/566/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/566/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
