{
  "url": "https://api.github.com/repos/shap/shap/issues/102",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/102/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/102/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/102/events",
  "html_url": "https://github.com/shap/shap/issues/102",
  "id": 326730476,
  "node_id": "MDU6SXNzdWUzMjY3MzA0NzY=",
  "number": 102,
  "title": "Identical SHAP values when TreeExplainer is applied to RandomForestClassifier",
  "user": {
    "login": "IvanUkhov",
    "id": 57440,
    "node_id": "MDQ6VXNlcjU3NDQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/57440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/IvanUkhov",
    "html_url": "https://github.com/IvanUkhov",
    "followers_url": "https://api.github.com/users/IvanUkhov/followers",
    "following_url": "https://api.github.com/users/IvanUkhov/following{/other_user}",
    "gists_url": "https://api.github.com/users/IvanUkhov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/IvanUkhov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/IvanUkhov/subscriptions",
    "organizations_url": "https://api.github.com/users/IvanUkhov/orgs",
    "repos_url": "https://api.github.com/users/IvanUkhov/repos",
    "events_url": "https://api.github.com/users/IvanUkhov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/IvanUkhov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2018-05-26T11:15:28Z",
  "updated_at": "2018-05-30T18:18:05Z",
  "closed_at": "2018-05-30T18:06:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "First of all, thank you for the great work!\r\n\r\nAs the title suggests, I’m trying to explain `sklearn.ensemble.RandomForestClassifier` using `shap.TreeExplainer`. If it’s a binary classification problem, `shap_values` returns a list of two matrices, one for each class. The problem is that the matrices are identical except for the last column, which corresponds to the bias. They both seem to try to explain the same class.\r\n\r\nHere is an example:\r\n\r\n```python\r\nimport sklearn\r\nimport shap\r\n\r\nfrom sklearn.ensemble import RandomForestClassifier\r\nfrom sklearn.model_selection import train_test_split\r\n\r\nX, y = shap.datasets.iris()\r\ny[y == 2] = 1\r\n\r\nX_train, X_test, y_train, y_test = train_test_split(\r\n    X, y, test_size=0.2, random_state=0)\r\n\r\nmodel = RandomForestClassifier(n_estimators=100, max_depth=None,\r\n                               min_samples_split=2, random_state=0)\r\nmodel.fit(X_train, y_train)\r\n\r\nexplainer = shap.TreeExplainer(model)\r\nshap_values = explainer.shap_values(X_test)\r\n\r\nshap.initjs()\r\n```\r\n\r\n```python\r\ny_test\r\n```\r\n\r\n```text\r\narray([1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1,\r\n       0, 0, 1, 0, 0, 1, 1, 0])\r\n```\r\n\r\n```python\r\nshap.force_plot(shap_values[0], X_test)\r\n```\r\n\r\n<img width=\"999\" alt=\"0\" src=\"https://user-images.githubusercontent.com/57440/40575443-6accb6a0-60e5-11e8-9468-241812e1b739.png\">\r\n\r\n```python\r\nshap.force_plot(shap_values[1], X_test)\r\n```\r\n\r\n<img width=\"1007\" alt=\"1\" src=\"https://user-images.githubusercontent.com/57440/40575446-711c4c50-60e5-11e8-937a-512be689a3ad.png\">\r\n\r\nThe same applies to more than two classes.\r\n\r\nIf you switch to `LogisticRegression` and `KernelExplainer`, you’ll indeed get different SHAP values for different classes. In the case of two classes, they’ll be negations of each other (sum up to zero).\r\n\r\nIs it a bug, or am I misusing the library? Thanks!",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/102/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/102/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
