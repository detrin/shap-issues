{
  "url": "https://api.github.com/repos/shap/shap/issues/592",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/592/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/592/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/592/events",
  "html_url": "https://github.com/shap/shap/issues/592",
  "id": 444644873,
  "node_id": "MDU6SXNzdWU0NDQ2NDQ4NzM=",
  "number": 592,
  "title": "Interpreting interactions between different classes in keras model",
  "user": {
    "login": "amjass12",
    "id": 33659783,
    "node_id": "MDQ6VXNlcjMzNjU5Nzgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/33659783?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amjass12",
    "html_url": "https://github.com/amjass12",
    "followers_url": "https://api.github.com/users/amjass12/followers",
    "following_url": "https://api.github.com/users/amjass12/following{/other_user}",
    "gists_url": "https://api.github.com/users/amjass12/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amjass12/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amjass12/subscriptions",
    "organizations_url": "https://api.github.com/users/amjass12/orgs",
    "repos_url": "https://api.github.com/users/amjass12/repos",
    "events_url": "https://api.github.com/users/amjass12/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amjass12/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-05-15T21:05:10Z",
  "updated_at": "2023-08-26T11:34:59Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi all!\r\n\r\nI was wondering if you could help with a little issue I am having. I have found Shap to be incredibly useful in explaining the output of my model!! Would it be possible to guide me on a slightly more complex bit of analysis I am trying to achieve using Shap but am unsure of how to do:\r\n\r\nThe model:\r\n\r\nI have built a keras model to classify genomic data. This data contains labels such as Age, organ etc.. There are 5 labels in total. For each label, there are 5000 features (there could even be more if I don't filter!)\r\n\r\nAfter building and running the model, I run Shap as follows:\r\n\r\n```\r\nexplainer = shap.DeepExplainer(model, X_train.values)\r\nshap_values = explainer.shap_values(X_train.values)\r\n```\r\n\r\nThe shap value matrix is great, very informative, but I find the plots to be particularly useful. For example: when probing for a single class (one of the organs):\r\n\r\n`shap.summary_plot(shap_values[1], X_train.values, feature_names=X_train.columns, max_display=5084, sort=True, auto_size_plot=True)\r\n`\r\n\r\nI have attached a screenshot pf what this looks like, which is effectively the features that contribute most to the model deciding that this is organ 'x', or could be age 'x' etc\r\n\r\n<img width=\"603\" alt=\"Screenshot 2019-05-15 at 21 47 54\" src=\"https://user-images.githubusercontent.com/33659783/57808422-38316000-775b-11e9-8b5f-960af4b194a5.png\">\r\n\r\nWhat I am really interested in probing are the relationships (interactions) between the different categorical classes in the keras model (Age, Sex, Organ etc): However this is where I am getting stuck and really need some advice in extracting the correct shap_values for probing this/plots to visualise this. What I would like to know are the features that are correlated between different classes. \r\n\r\nSo while the plot attached is the contributing features to just one class (one of the organs), I would like to see if there are interactions between different classes and which features comprise these interactions. \r\n\r\nFor example are there interactions between organs and age (for example) and if so which features define a specific organ at a specific age (again just as an example).\r\n\r\nAnd of course, not just plotting, but is there a way of getting an array of data that reveals this interaction information? \r\n\r\nAm I correct in using the following function to think about this issue?\r\n\r\n`shap.dependence_plot(\"ENSMUSG00000030495\", shap_values[1], X_train, feature_names=X_train.columns, interaction_index=\"ENSMUSG00000059412\")\r\n\r\n`\r\n\r\nOf course, instead of shap_value[1], it might be shap_values[1:6] (for all categorical classes) and then the interaction indexes would be Age (shap_value[1:3] with organ(shap_value[4:6] instead of the features themselves ... and then see which genes drive interactions between these two classes. \r\n\r\nI really hope this is clear, and my understanding is that this is possible with Shap and this is the kind of valuable data I would love to extract from my model. Any advice on how to proceed with this specifically code wise would be much appreciated!\r\n\r\nMany thanks!\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/592/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/592/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
