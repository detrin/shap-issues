{
  "url": "https://api.github.com/repos/shap/shap/issues/788",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/788/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/788/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/788/events",
  "html_url": "https://github.com/shap/shap/issues/788",
  "id": 487915262,
  "node_id": "MDU6SXNzdWU0ODc5MTUyNjI=",
  "number": 788,
  "title": "How to only explain a subset of the input features?",
  "user": {
    "login": "frederikfaye",
    "id": 45294294,
    "node_id": "MDQ6VXNlcjQ1Mjk0Mjk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/45294294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frederikfaye",
    "html_url": "https://github.com/frederikfaye",
    "followers_url": "https://api.github.com/users/frederikfaye/followers",
    "following_url": "https://api.github.com/users/frederikfaye/following{/other_user}",
    "gists_url": "https://api.github.com/users/frederikfaye/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frederikfaye/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frederikfaye/subscriptions",
    "organizations_url": "https://api.github.com/users/frederikfaye/orgs",
    "repos_url": "https://api.github.com/users/frederikfaye/repos",
    "events_url": "https://api.github.com/users/frederikfaye/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frederikfaye/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-09-01T18:12:50Z",
  "updated_at": "2019-09-23T12:30:55Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have a CNN model that both take images and scalar variables.\r\nI would like to investigate only the importance of the scalars (not the pixels in the image). \r\n\r\nAs the images are (56,11,4), and the scalars are only (12,) I believe explaining only the scalars would greatly improve speed, so I seek a way to tell the `shap_values` method that I only want the scalars explained. **How can I do this using the KernelExplainer?** (I am using KernelExplainer because my model is a nested Keras model, and I believe that to be incompatible with SHAP as is.)\r\n\r\nA subproblem of trying to explain all features is that the KernelExplainer has problems in its optimization, and gives the `ConvergenceWarning: Regressors in active set degenerate` warning, among others. \r\nI think this would go away if I only tried to explain the 12 scalars.\r\n\r\n```python \r\n    import numpy as np\r\n    import shap\r\n\r\n    # Assume that model, x_imgs, x_scalars are defined\r\n\r\n    x = [x_imgs, x_scalars]\r\n\r\n    # Get shapes for use in model_for_shap()\r\n    x_imgs_shape = x_imgs.shape\r\n    x_scalars_shape = x_scalars.shape\r\n    \r\n    def _flatten_input(x):\r\n        x_img = x[0].reshape(x[0].shape[0],-1)\r\n        x_scalars = x[1].reshape(x[0].shape[0],-1)\r\n        x_concat = np.concatenate((x_img, x_scalars), axis=1)\r\n        return x_concat\r\n    \r\n    x_flat = _flatten_input(x)\r\n    \r\n    def model_for_shap(x_flat):\r\n        # Reshape back into non-flat input before feeding to model\r\n        n_img_features = np.prod(x_imgs_shape[1:])\r\n        x_imgs = x_flat[:,:n_img_features]\r\n        x_scalars = x_flat[:,n_img_features:]\r\n        x_imgs = x_imgs.reshape((x_flat.shape[0],*x_imgs_shape[1:]))\r\n        \r\n        preds = model.predict([x_imgs, x_scalars]).flatten()\r\n        return preds\r\n\r\n    # Explain predictions of the model\r\n    e = shap.KernelExplainer(model_for_shap, x_flat)\r\n    shap_values = e.shap_values(x_flat, nsamples=100)\r\n```\r\n\r\nThanks!",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/788/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/788/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
