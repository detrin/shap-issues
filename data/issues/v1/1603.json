{
  "url": "https://api.github.com/repos/shap/shap/issues/1603",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1603/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1603/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1603/events",
  "html_url": "https://github.com/shap/shap/issues/1603",
  "id": 748539456,
  "node_id": "MDU6SXNzdWU3NDg1Mzk0NTY=",
  "number": 1603,
  "title": "TypeError: object of type 'NoneType' has no len() while using shap on keras",
  "user": {
    "login": "AmirHoseinSafari",
    "id": 54955625,
    "node_id": "MDQ6VXNlcjU0OTU1NjI1",
    "avatar_url": "https://avatars.githubusercontent.com/u/54955625?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AmirHoseinSafari",
    "html_url": "https://github.com/AmirHoseinSafari",
    "followers_url": "https://api.github.com/users/AmirHoseinSafari/followers",
    "following_url": "https://api.github.com/users/AmirHoseinSafari/following{/other_user}",
    "gists_url": "https://api.github.com/users/AmirHoseinSafari/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AmirHoseinSafari/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AmirHoseinSafari/subscriptions",
    "organizations_url": "https://api.github.com/users/AmirHoseinSafari/orgs",
    "repos_url": "https://api.github.com/users/AmirHoseinSafari/repos",
    "events_url": "https://api.github.com/users/AmirHoseinSafari/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AmirHoseinSafari/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-11-23T07:16:05Z",
  "updated_at": "2022-07-29T13:00:03Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\n\r\nI am using Keras and my model is LRCN (a combination of CNN + LSTM). \r\nYou can see my code here:\r\n[https://github.com/AmirHoseinSafari/LRCN-drug-resistance/blob/master/models/Bayesian_optimizer.py](https://github.com/AmirHoseinSafari/LRCN-drug-resistance/blob/master/models/Bayesian_optimizer.py\r\n)\r\nI am trying to run it this way:\r\n\r\n\r\n```\r\n    X_train2 = tf.cast(X_train, tf.float32)\r\n    X_test2 = tf.cast(X_test, tf.float32)\r\n    X_val2 = tf.cast(X_val, tf.float32)\r\n    y_train2 = tf.cast(y_train, tf.float32)\r\n    y_test2 = tf.cast(y_test, tf.float32)\r\n    y_val2 = tf.cast(y_val, tf.float32)\r\n```\r\n\r\n    model.compile(\r\n        loss=masked_loss_function,\r\n        optimizer='Adam',\r\n        metrics=[masked_accuracy]\r\n    )\r\n    \r\n    history = model.fit(\r\n        X_train2,\r\n        y_train2,\r\n        epochs=epochs,\r\n        batch_size=128,\r\n        verbose=2,\r\n        validation_data=(X_val2, y_val2)\r\n    )\r\n\r\n    shap.initjs()\r\n\r\n    explainer = shap.DeepExplainer(model, X_train2[:100])\r\n    shap_values = explainer.shap_values(X_test2[:10])\r\n    shap.summary_plot(shap_values, X_test2, plot_type='bar')`\r\n\r\n\r\nMy model is something like: \r\n```\r\nmodel = Sequential()\r\nmodel.add(Dropout(dropout2_rate))\r\nmodel.add(Conv1D(filters=filterCNN1, kernel_size=kernelCNN1, activation='relu', padding='same'))\r\nmodel.add(MaxPooling1D(pool_size=poolCNN1, padding='same'))\r\nmodel.add(LSTM(LSTM1, return_sequences=False, recurrent_dropout=0.3))\r\nmodel.add(Dropout(dropout2_rate))\r\nmodel.add(Dense(dense_1_neurons))\r\nmodel.add(Dropout(dropout2_rate))\r\nmodel.add(Dense(12, activation='sigmoid'))\r\n```\r\n\r\n\r\nI am getting this error and I couldn't find any way to resolve it. Could you please help me with this?\r\n\r\nHere is the error:\r\n\r\n> keras is no longer supported, please use tf.keras instead.\r\n> Traceback (most recent call last):\r\n>   File \"/Users/amir/PycharmProjects/Lab/LSTM-DR/LSTM-drug-resistance/pipe_line_gene.py\", line 31, in <module>\r\n>     train()\r\n>   File \"/Users/amir/PycharmProjects/Lab/LSTM-DR/LSTM-drug-resistance/pipe_line_gene.py\", line 14, in train\r\n>     model_gene_based.run_bayesian(df_train, labels)\r\n>   File \"/Users/amir/PycharmProjects/Lab/LSTM-DR/LSTM-drug-resistance/models/model_gene_based.py\", line 578, in run_bayesian\r\n>     Bayesian_optimizer.BO(X_train, X_test, X_val, y_train, y_test, y_val, limited, portion)\r\n>   File \"/Users/amir/PycharmProjects/Lab/LSTM-DR/LSTM-drug-resistance/models/Bayesian_optimizer.py\", line 343, in BO\r\n> <IPython.core.display.HTML object>\r\n>     fit_with_partial(dropout2_rate=0.2, dense_1_neurons_x128=1, dense_2_neurons_x128=1, dense_3_neurons_x128=1,\r\n>   File \"/Users/amir/PycharmProjects/Lab/LSTM-DR/LSTM-drug-resistance/models/Bayesian_optimizer.py\", line 192, in fit_with\r\n>     return run_one_fold(model)\r\n>   File \"/Users/amir/PycharmProjects/Lab/LSTM-DR/LSTM-drug-resistance/models/Bayesian_optimizer.py\", line 250, in run_one_fold\r\n>     explainer = shap.DeepExplainer(model, X_train2[:100])\r\n>   File \"/Users/amir/venv/p3/lib/python3.8/site-packages/shap/explainers/_deep/__init__.py\", line 84, in __init__\r\n>     self.explainer = TFDeep(model, data, session, learning_phase_flags)\r\n>   File \"/Users/amir/venv/p3/lib/python3.8/site-packages/shap/explainers/_deep/deep_tf.py\", line 97, in __init__\r\n>     self.model_output = _get_model_output(model)\r\n>   File \"/Users/amir/venv/p3/lib/python3.8/site-packages/shap/explainers/tf_utils.py\", line 83, in _get_model_output\r\n>     if len(model.outputs) > 1:\r\n> TypeError: object of type 'NoneType' has no len()",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1603/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1603/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
