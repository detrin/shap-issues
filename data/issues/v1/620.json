{
  "url": "https://api.github.com/repos/shap/shap/issues/620",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/620/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/620/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/620/events",
  "html_url": "https://github.com/shap/shap/issues/620",
  "id": 450191481,
  "node_id": "MDU6SXNzdWU0NTAxOTE0ODE=",
  "number": 620,
  "title": "TreeExplainer on LightGBM model throws JSONDecode Error",
  "user": {
    "login": "Ashish-Tripathy",
    "id": 6737602,
    "node_id": "MDQ6VXNlcjY3Mzc2MDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6737602?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Ashish-Tripathy",
    "html_url": "https://github.com/Ashish-Tripathy",
    "followers_url": "https://api.github.com/users/Ashish-Tripathy/followers",
    "following_url": "https://api.github.com/users/Ashish-Tripathy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Ashish-Tripathy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Ashish-Tripathy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Ashish-Tripathy/subscriptions",
    "organizations_url": "https://api.github.com/users/Ashish-Tripathy/orgs",
    "repos_url": "https://api.github.com/users/Ashish-Tripathy/repos",
    "events_url": "https://api.github.com/users/Ashish-Tripathy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Ashish-Tripathy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2019-05-30T08:29:33Z",
  "updated_at": "2019-10-01T01:27:07Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi I have trained a LightGBM on my data. But I am unable to create a TreeExplainer on the model.\r\n Please see the code below:\r\n\r\n\r\n```\r\nparams = {\r\n    \"max_bin\": 512,\r\n    \"learning_rate\": 0.05,\r\n    \"boosting_type\": \"gbdt\",\r\n    \"objective\": \"binary\",\r\n    \"metric\": \"binary_logloss\",\r\n    \"num_leaves\": 10,\r\n    \"verbose\": -1,\r\n    \"min_data\": 100,\r\n    \"boost_from_average\": True\r\n}\r\n\r\nmodel = lgb.train(params, d_train, 1000, valid_sets=[d_test], early_stopping_rounds=50, verbose_eval=10)\r\n\r\nshap.initjs()\r\nexplainer = shap.TreeExplainer(model)\r\nshap_values = explainer.shap_values(X)\r\n```\r\n\r\n\r\nError Log:\r\n\r\n```\r\nJSONDecodeError                           Traceback (most recent call last)\r\n<ipython-input-10-ea79d715786a> in <module>\r\n\r\n      2 shap.initjs()\r\n----> 3 explainer = shap.TreeExplainer(model)\r\n      4 shap_values = explainer.shap_values(X)\r\n\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\envs\\work_fstests\\lib\\site-packages\\shap\\explainers\\tree.py in __init__(self, model, data, model_output, feature_dependence)\r\n     94         self.feature_dependence = feature_dependence\r\n     95         self.expected_value = None\r\n---> 96         self.model = TreeEnsemble(model, self.data, self.data_missing)\r\n     97 \r\n     98         assert feature_dependence in feature_dependence_codes, \"Invalid feature_dependence option!\"\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\envs\\work_fstests\\lib\\site-packages\\shap\\explainers\\tree.py in __init__(self, model, data, data_missing)\r\n    534             self.model_type = \"lightgbm\"\r\n    535             self.original_model = model\r\n--> 536             tree_info = self.original_model.dump_model()[\"tree_info\"]\r\n    537             try:\r\n    538                 self.trees = [Tree(e, data=data, data_missing=data_missing) for e in tree_info]\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\envs\\work_fstests\\lib\\site-packages\\lightgbm\\basic.py in dump_model(self, num_iteration, start_iteration)\r\n   2151                 ctypes.byref(tmp_out_len),\r\n   2152                 ptr_string_buffer))\r\n-> 2153         ret = json.loads(string_buffer.value.decode())\r\n   2154         ret['pandas_categorical'] = json.loads(json.dumps(self.pandas_categorical,\r\n   2155                                                           default=json_default_with_numpy))\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\envs\\work_fstests\\lib\\json\\__init__.py in loads(s, encoding, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)\r\n    346             parse_int is None and parse_float is None and\r\n    347             parse_constant is None and object_pairs_hook is None and not kw):\r\n--> 348         return _default_decoder.decode(s)\r\n    349     if cls is None:\r\n    350         cls = JSONDecoder\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\envs\\work_fstests\\lib\\json\\decoder.py in decode(self, s, _w)\r\n    335 \r\n    336         \"\"\"\r\n--> 337         obj, end = self.raw_decode(s, idx=_w(s, 0).end())\r\n    338         end = _w(s, end).end()\r\n    339         if end != len(s):\r\n\r\n~\\AppData\\Local\\Continuum\\anaconda3\\envs\\work_fstests\\lib\\json\\decoder.py in raw_decode(self, s, idx)\r\n    351         \"\"\"\r\n    352         try:\r\n--> 353             obj, end = self.scan_once(s, idx)\r\n    354         except StopIteration as err:\r\n    355             raise JSONDecodeError(\"Expecting value\", s, err.value) from None\r\n\r\nJSONDecodeError: Invalid \\escape: line 9 column 36 (char 205)\r\n\r\n```\r\n\r\nThis is happening only with lightgbm, not with XGboost and CatBoost. Please help to resolve this.\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/620/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/620/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
