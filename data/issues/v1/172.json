{
  "url": "https://api.github.com/repos/shap/shap/issues/172",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/172/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/172/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/172/events",
  "html_url": "https://github.com/shap/shap/issues/172",
  "id": 343455499,
  "node_id": "MDU6SXNzdWUzNDM0NTU0OTk=",
  "number": 172,
  "title": "index problem with interaction .summary_plot",
  "user": {
    "login": "cbeauhilton",
    "id": 34774299,
    "node_id": "MDQ6VXNlcjM0Nzc0Mjk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/34774299?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cbeauhilton",
    "html_url": "https://github.com/cbeauhilton",
    "followers_url": "https://api.github.com/users/cbeauhilton/followers",
    "following_url": "https://api.github.com/users/cbeauhilton/following{/other_user}",
    "gists_url": "https://api.github.com/users/cbeauhilton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cbeauhilton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cbeauhilton/subscriptions",
    "organizations_url": "https://api.github.com/users/cbeauhilton/orgs",
    "repos_url": "https://api.github.com/users/cbeauhilton/repos",
    "events_url": "https://api.github.com/users/cbeauhilton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cbeauhilton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-07-23T00:54:39Z",
  "updated_at": "2018-07-24T02:01:57Z",
  "closed_at": "2018-07-23T16:40:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi! This is a fantastic package --- thank you so much!\r\n\r\nI'm having an issue producing the SHAP interaction values summary plot, as shown in the NHANES example. All the other visualizations are working with no issues. When I use the code from the NHANES notebook, no matter how much I mess with the axis values I get an `IndexError`. I'm sure I'm missing something.\r\n\r\nHere's the code you provided, followed by my modification to fit my dataset.\r\n\r\n`#shap_interaction_values = shap.TreeExplainer(model).shap_interaction_values(X.iloc[:2000,:])\r\n#shap.summary_plot(shap_interaction_values, X.iloc[:2000,:])`\r\n\r\n`shap_interaction_values = shap.TreeExplainer(gbm).shap_interaction_values(features_imputed_df.iloc[:1900,:])\r\nshap.summary_plot(shap_interaction_values, features_imputed_df.iloc[:1900,:])`\r\n\r\nThis throws the error:\r\n\r\n`380         pl.figure(figsize=(1.5 * max_display + 1, 0.8 * max_display + 1))`\r\n`381         pl.subplot(1, max_display, 1)`\r\n`--> 382         proj_shap_values = shap_values[:, sort_inds[0], np.hstack((sort_inds, len(sort_inds)))]`\r\n`383         proj_shap_values[:, 1:] *= 2  # because off diag effects are split in half`\r\n`384         summary_plot(`\r\n`IndexError: index 71 is out of bounds for axis 2 with size 71`\r\n\r\n\r\nHowever, this code for the heatmap style summary plot, where the indices are set with `tmp` and `tmp2`, works with no problems:\r\n\r\n`tmp = np.abs(shap_interaction_values).sum(0)`\r\n`for i in range(tmp.shape[0]):`\r\n`    tmp[i,i] = 0`\r\n`inds = np.argsort(-tmp.sum(0))[:20]`\r\n`tmp2 = tmp[inds,:][:,inds]`\r\n`pl.figure(figsize=(12,12))`\r\n`pl.imshow(tmp2)`\r\n`pl.yticks(range(tmp2.shape[0]), X.columns[inds], rotation=50.4, horizontalalignment=\"right\")`\r\n`pl.xticks(range(tmp2.shape[0]), X.columns[inds], rotation=50.4, horizontalalignment=\"left\")`\r\n`pl.gca().xaxis.tick_top()`\r\n`pl.savefig('interaction value summary.png', dpi=400, transparent=False, bbox_inches='tight')`\r\n`pl.show()`\r\n`pl.close()`\r\n\r\n\r\nI'm using Python 3.7.0, maximally updated lightGBM, mpl, sklearn, etc., on a Windows 10 machine with Jupyter Notebook.",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/172/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/172/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
