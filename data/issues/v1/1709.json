{
  "url": "https://api.github.com/repos/shap/shap/issues/1709",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1709/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1709/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1709/events",
  "html_url": "https://github.com/shap/shap/issues/1709",
  "id": 777381241,
  "node_id": "MDU6SXNzdWU3NzczODEyNDE=",
  "number": 1709,
  "title": "Dimension Mismatch Error from DeepExplainer for Pytorch model",
  "user": {
    "login": "TangYiChing",
    "id": 42478855,
    "node_id": "MDQ6VXNlcjQyNDc4ODU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/42478855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TangYiChing",
    "html_url": "https://github.com/TangYiChing",
    "followers_url": "https://api.github.com/users/TangYiChing/followers",
    "following_url": "https://api.github.com/users/TangYiChing/following{/other_user}",
    "gists_url": "https://api.github.com/users/TangYiChing/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TangYiChing/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TangYiChing/subscriptions",
    "organizations_url": "https://api.github.com/users/TangYiChing/orgs",
    "repos_url": "https://api.github.com/users/TangYiChing/repos",
    "events_url": "https://api.github.com/users/TangYiChing/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TangYiChing/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-01-02T01:06:45Z",
  "updated_at": "2022-04-27T16:55:54Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi, \r\n\r\nWhen I ran **shap_arr = explainer.shap_values(test_X)**, I got the error message:\r\nRuntimeError: The size of tensor a (6998) must match the size of tensor b (3499) at non-singleton dimension 1\r\n\r\nThe error message said it clearly that the size of output does not match with the size of input of the next layer. But, the model architecture below showed that the size of input/output of each layer is perfectly matched, in fact, it can generate prediction result as desired. So, I don't know why and how the runtimeError is triggered by the explainer.shap_values().\r\n\r\nclass FC(tch.nn.Module):\r\n    def __init__(self, n_inputs, n_outputs, dropout_float):\r\n        super(FC, self).__init__()\r\n\r\n        # define layers\r\n        self.hidden1 = tch.nn.Linear(int(n_inputs), int(n_inputs*2))\r\n        self.hidden2 = tch.nn.Linear(int(n_inputs*2), int(n_inputs))\r\n        self.output = tch.nn.Linear(int(n_inputs), int(n_outputs))\r\n\r\n        # define normalization and activation\r\n        self.batchnorm = tch.nn.BatchNorm1d(int(n_inputs))\r\n        self.dropout = tch.nn.Dropout(dropout_float)\r\n        self.activation = tch.nn.ReLU()\r\n\r\n       def forward(self, x):\r\n        x = self.batchnorm(x)\r\n        x = self.dropout( self.activation( self.hidden1(x) )  )\r\n        x = self.dropout( self.activation( self.hidden2(x) )  )\r\n        x = self.output(x)\r\n        #x = self.fnn(x)\r\n        return x\r\n\r\nI tried to modified the model by removing one hidden layer, and becomes\r\n        # define layers\r\n        self.hidden1 = tch.nn.Linear(int(n_inputs), int(n_inputs*2))\r\n        self.output = tch.nn.Linear(int(n_inputs*2), int(n_outputs))\r\n\r\nThis model can pass the runtime error and generate shapley values. Can't SHAP handle multiple hidden layers?\r\nI use pytorch 1.7.1 and shap 0.36.0",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1709/reactions",
    "total_count": 4,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1709/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
