{
  "url": "https://api.github.com/repos/shap/shap/issues/2733",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2733/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2733/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2733/events",
  "html_url": "https://github.com/shap/shap/issues/2733",
  "id": 1414530269,
  "node_id": "I_kwDOBHDcK85UUATd",
  "number": 2733,
  "title": "SHAP values on the partial dependence plot seems to be broken?",
  "user": {
    "login": "mlisovyi",
    "id": 10157590,
    "node_id": "MDQ6VXNlcjEwMTU3NTkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/10157590?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mlisovyi",
    "html_url": "https://github.com/mlisovyi",
    "followers_url": "https://api.github.com/users/mlisovyi/followers",
    "following_url": "https://api.github.com/users/mlisovyi/following{/other_user}",
    "gists_url": "https://api.github.com/users/mlisovyi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mlisovyi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mlisovyi/subscriptions",
    "organizations_url": "https://api.github.com/users/mlisovyi/orgs",
    "repos_url": "https://api.github.com/users/mlisovyi/repos",
    "events_url": "https://api.github.com/users/mlisovyi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mlisovyi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-10-19T08:24:22Z",
  "updated_at": "2022-11-02T13:25:18Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I tried to repeat the basic introduction into [reading shap values from the partial dependence plot](https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html#Reading-SHAP-values-from-partial-dependence-plots).\r\n\r\nThe only 2 changes I've made were:\r\n* increase the size of sample from 100 to 200 (this change is important and leads to wrong visualisation of shap values)\r\n* switch from _MedInc_ to _HouseAge_ feature for visualisation (this change is less important- the plot is also broken for _MedInc_, but it is much less pronounced, supposedly due to better sampling properties)\r\n\r\n<img width=\"517\" alt=\"Screenshot 2022-10-19 at 10 17 09\" src=\"https://user-images.githubusercontent.com/10157590/196635974-8dc1316b-6c3b-41bb-a701-797d255b5efe.png\">\r\n\r\nCan it be that there is the number of samples additionally set to \r\n\r\nThe code is below, `shap` version is 0.41.0\r\n\r\n```python\r\nimport pandas as pd\r\nimport shap\r\nimport sklearn\r\n\r\n# a classic housing price dataset\r\nX,y = shap.datasets.california(n_points=1000)\r\n\r\n # 200 instances for use as the background distribution INSTEAD of 100 in the docs\r\nX200 = shap.utils.sample(X, 200)\r\n\r\n# a simple linear model\r\nmodel = sklearn.linear_model.LinearRegression()\r\nmodel.fit(X, y)\r\n\r\n# compute the SHAP values for the linear model\r\nexplainer = shap.Explainer(model.predict, X200)\r\nshap_values = explainer(X)\r\n\r\n# make a standard partial dependence plot\r\nsample_ind = 20\r\n# use \"HouseAge\" instead of \"MedInc\", as it is less gaussian\r\nshap.partial_dependence_plot(\r\n    \"HouseAge\", model.predict, X200, model_expected_value=True,\r\n    feature_expected_value=True, ice=False,\r\n    shap_values=shap_values[sample_ind:sample_ind+1,:]\r\n)\r\n```\r\n\r\n<details>\r\n  <summary>Full environment definition</summary>\r\n_libgcc_mutex=0.1=conda_forge<br>\r\n_openmp_mutex=4.5=2_gnu<br>\r\nasttokens=2.0.8=pypi_0<br>\r\nbackcall=0.2.0=pypi_0<br>\r\nbzip2=1.0.8=h7f98852_4<br>\r\nca-certificates=2022.9.24=ha878542_0<br>\r\ncloudpickle=2.2.0=pyhd8ed1ab_0<br>\r\ncolorama=0.4.5=pyhd8ed1ab_0<br>\r\ncycler=0.11.0=pyhd8ed1ab_0<br>\r\ndebugpy=1.6.3=pypi_0<br>\r\ndecorator=5.1.1=pypi_0<br>\r\nentrypoints=0.4=pypi_0<br>\r\nexecuting=1.1.1=pypi_0<br>\r\nfreetype=2.12.1=hca18f0e_0<br>\r\nicu=67.1=he1b5a44_0<br>\r\nimportlib-metadata=4.11.4=py38h578d9bd_0<br>\r\nipykernel=6.16.0=pypi_0<br>\r\nipython=8.5.0=pypi_0<br>\r\njedi=0.18.1=pypi_0<br>\r\njoblib=1.2.0=pyhd8ed1ab_0<br>\r\njupyter-client=7.4.2=pypi_0<br>\r\njupyter-core=4.11.1=pypi_0<br>\r\nkiwisolver=1.4.4=py38h43d8883_0<br>\r\nld_impl_linux-64=2.39=hc81fddc_0<br>\r\nlibblas=3.9.0=16_linux64_openblas<br>\r\nlibcblas=3.9.0=16_linux64_openblas<br>\r\nlibffi=3.4.2=h7f98852_5<br>\r\nlibgcc-ng=12.2.0=h65d4601_18<br>\r\nlibgfortran-ng=12.2.0=h69a702a_18<br>\r\nlibgfortran5=12.2.0=h337968e_18<br>\r\nlibgomp=12.2.0=h65d4601_18<br>\r\nliblapack=3.9.0=16_linux64_openblas<br>\r\nlibllvm11=11.1.0=he0ac6c6_4<br>\r\nlibnsl=2.0.0=h7f98852_0<br>\r\nlibopenblas=0.3.21=pthreads_h78a6416_3<br>\r\nlibpng=1.6.38=h753d276_0<br>\r\nlibsqlite=3.39.4=h753d276_0<br>\r\nlibstdcxx-ng=12.2.0=h46fd767_18<br>\r\nlibuuid=2.32.1=h7f98852_1000<br>\r\nlibzlib=1.2.13=h166bdaf_4<br>\r\nllvmlite=0.39.1=py38h38d86a4_0<br>\r\nmatplotlib=3.2.2=1<br>\r\nmatplotlib-base=3.2.2=py38h5d868c9_1<br>\r\nmatplotlib-inline=0.1.6=pypi_0<br>\r\nncurses=6.3=h27087fc_1<br>\r\nnest-asyncio=1.5.6=pypi_0<br>\r\nnumba=0.56.3=py38h9a4aae9_0<br>\r\nnumpy=1.23.4=py38h7042d01_0<br>\r\nopenssl=3.0.5=h166bdaf_2<br>\r\npackaging=21.3=pyhd8ed1ab_0<br>\r\npandas=1.5.0=py38h8f669ce_0<br>\r\nparso=0.8.3=pypi_0<br>\r\npexpect=4.8.0=pypi_0<br>\r\npickleshare=0.7.5=pypi_0<br>\r\npip=22.3=pyhd8ed1ab_0<br>\r\nprompt-toolkit=3.0.31=pypi_0<br>\r\npsutil=5.9.3=pypi_0<br>\r\nptyprocess=0.7.0=pypi_0<br>\r\npure-eval=0.2.2=pypi_0<br>\r\npygments=2.13.0=pypi_0<br>\r\npyparsing=3.0.9=pyhd8ed1ab_0<br>\r\npython=3.8.13=ha86cf86_0_cpython<br>\r\npython-dateutil=2.8.2=pyhd8ed1ab_0<br>\r\npython_abi=3.8=2_cp38<br>\r\npytz=2022.4=pyhd8ed1ab_0<br>\r\npyzmq=24.0.1=pypi_0<br>\r\nreadline=8.1.2=h0f457ee_0<br>\r\nscikit-learn=1.1.2=py38h0b08f9b_0<br>\r\nscipy=1.9.1=py38hea3f02b_0<br>\r\nsetuptools=65.5.0=pyhd8ed1ab_0<br>\r\nshap=0.41.0=py38h47df419_0<br>\r\nsix=1.16.0=pyh6c4a22f_0<br>\r\nslicer=0.0.7=pyhd8ed1ab_0<br>\r\nsqlite=3.39.4=h4ff8645_0<br>\r\nstack-data=0.5.1=pypi_0<br>\r\nthreadpoolctl=3.1.0=pyh8a188c0_0<br>\r\ntk=8.6.12=h27826a3_0<br>\r\ntornado=6.2=py38h0a891b7_0<br>\r\ntqdm=4.64.1=pyhd8ed1ab_0<br>\r\ntraitlets=5.5.0=pypi_0<br>\r\nwcwidth=0.2.5=pypi_0<br>\r\nwheel=0.37.1=pyhd8ed1ab_0<br>\r\nxz=5.2.6=h166bdaf_0<br>\r\nzipp=3.9.0=pyhd8ed1ab_0<br>\r\n</details>",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2733/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2733/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
