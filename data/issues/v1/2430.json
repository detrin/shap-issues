{
  "url": "https://api.github.com/repos/shap/shap/issues/2430",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2430/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2430/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2430/events",
  "html_url": "https://github.com/shap/shap/issues/2430",
  "id": 1169160517,
  "node_id": "I_kwDOBHDcK85Fr_lF",
  "number": 2430,
  "title": "RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn",
  "user": {
    "login": "gonkillu",
    "id": 98017139,
    "node_id": "U_kgDOBdefcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/98017139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gonkillu",
    "html_url": "https://github.com/gonkillu",
    "followers_url": "https://api.github.com/users/gonkillu/followers",
    "following_url": "https://api.github.com/users/gonkillu/following{/other_user}",
    "gists_url": "https://api.github.com/users/gonkillu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gonkillu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gonkillu/subscriptions",
    "organizations_url": "https://api.github.com/users/gonkillu/orgs",
    "repos_url": "https://api.github.com/users/gonkillu/repos",
    "events_url": "https://api.github.com/users/gonkillu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gonkillu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-03-15T04:10:00Z",
  "updated_at": "2023-05-15T15:45:34Z",
  "closed_at": "2022-03-15T07:33:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "batch_x, batch_x_mark, dec_inp, batch_y_mark are the inputs of my model. Their type is torch.tensor and all the elements are float. \r\nWhen I run the code as follows: \r\n```\r\ninput_ = [batch_x, batch_x_mark, dec_inp, batch_y_mark]\r\nex = self.explain(self.model, input_)  \r\nprint(ex)                        \r\nex_values = ex.shap_values(input_)\r\nprint(ex_values)\r\n```\r\n\r\nIt gives me: \r\n```\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/lib/python3.7/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/opt/conda/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/root/.vscode-server/extensions/ms-python.python-2022.2.1924087327/pythonFiles/lib/python/debugpy/__main__.py\", line 45, in <module>\r\n    cli.main()\r\n  File \"/root/.vscode-server/extensions/ms-python.python-2022.2.1924087327/pythonFiles/lib/python/debugpy/../debugpy/server/cli.py\", line 444, in main\r\n    run()\r\n  File \"/root/.vscode-server/extensions/ms-python.python-2022.2.1924087327/pythonFiles/lib/python/debugpy/../debugpy/server/cli.py\", line 285, in run_file\r\n    runpy.run_path(target_as_str, run_name=compat.force_str(\"__main__\"))\r\n  File \"/opt/conda/lib/python3.7/runpy.py\", line 263, in run_path\r\n    pkg_name=pkg_name, script_name=fname)\r\n  File \"/opt/conda/lib/python3.7/runpy.py\", line 96, in _run_module_code\r\n    mod_name, mod_spec, pkg_name, script_name)\r\n  File \"/opt/conda/lib/python3.7/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/workspace/Autoformer-modify/run.py\", line 119, in <module>\r\n    exp.test(setting, test=1)\r\n  File \"/workspace/Autoformer-modify/exp/exp_main.py\", line 262, in test\r\n    ex_values = ex.shap_values(input_)\r\n  File \"/opt/conda/lib/python3.7/site-packages/shap/explainers/_deep/__init__.py\", line 124, in shap_values\r\n    return self.explainer.shap_values(X, ranked_outputs, output_rank_order, check_additivity=check_additivity)\r\n  File \"/opt/conda/lib/python3.7/site-packages/shap/explainers/_deep/deep_pytorch.py\", line 185, in shap_values\r\n    sample_phis = self.gradient(feature_ind, joint_x)\r\n  File \"/opt/conda/lib/python3.7/site-packages/shap/explainers/_deep/deep_pytorch.py\", line 123, in gradient\r\n    allow_unused=True)[0]\r\n  File \"/opt/conda/lib/python3.7/site-packages/torch/autograd/__init__.py\", line 228, in grad\r\n    inputs, allow_unused, accumulate_grad=False)\r\nRuntimeError: element 0 of tensors does not require grad and does not have a grad_fn\r\n``` \r\nI've tried this:\r\n```\r\ninput_ = [Variable(batch_x, requires_grad=True),Variable(batch_x_mark, requires_grad=True),Variable(dec_inp, requires_grad=True),Variable(batch_y_mark, requires_grad=True)]\r\nex = self.explain(self.model, input_)\r\n```\r\nBut it doesn't work.\r\n\r\nIs there any solution please?\r\n\r\nI have solved it. It is because I have \r\n```\r\nwith torch.no_grad():\r\n```\r\nbefore the codes.",
  "closed_by": {
    "login": "gonkillu",
    "id": 98017139,
    "node_id": "U_kgDOBdefcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/98017139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gonkillu",
    "html_url": "https://github.com/gonkillu",
    "followers_url": "https://api.github.com/users/gonkillu/followers",
    "following_url": "https://api.github.com/users/gonkillu/following{/other_user}",
    "gists_url": "https://api.github.com/users/gonkillu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gonkillu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gonkillu/subscriptions",
    "organizations_url": "https://api.github.com/users/gonkillu/orgs",
    "repos_url": "https://api.github.com/users/gonkillu/repos",
    "events_url": "https://api.github.com/users/gonkillu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gonkillu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2430/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2430/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
