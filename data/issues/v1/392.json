{
  "url": "https://api.github.com/repos/shap/shap/issues/392",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/392/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/392/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/392/events",
  "html_url": "https://github.com/shap/shap/issues/392",
  "id": 398833316,
  "node_id": "MDU6SXNzdWUzOTg4MzMzMTY=",
  "number": 392,
  "title": "Meaning of the Sum of Shapley Values",
  "user": {
    "login": "FabianSchuetze",
    "id": 10357496,
    "node_id": "MDQ6VXNlcjEwMzU3NDk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/10357496?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/FabianSchuetze",
    "html_url": "https://github.com/FabianSchuetze",
    "followers_url": "https://api.github.com/users/FabianSchuetze/followers",
    "following_url": "https://api.github.com/users/FabianSchuetze/following{/other_user}",
    "gists_url": "https://api.github.com/users/FabianSchuetze/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/FabianSchuetze/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FabianSchuetze/subscriptions",
    "organizations_url": "https://api.github.com/users/FabianSchuetze/orgs",
    "repos_url": "https://api.github.com/users/FabianSchuetze/repos",
    "events_url": "https://api.github.com/users/FabianSchuetze/events{/privacy}",
    "received_events_url": "https://api.github.com/users/FabianSchuetze/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-01-14T10:46:22Z",
  "updated_at": "2019-01-24T15:08:42Z",
  "closed_at": "2019-01-19T01:06:36Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Can somebody kindly explain to me what the sum of the Shapley values represent? \r\n\r\n I used the following code to predict whether a handwritten digit equals `5` with lightgbm. I then create an instance of the `shap.tree_explainer` object with the following arguments: `model_output: probability` and `feature_dependence = independent`. From reading the[ documentation](https://shap.readthedocs.io/en/latest/) I understand the following: \r\n\r\n> If “probability” then we explain the output of the model transformed into probability space (note that this means the SHAP values now sum to the probability output of the model)` \r\n\r\nand \r\n\r\n> Currently the probability and log_loss options are only supported when feature_dependence=”independent”.`.\r\n\r\nHowever, when I calculate shap_values, the maximum shape value is 19 whilst the maximum prediction of the lightgbm model is 1. Can somebody kindly explain to me what the shap_values mean in this instance here? I seem to misunderstand the documentation. \r\n\r\nHere is the code I used:\r\n\r\n    from sklearn.datasets import load_digits\r\n    import lightgbm as lbm\r\n    import shap\r\n\r\n    digits = load_digits()\r\n    X = digits['data']\r\n    Y = digits['target']\r\n    Y = (Y == 5).astype(int)\r\n    dtrain = lbm.Dataset(X, Y)\r\n\r\n    PARAM = {'task':'train', 'boosting_type': 'gbrt',\r\n             'objective': 'binary',\r\n             'metric': 'auc',\r\n             'verbose':-1}\r\n\r\n    bst = lbm.train(PARAM, dtrain, num_boost_round=100, verbose_eval=False)\r\n    explainer = shap.TreeExplainer(bst, model_output='probability',\r\n                                   feature_dependence='independent')\r\n    shap_values = explainer.shap_values(X)\r\n\r\n\r\n    print('The min and max predicted values are %f %f'\\\r\n            %(bst.predict(X).min(), bst.predict(X).max()))\r\n\r\n    print('The max of the sum of shapley_values is %f'\\\r\n            %shap_values.sum(axis=1).max())\r\n\r\nThe issue might be related to issue #168 ",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/392/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/392/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
