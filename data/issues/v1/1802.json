{
  "url": "https://api.github.com/repos/shap/shap/issues/1802",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1802/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1802/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1802/events",
  "html_url": "https://github.com/shap/shap/pull/1802",
  "id": 802364437,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NTY4NTIwMDI0",
  "number": 1802,
  "title": "Update setup.py ",
  "user": {
    "login": "mkretsch327",
    "id": 35462293,
    "node_id": "MDQ6VXNlcjM1NDYyMjkz",
    "avatar_url": "https://avatars.githubusercontent.com/u/35462293?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mkretsch327",
    "html_url": "https://github.com/mkretsch327",
    "followers_url": "https://api.github.com/users/mkretsch327/followers",
    "following_url": "https://api.github.com/users/mkretsch327/following{/other_user}",
    "gists_url": "https://api.github.com/users/mkretsch327/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mkretsch327/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mkretsch327/subscriptions",
    "organizations_url": "https://api.github.com/users/mkretsch327/orgs",
    "repos_url": "https://api.github.com/users/mkretsch327/repos",
    "events_url": "https://api.github.com/users/mkretsch327/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mkretsch327/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 18,
  "created_at": "2021-02-05T18:00:04Z",
  "updated_at": "2023-06-03T02:18:48Z",
  "closed_at": "2023-06-03T02:18:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/shap/shap/pulls/1802",
    "html_url": "https://github.com/shap/shap/pull/1802",
    "diff_url": "https://github.com/shap/shap/pull/1802.diff",
    "patch_url": "https://github.com/shap/shap/pull/1802.patch",
    "merged_at": null
  },
  "body": "Hi @slundberg,\r\nFirst, I want to thank you for maintaining this project. Itâ€™s been incredibly useful over the last few years! \r\n\r\nThe initial motivation for this PR was the recent version bump of Numpy to v1.20.0, which coincided with a change to their C API ([table of versions in numpy's source code](https://github.com/numpy/numpy/blob/6373ded2ed1403cc3ec40dc5d919b316a1b58e44/numpy/core/setup_common.py#L44)). \r\n\r\nA reproducible version of this issue is observed with the following:\r\n1) Install requirements in an empty virtual environment - `pip install -r requirements.txt`, with a requirements.txt of: \r\n```\r\nnumpy==1.19.3\r\nshap==0.36\r\n```\r\n2) Once installation is finished, importing shap causes the following runtime error:\r\n```\r\nPython 3.8.5 (default, Sep  4 2020, 07:30:14) \r\n[GCC 7.3.0] :: Anaconda, Inc. on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import shap\r\nRuntimeError: module compiled against API version 0xe but this version of numpy is 0xd\r\n```\r\n\r\nThis problem has manifested itself in the past when numpy's C api version has changed( [link to mapping](https://stackoverflow.com/questions/49756080/opencv-numpy-issue-module-compiled-against-api-version-x-but-this-version-of-n/49756785#49756785)), and often manifests with the below error (taken from my stack trace), also seen in #382  and #381:\r\n```\r\n  File \"/miniconda/envs/test_env/lib/python3.8/site-packages/shap/explainers/_tree.py\", line 143, in __init__\r\n    self.model = TreeEnsemble(model, self.data, self.data_missing, model_output)\r\n  File \"/miniconda/envs/test_env/lib/python3.8/site-packages/shap/explainers/_tree.py\", line 825, in __init__\r\n    self.trees = xgb_loader.get_trees(data=data, data_missing=data_missing)\r\n  File \"/miniconda/envs/test_env/lib/python3.8/site-packages/shap/explainers/_tree.py\", line 1504, in get_trees\r\n    trees.append(SingleTree({\r\n  File \"/miniconda/envs/test_env/lib/python3.8/site-packages/shap/explainers/_tree.py\", line 1109, in __init__\r\n    assert_import(\"cext\")\r\n  File \"/miniconda/envs/test_env/lib/python3.8/site-packages/shap/utils/_general.py\", line 23, in assert_import\r\n    raise e\r\n  File \"/miniconda/envs/test_env/lib/python3.8/site-packages/shap/explainers/_tree.py\", line 23, in <module>\r\n    from .. import _cext\r\nImportError: numpy.core.multiarray failed to import\r\n```  \r\n\r\nWhile it often is resolved by uninstalling and re-installing `shap`, I don't believe this prevents the issue from occurring in the first place, as such an installation is broken when leveraging a `requirements.txt` file.\r\n\r\nThe culprit appears to be the specification of `numpy` within the setup_requires argument of setup in `setup.py`.\r\n\r\nThe fix proposed here is to bound the `numpy` version to the latest stable release available *at `shap` release time*.  In addition to fixing the above mentioned observed error, this will also help with the current behavior observed when installing an older version of `shap` in isolation. As an example, I'd expect `shap==0.36` to be installed and setup against `numpy 1.19.2` , but as of today, it's done against `numpy `1.20.0`.\r\n\r\nLook forward to hearing your thoughts and comments!",
  "closed_by": {
    "login": "thatlittleboy",
    "id": 30731072,
    "node_id": "MDQ6VXNlcjMwNzMxMDcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thatlittleboy",
    "html_url": "https://github.com/thatlittleboy",
    "followers_url": "https://api.github.com/users/thatlittleboy/followers",
    "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
    "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
    "repos_url": "https://api.github.com/users/thatlittleboy/repos",
    "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1802/reactions",
    "total_count": 4,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1802/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
