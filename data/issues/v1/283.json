{
  "url": "https://api.github.com/repos/shap/shap/issues/283",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/283/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/283/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/283/events",
  "html_url": "https://github.com/shap/shap/issues/283",
  "id": 369376042,
  "node_id": "MDU6SXNzdWUzNjkzNzYwNDI=",
  "number": 283,
  "title": "Some questions about the calculation using tree SHAP",
  "user": {
    "login": "ZiwenYeee",
    "id": 42403302,
    "node_id": "MDQ6VXNlcjQyNDAzMzAy",
    "avatar_url": "https://avatars.githubusercontent.com/u/42403302?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZiwenYeee",
    "html_url": "https://github.com/ZiwenYeee",
    "followers_url": "https://api.github.com/users/ZiwenYeee/followers",
    "following_url": "https://api.github.com/users/ZiwenYeee/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZiwenYeee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZiwenYeee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZiwenYeee/subscriptions",
    "organizations_url": "https://api.github.com/users/ZiwenYeee/orgs",
    "repos_url": "https://api.github.com/users/ZiwenYeee/repos",
    "events_url": "https://api.github.com/users/ZiwenYeee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZiwenYeee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-10-12T02:34:58Z",
  "updated_at": "2018-10-19T18:32:33Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "![image](https://user-images.githubusercontent.com/42403302/46842306-88c88f80-cdff-11e8-9c2e-0f441253fb6b.png)\r\n\r\nHi Scott,\r\nI think it's easy for you but I'm still confused by the calculation :( , it's very appreciated if you can help me.\r\n\r\nI'm trying to figure out how to calculate shapley value under tree model, and my calculation is as follow,do I understand shapley value in a right way? If I'm right, I have some questions about the expectation using in the calculation.\r\n\r\n-----------------------------------------------------------------------------------\r\nexample with RM = 6.421 LSTAT = 9.14\r\n-----------------------------------------------------------------------------------\r\nthe calculation of feature RM\r\n----------------------------------------------------\r\nS = {} / S = {LSTAT}\r\n\r\n1. S = {}\r\nf(S) = (46/506 * 32.113043 + 30/506 * 45.096667) + 255/506 * 23.349804 + 175/506 * 14.956\r\nf(S^{RM}) = 255/430 * 23.349804 + 175/430 * 14.956\r\nphi(RM)(0) = 1/2 * (255/430 * 23.349804 + 175/430 * 14.956 - ((46/506 * 32.113043 + 30/506 * 45.096667) + 255/506 * 23.349804 + 175/506 * 14.956))\r\n\r\n2. S = {LSTAT}\r\nf(S) = 430/506 * 23.349804 + (46/506 * 32.113043 + 30/506 * 45.096667)\r\nf(S^{RM}) = 23.349804\r\nphi(RM)(1) = 1/2 * (23.349804 - (430/506 * 23.349804 + (46/506 * 32.113043 + 30/506 * 45.096667)))\r\n\r\nphi(RM)(0) + phi(RM)(1) = -2.342542\r\n\r\nthe calculation of feature LSTAT\r\n----------------------------------------------------------------------------------------------\r\n1. S = {}\r\nf(S) = 430/506 * (0.593023 * 23.349804 + 0.406977 * 14.956)\r\n     = 430/506 * (255/430 * 23.349804 + 175/430 * 14.956)\r\n     \r\nf(S^{LSTAT}) = 430/506 * (23.349804)\r\nphi(LSTAT)(0) = 1/2 * [430/506 * (23.349804) - 430/560 * (0.593023 * 23.349804 + 0.406977 * 14.956)]\r\n           = 1/2 * 430/506 * [23.349804 - (0.593023 * 23.349804 + 0.406977 * 14.956)]\r\n           = 1/2 * 430/506 * [23.349804 - (255/430 * 23.349804 + 175/430 * 14.956)]\r\n2. S= {RM}\r\nf(S) = (0.593023 * 23.349804 + 0.406977 * 14.956)\r\nf(S^{LSTAT}) = (23.349804)\r\nphi(LSTAT){1} = 1/2 * (23.349804 - [0.593023 * 23.349804 + 0.406977 * 14.956])\r\n\r\nphi(LSTAT) =  1/2 * 430/506 * [23.349804 - (255/430 * 23.349804 + 175/430 * 14.956)] \r\n           +  1/2 * (23.349804 - [0.593023 * 23.349804 + 0.406977 * 14.956]) = 3.159539\r\n\r\nIf I'm right, when I calculate the shapley value of feature RM, in the subset {LSTAT}, the effect of LSTAT is to decide whether the data point turn to left leaf or right leaf, so the f(S) can be replaced the expectation of left leaf or right leaf?  when I calculate the subset {LSTAT}, is it the same as the figure as follow?\r\n![image](https://user-images.githubusercontent.com/42403302/46844390-62a7ed00-ce09-11e8-99b1-5298ae965d95.png)\r\n\r\nAlso, when I calculate the effects of subset {RM}, is it same as the figure as follow?\r\n![image](https://user-images.githubusercontent.com/42403302/46844494-eb268d80-ce09-11e8-93ab-ebaf88a0575d.png)\r\n\r\n\r\n\r\n\r\nAlso, I've find out that the expectation is not as same as the value output from model, it's the expectation multiply weights(the all samples distributed in the each leaf/all samples), why do you multiply weights in each condition distribution? It seems reasonable but I'm still trying to persuade me in a theoretical way. \r\n\r\nLastly, I think the shapley value of the data point distributed in the same region divided by tree is equal, is it right? \r\n\r\n\r\nThanks & Regards.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/283/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/283/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
