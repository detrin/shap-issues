{
  "url": "https://api.github.com/repos/shap/shap/issues/636",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/636/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/636/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/636/events",
  "html_url": "https://github.com/shap/shap/issues/636",
  "id": 453769319,
  "node_id": "MDU6SXNzdWU0NTM3NjkzMTk=",
  "number": 636,
  "title": "Restore predictions with KernelExplainer shap_values + logit link",
  "user": {
    "login": "AnastasiaTamazlykar",
    "id": 10364719,
    "node_id": "MDQ6VXNlcjEwMzY0NzE5",
    "avatar_url": "https://avatars.githubusercontent.com/u/10364719?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AnastasiaTamazlykar",
    "html_url": "https://github.com/AnastasiaTamazlykar",
    "followers_url": "https://api.github.com/users/AnastasiaTamazlykar/followers",
    "following_url": "https://api.github.com/users/AnastasiaTamazlykar/following{/other_user}",
    "gists_url": "https://api.github.com/users/AnastasiaTamazlykar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AnastasiaTamazlykar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AnastasiaTamazlykar/subscriptions",
    "organizations_url": "https://api.github.com/users/AnastasiaTamazlykar/orgs",
    "repos_url": "https://api.github.com/users/AnastasiaTamazlykar/repos",
    "events_url": "https://api.github.com/users/AnastasiaTamazlykar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AnastasiaTamazlykar/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-06-08T08:07:12Z",
  "updated_at": "2019-06-19T23:41:51Z",
  "closed_at": "2019-06-19T23:40:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello. First of all, thanks @slundberg and all contributors for this library.\r\nI have a question about KernelExplainer shap_values with non identity link. So \r\n(0)`sum(shap_values) + base_value = prediction`.\r\n If we apply link (say logit) then\r\n(1) `sum(shap_values) + base_value = logit(prediction).`\r\nHence \r\n(2) `expit(sum(shap_values) + base_value) = prediction.`\r\nWith KernelExplainer should i take as base_value `logit(KernelExplainer.expected_value)` to restore predictions? Because it seems that expected_value is original model prediction, not transformed. Please, correct me if i m wrong here. \r\n\r\nNote: tried to follow `force_plot` logic to restore preds\r\n\r\nExample:\r\n```\r\nX_train, X_test, Y_train, Y_test = train_test_split(*shap.datasets.iris(), test_size=0.1, random_state=0)\r\n    svm = SVC(kernel='rbf', probability=True)\r\n    svm.fit(X_train, Y_train)\r\n\r\n    row = X_test[0]\r\n\r\n    pred = svm.predict_proba(row)\r\n    expl = KernelExplainer(svm.predict_proba, X_train, link='logit')\r\n    shap = expl.shap_values(row, nsamples=100)\r\n    shap_pred = expit(expl.expected_value[0] + shap[0].sum())\r\n    assert not np.allclose(pred[0][0], shap_pred)\r\n\r\n    shap_pred2 = expit(logit(expl.expected_value[0]) + shap[0].sum())\r\n    assert np.allclose(pred[0][0],shap_pred2)\r\n```\r\nThanks, Anastasiia\r\n",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/636/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/636/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
