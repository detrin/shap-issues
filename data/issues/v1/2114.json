{
  "url": "https://api.github.com/repos/shap/shap/issues/2114",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2114/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2114/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2114/events",
  "html_url": "https://github.com/shap/shap/issues/2114",
  "id": 955217244,
  "node_id": "MDU6SXNzdWU5NTUyMTcyNDQ=",
  "number": 2114,
  "title": "AttributeError: 'TFDeep' object has no attribute 'between_tensors'",
  "user": {
    "login": "wenbostar",
    "id": 5302110,
    "node_id": "MDQ6VXNlcjUzMDIxMTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5302110?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wenbostar",
    "html_url": "https://github.com/wenbostar",
    "followers_url": "https://api.github.com/users/wenbostar/followers",
    "following_url": "https://api.github.com/users/wenbostar/following{/other_user}",
    "gists_url": "https://api.github.com/users/wenbostar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wenbostar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wenbostar/subscriptions",
    "organizations_url": "https://api.github.com/users/wenbostar/orgs",
    "repos_url": "https://api.github.com/users/wenbostar/repos",
    "events_url": "https://api.github.com/users/wenbostar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wenbostar/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-07-28T20:40:29Z",
  "updated_at": "2022-12-21T11:36:38Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I tried to use shap (version 0.39.0) to explain a TF model (TF version 2.4.2) but got the following error:\r\n\r\n```\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/shap/explainers/_deep/deep_tf.py:243 grad_graph  *\r\n        out = self.model(shap_rAnD)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/engine/base_layer.py:1012 __call__  **\r\n        outputs = call_fn(inputs, *args, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/engine/sequential.py:375 call\r\n        return super(Sequential, self).call(inputs, training=training, mask=mask)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/engine/functional.py:425 call\r\n        inputs, training=training, mask=mask)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/engine/functional.py:560 _run_internal_graph\r\n        outputs = node.layer(*args, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/layers/wrappers.py:539 __call__\r\n        return super(Bidirectional, self).__call__(inputs, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/engine/base_layer.py:1012 __call__\r\n        outputs = call_fn(inputs, *args, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/layers/wrappers.py:653 call\r\n        initial_state=forward_state, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/layers/recurrent.py:660 __call__\r\n        return super(RNN, self).__call__(inputs, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/engine/base_layer.py:1012 __call__\r\n        outputs = call_fn(inputs, *args, **kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/layers/recurrent_v2.py:471 call\r\n        inputs, initial_state, training, mask, row_lengths)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/layers/recurrent_v2.py:547 _defun_gru_call\r\n        **normal_gru_kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/keras/layers/recurrent_v2.py:842 gru_with_backend_selection\r\n        function.register(defun_gpu_gru, **params)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/eager/function.py:3390 register\r\n        concrete_func.add_gradient_functions_to_graph()\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/eager/function.py:2057 add_gradient_functions_to_graph\r\n        self._delayed_rewrite_functions.forward_backward())\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/eager/function.py:631 forward_backward\r\n        forward, backward = self._construct_forward_backward(num_doutputs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/eager/function.py:679 _construct_forward_backward\r\n        func_graph=backwards_graph)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py:990 func_graph_from_py_func\r\n        func_outputs = python_func(*func_args, **func_kwargs)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/eager/function.py:669 _backprop_function\r\n        src_graph=self._func_graph)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/ops/gradients_util.py:684 _GradientsHelper\r\n        lambda: grad_fn(op, *out_grads))\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/ops/gradients_util.py:340 _MaybeCompile\r\n        return grad_fn()  # Exit early\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/tensorflow/python/ops/gradients_util.py:684 <lambda>\r\n        lambda: grad_fn(op, *out_grads))\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/shap/explainers/_deep/deep_tf.py:371 custom_grad\r\n        out = op_handlers[type_name](self, op, *grads) # we cut off the shap_ prefex before the lookup\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/shap/explainers/_deep/deep_tf.py:660 handler\r\n        return linearity_with_excluded_handler(input_inds, explainer, op, *grads)\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/shap/explainers/_deep/deep_tf.py:667 linearity_with_excluded_handler\r\n        assert not explainer._variable_inputs(op)[i], str(i) + \"th input to \" + op.name + \" cannot vary!\"\r\n    /home/test/software/anaconda3/envs/tf2/lib/python3.7/site-packages/shap/explainers/_deep/deep_tf.py:220 _variable_inputs\r\n        out[i] = t.name in self.between_tensors\r\n\r\n    AttributeError: 'TFDeep' object has no attribute 'between_tensors'\r\n\r\n```\r\n\r\nDoes anyone know how to fix this?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2114/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2114/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
