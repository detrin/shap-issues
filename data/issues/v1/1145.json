{
  "url": "https://api.github.com/repos/shap/shap/issues/1145",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1145/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1145/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1145/events",
  "html_url": "https://github.com/shap/shap/issues/1145",
  "id": 596667409,
  "node_id": "MDU6SXNzdWU1OTY2Njc0MDk=",
  "number": 1145,
  "title": "Force_plot function with link=logit displays incorrect results for feature importance",
  "user": {
    "login": "ehuijzer",
    "id": 23448081,
    "node_id": "MDQ6VXNlcjIzNDQ4MDgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/23448081?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ehuijzer",
    "html_url": "https://github.com/ehuijzer",
    "followers_url": "https://api.github.com/users/ehuijzer/followers",
    "following_url": "https://api.github.com/users/ehuijzer/following{/other_user}",
    "gists_url": "https://api.github.com/users/ehuijzer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ehuijzer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ehuijzer/subscriptions",
    "organizations_url": "https://api.github.com/users/ehuijzer/orgs",
    "repos_url": "https://api.github.com/users/ehuijzer/repos",
    "events_url": "https://api.github.com/users/ehuijzer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ehuijzer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-04-08T15:30:53Z",
  "updated_at": "2020-04-23T15:59:43Z",
  "closed_at": "2020-04-23T15:59:43Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Description**\r\nForce_plot does not display correct feature importance in case of link=logit\r\n- identical logit shap values result in different importance\r\n- base value + feature importance effects <> output value\r\n\r\n**Steps/Code to Reproduce**\r\n```\r\nimport shap\r\nimport numpy as np\r\nshap.force_plot(base_value=-3,\r\n                shap_values=np.array([1,1,-1]),\r\n                feature_names=['PosFeat1', 'PosFeat2', 'NegFeat1'],\r\n                matplotlib=True,\r\n                link=\"logit\")\r\n```\r\n![afbeelding](https://user-images.githubusercontent.com/23448081/78800094-562f3100-79bb-11ea-95cc-f69a426bc4da.png)\r\n\r\n**Expected Results**\r\nPosFeat1, PosFeat2 and NegFeat1 all have exactly the same shap value (either positive or negative).\r\nEach feature is represented by same size effect in plot.\r\nDifference in length of negative and positive effects should equal difference base value vs output value\r\n\r\n**Actual Results**\r\nPosFeat2 effect is smaller than PosFeat1 effect.\r\nSum PosFeat effect - NegFeat1 effect < Output value - Base value\r\n\r\n**Analysis**\r\nLogit function is not linear, therefore the calculation of the effect is dependent of the order (and base value) of the calculation.\r\n\r\n**Proposed solution**\r\n1. Approximate the logistic function by a linear function\r\n2. Calculate the slope: (proba output value - proba base value) / sum shap values\r\n(Special case sum=0; use derivative of logistic: exp(shap) / (exp(shap) + 1)^2\r\n3. Multiply all shap values by the slope\r\n\r\nThis way identical shap values result in identical probability effects.\r\nBase value and feature effects sum up to the output value.",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1145/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1145/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
