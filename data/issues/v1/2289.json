{
  "url": "https://api.github.com/repos/shap/shap/issues/2289",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2289/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2289/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2289/events",
  "html_url": "https://github.com/shap/shap/issues/2289",
  "id": 1063302773,
  "node_id": "I_kwDOBHDcK84_YLZ1",
  "number": 2289,
  "title": "Waterfall plot doesn't work with uncertainty CatBoostRegressor model",
  "user": {
    "login": "giovannistefanello",
    "id": 81815095,
    "node_id": "MDQ6VXNlcjgxODE1MDk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/81815095?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/giovannistefanello",
    "html_url": "https://github.com/giovannistefanello",
    "followers_url": "https://api.github.com/users/giovannistefanello/followers",
    "following_url": "https://api.github.com/users/giovannistefanello/following{/other_user}",
    "gists_url": "https://api.github.com/users/giovannistefanello/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/giovannistefanello/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/giovannistefanello/subscriptions",
    "organizations_url": "https://api.github.com/users/giovannistefanello/orgs",
    "repos_url": "https://api.github.com/users/giovannistefanello/repos",
    "events_url": "https://api.github.com/users/giovannistefanello/events{/privacy}",
    "received_events_url": "https://api.github.com/users/giovannistefanello/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-11-25T08:43:13Z",
  "updated_at": "2023-07-23T14:08:19Z",
  "closed_at": "2023-07-23T14:07:49Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello,\r\n\r\nI am currently trying to plot a waterfall plot with shap.\r\nMy model is a CatBoostRegressor:\r\n\r\n```\r\nmodel = CatBoostRegressor(depth=10, l2_leaf_reg=1, iterations=75, learning_rate=0.1,\r\n                                               random_state=random_state, loss_function='RMSEWithUncertainty',\r\n                                               posterior_sampling=True, od_type=\"Iter\", od_wait=10)\r\n```\r\nThe dataset I train it on is a standard dataset with a one-dimensional float target.\r\n\r\nI explain the model as follows:\r\n```\r\nexplainer = shap.TreeExplainer(model)                 \r\nshap_values = explainer(df_for_shap)\r\n```\r\nWhen I try to plot a waterfall plot with\r\n\r\n`shap.waterfall_plot(explanation)`\r\n\r\nthe program raises the exception\r\n\r\n> Exception: waterfall_plot requires a scalar base_values of the model output as the first parameter, but you have passed an array as the first parameter! Try shap.waterfall_plot(explainer.base_values[0], values[0], X[0]) or for multi-output models try shap.waterfall_plot(explainer.base_values[0], values[0][0], X[0]).\r\n\r\nWhen I print the `shap_values` variable, this is the output.\r\n\r\n> .values =\r\n> array([[[0.000],\r\n>         [0.004],\r\n>         [-0.003],\r\n>         [0.000],\r\n>         [0.003],\r\n>         [0.006],\r\n>         [-0.009],\r\n>         [0.000],\r\n>         [0.002],\r\n>         [0.000],\r\n>         [-0.014],\r\n>         [0.000],\r\n>         [0.001],\r\n>         [0.004],\r\n>         [0.016],\r\n>         [-0.006],\r\n>         [0.030],\r\n>         [-0.024],\r\n>         [-0.002],\r\n>         [-0.022],\r\n>         [-0.001],\r\n>         [0.000],\r\n>         [-0.003],\r\n>         [-0.001],\r\n>         [0.020],\r\n>         [-0.007],\r\n>         [0.006],\r\n>         [0.006],\r\n>         [-0.000],\r\n>         [-0.000],\r\n>         [0.002],\r\n>         [-0.000],\r\n>         [0.000],\r\n>         [0.011],\r\n>         [-0.001],\r\n>         [0.007],\r\n>         [0.001],\r\n>         [0.006]]])\r\n> \r\n> .base_values =\r\n> array([[0.153]])\r\n> \r\n> .data =\r\n> array([[1.000, 0.000, 35000000.000, 97.000, 111.000, 70.050, 170.000,\r\n>         520000000.000, 20800000.000, 7.000, 0.000, 0.000, 10.000, 4.000,\r\n>         0.673, 25.000, 392.900, 0.500, 17.850, -1.000, 8.100, 15.810,\r\n>         35.710, 0.000, -33.329, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000,\r\n>         0.000, 0.000, 39.290, 0.000, 0.000, 6.000, 1.000]])\r\n\r\nI tried many workarounds as the one mentioned in [this issue](https://github.com/slundberg/shap/issues/2255), but didn't have any luck. I even tried to make the numpy arrays from the ground up and assigning them to a helper object but the resulting plot was a `None`.\r\n\r\nAny insights?\r\n",
  "closed_by": {
    "login": "thatlittleboy",
    "id": 30731072,
    "node_id": "MDQ6VXNlcjMwNzMxMDcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thatlittleboy",
    "html_url": "https://github.com/thatlittleboy",
    "followers_url": "https://api.github.com/users/thatlittleboy/followers",
    "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
    "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
    "repos_url": "https://api.github.com/users/thatlittleboy/repos",
    "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2289/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2289/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
