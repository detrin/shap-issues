{
  "url": "https://api.github.com/repos/shap/shap/issues/1559",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1559/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1559/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1559/events",
  "html_url": "https://github.com/shap/shap/issues/1559",
  "id": 733800334,
  "node_id": "MDU6SXNzdWU3MzM4MDAzMzQ=",
  "number": 1559,
  "title": "Difficultly explaining the expected_value since it '= to mean of predictions on training data",
  "user": {
    "login": "dwoodlock",
    "id": 5075821,
    "node_id": "MDQ6VXNlcjUwNzU4MjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5075821?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dwoodlock",
    "html_url": "https://github.com/dwoodlock",
    "followers_url": "https://api.github.com/users/dwoodlock/followers",
    "following_url": "https://api.github.com/users/dwoodlock/following{/other_user}",
    "gists_url": "https://api.github.com/users/dwoodlock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dwoodlock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dwoodlock/subscriptions",
    "organizations_url": "https://api.github.com/users/dwoodlock/orgs",
    "repos_url": "https://api.github.com/users/dwoodlock/repos",
    "events_url": "https://api.github.com/users/dwoodlock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dwoodlock/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-10-31T20:19:26Z",
  "updated_at": "2020-10-31T20:19:26Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm working on a project to predict length of stay for patients in the hospital so I would like to explain the predictions to the administrators and nurses as part of the system. I feel the need to explain the expected_value properly since shap is defined as impact of features causing the prediction to deviate from the expected_value.  \r\n\r\nI am using XGBoost.  I was assuming that the expected_value would be the mean of the predictions of the model against the training data. This is true for regression (hessian = 1 for SSE objective function) but not true for binary classification (my label is 'WillThePatientBeDischargedTodayOrTomorrow') using the negative log likelihood objective function. After walking through the code for a few days and reading xgboost and shap papers, I have figured out shap is using the prediction value at the top of each tree, which essentially is the hessian weighted predictions for the training data for that tree (actually weighted by cover but cover is calculated by the hessian-weighted counts of how many instances went down each part of the tree).\r\n\r\nSo I could try and explain the expected_value as sort of the mean of the predictions of the training data with some oversampling of the data instances that it was less confident in.  \r\n\r\nMy questions would be:\r\n- Is this the right definition of the shap methodology or is this an optimization (reading the top of the trees instead of calculating everything)?\r\n- Is there a better explanation of the expected_value that makes sense to domain users?\r\n- Is there a different objective function that I should consider using where the hessian is a constant so it's easier to explain (I don't know if there is one)?\r\n\r\nThanks for your help.\r\nDon\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1559/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1559/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
