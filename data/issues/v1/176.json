{
  "url": "https://api.github.com/repos/shap/shap/issues/176",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/176/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/176/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/176/events",
  "html_url": "https://github.com/shap/shap/issues/176",
  "id": 343605207,
  "node_id": "MDU6SXNzdWUzNDM2MDUyMDc=",
  "number": 176,
  "title": "Issue with categorical variables in LGBM",
  "user": {
    "login": "mmonges",
    "id": 29574416,
    "node_id": "MDQ6VXNlcjI5NTc0NDE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/29574416?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mmonges",
    "html_url": "https://github.com/mmonges",
    "followers_url": "https://api.github.com/users/mmonges/followers",
    "following_url": "https://api.github.com/users/mmonges/following{/other_user}",
    "gists_url": "https://api.github.com/users/mmonges/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mmonges/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mmonges/subscriptions",
    "organizations_url": "https://api.github.com/users/mmonges/orgs",
    "repos_url": "https://api.github.com/users/mmonges/repos",
    "events_url": "https://api.github.com/users/mmonges/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mmonges/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-07-23T12:05:48Z",
  "updated_at": "2019-07-28T05:25:00Z",
  "closed_at": "2018-07-23T16:54:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Since i updated to the last version of the package (today), the TreeExplainer method does not work for categorical variables anymore. I am getting an error I was not getting before with the exact same code.\r\n\r\nThis is my code:\r\n`data[cols_cat] = data[cols_cat].apply(lambda x: x.astype('category'))\r\nX_train, X_test, y_train, y_test = train_test_split(data, y, test_size = 0.2, random_state=7)\r\n\r\ndtrain_l = lgb.Dataset(X_train, label=y_train, \r\n                       categorical_feature = cols_cat, \r\n                       free_raw_data=False)\r\ndtest_l = lgb.Dataset(X_test, label=y_test, \r\n                      categorical_feature = cols_cat, \r\n                      free_raw_data=False)\r\n\r\nmodel= lgb.train(params, dtrain_l, valid_sets=[dtest_l], verbose_eval=10, early_stopping_rounds=10)\r\nexplainer = shap.TreeExplainer(model)\r\n`\r\n\r\nThis is the error:\r\n`---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-368-b35bcca2838f> in <module>()\r\n      2 # (same syntax works for LightGBM and scikit-learn models)\r\n      3 deb = time.time()\r\n----> 4 explainer = shap.TreeExplainer(bestModel)\r\n      5 #shap_values = explainer.shap_values(X_train)\r\n      6 print(time.time() - deb)\r\n\r\nL:\\ProgramData\\Anaconda3\\lib\\site-packages\\shap\\explainers\\tree.py in __init__(self, model, **kwargs)\r\n     91             self.model = model\r\n     92             tree_info = self.model.dump_model()[\"tree_info\"]\r\n---> 93             self.trees = [Tree(e, scaling=len(tree_info)) for e in tree_info]\r\n     94         elif str(type(model)).endswith(\"lightgbm.sklearn.LGBMRegressor'>\"):\r\n     95             self.model_type = \"lightgbm\"\r\n\r\nL:\\ProgramData\\Anaconda3\\lib\\site-packages\\shap\\explainers\\tree.py in <listcomp>(.0)\r\n     91             self.model = model\r\n     92             tree_info = self.model.dump_model()[\"tree_info\"]\r\n---> 93             self.trees = [Tree(e, scaling=len(tree_info)) for e in tree_info]\r\n     94         elif str(type(model)).endswith(\"lightgbm.sklearn.LGBMRegressor'>\"):\r\n     95             self.model_type = \"lightgbm\"\r\n\r\nL:\\ProgramData\\Anaconda3\\lib\\site-packages\\shap\\explainers\\tree.py in __init__(self, tree, normalize, scaling)\r\n    380                             self.children_default[vertex['split_index']] = self.children_right[vertex['split_index']]\r\n    381                         self.features[vertex['split_index']] = vertex['split_feature']\r\n--> 382                         self.thresholds[vertex['split_index']] = vertex['threshold']\r\n    383                         self.values[vertex['split_index']] = [vertex['internal_value']]\r\n    384                         self.node_sample_weight[vertex['split_index']] = vertex['internal_count']\r\n\r\nValueError: could not convert string to float: '3||4'\r\n`\r\n",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/176/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/176/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
