{
  "url": "https://api.github.com/repos/shap/shap/issues/1031",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1031/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1031/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1031/events",
  "html_url": "https://github.com/shap/shap/issues/1031",
  "id": 560506122,
  "node_id": "MDU6SXNzdWU1NjA1MDYxMjI=",
  "number": 1031,
  "title": "Issues regarding waterfall_plot on multi-class classification",
  "user": {
    "login": "ivan-marroquin",
    "id": 28459534,
    "node_id": "MDQ6VXNlcjI4NDU5NTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/28459534?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ivan-marroquin",
    "html_url": "https://github.com/ivan-marroquin",
    "followers_url": "https://api.github.com/users/ivan-marroquin/followers",
    "following_url": "https://api.github.com/users/ivan-marroquin/following{/other_user}",
    "gists_url": "https://api.github.com/users/ivan-marroquin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ivan-marroquin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ivan-marroquin/subscriptions",
    "organizations_url": "https://api.github.com/users/ivan-marroquin/orgs",
    "repos_url": "https://api.github.com/users/ivan-marroquin/repos",
    "events_url": "https://api.github.com/users/ivan-marroquin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ivan-marroquin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-02-05T17:01:35Z",
  "updated_at": "2020-02-06T00:34:44Z",
  "closed_at": "2020-02-05T18:52:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\n\r\nI have Python 3.6.5 and I am using Shap version 0.34.0 on a windows machine.  The model was trained using XGBClassifier from xgboost 0.90. The trained model consists of six classes.\r\n\r\nI noticed these issues:\r\na) When using command: shap.waterfall_plot(shap_explainer.expected_value, shap_values[0], features= pd_test_inputs.iloc[0,:], feature_names= feature_names, show= True)\r\n\r\ngives this warning message: \r\n\r\nwaterfall_plot requires a scalar expected_value of the model output as the first parameter, but you have passed an array as the first parameter! Try shap.waterfall_plot(explainer.expected_value, shap_values[0], X[0]) or for multi-output models try shap.waterfall_plot(explainer.expected_value[0], shap_values[0][0], X[0]).\r\n\r\nHowever, the command: print(\" shap explainer Expected Values \", shap_explainer.expected_value) gives a single numerical value.\r\n\r\nis it possible that shap_explainer.expected_value is not working? It seems that this command should generate an array with # samples equal to # classes\r\n\r\nb) When using command: shap.waterfall_plot(shap_explainer.expected_value[0], shap_values[0], features= pd_test_inputs, feature_names= feature_names, show= True)\r\n\r\ngives this warning message: The waterfall_plot can currently only plot a single explanation but a matrix of explanations was passed!\r\n\r\nHowever, \"shap_values[0]\" and \"pd_test_inputs\" are matrices of # samples x # features, and according to docstrings the command waterfall_plot should be able to handle them.\r\n\r\nc) When using the command: shap.waterfall_plot(shap_explainer.expected_value[0], shap_values[0][0], features= pd_test_inputs.iloc[0,:], feature_names= feature_names, show= False)\r\n\r\nproduces the waterfall plot. But, how this command can compute the evidence of all other features when only one was provided (features= pd_test_inputs.iloc[0,:])? Also, what does the values on the vertical axis mean? What about the values in the plot itself? \r\n\r\nThe expected value is -1.70, it seems that the position of E[f(X)] is incorrect along the x-axis.\r\n\r\nI attached a zip file to reproduce the reported incident. Hope this helps,\r\n\r\nIvan\r\n\r\n\r\n[testing_shap_waterfall_plot.zip](https://github.com/slundberg/shap/files/4160945/testing_shap_waterfall_plot.zip)\r\n",
  "closed_by": {
    "login": "slundberg",
    "id": 3740613,
    "node_id": "MDQ6VXNlcjM3NDA2MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3740613?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/slundberg",
    "html_url": "https://github.com/slundberg",
    "followers_url": "https://api.github.com/users/slundberg/followers",
    "following_url": "https://api.github.com/users/slundberg/following{/other_user}",
    "gists_url": "https://api.github.com/users/slundberg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/slundberg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/slundberg/subscriptions",
    "organizations_url": "https://api.github.com/users/slundberg/orgs",
    "repos_url": "https://api.github.com/users/slundberg/repos",
    "events_url": "https://api.github.com/users/slundberg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/slundberg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1031/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1031/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
