{
  "url": "https://api.github.com/repos/shap/shap/issues/2722",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2722/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2722/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2722/events",
  "html_url": "https://github.com/shap/shap/issues/2722",
  "id": 1403951710,
  "node_id": "I_kwDOBHDcK85Trppe",
  "number": 2722,
  "title": "\"string index out of range\" for waterfall plot",
  "user": {
    "login": "frog-land",
    "id": 98231593,
    "node_id": "U_kgDOBdrlKQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/98231593?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frog-land",
    "html_url": "https://github.com/frog-land",
    "followers_url": "https://api.github.com/users/frog-land/followers",
    "following_url": "https://api.github.com/users/frog-land/following{/other_user}",
    "gists_url": "https://api.github.com/users/frog-land/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frog-land/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frog-land/subscriptions",
    "organizations_url": "https://api.github.com/users/frog-land/orgs",
    "repos_url": "https://api.github.com/users/frog-land/repos",
    "events_url": "https://api.github.com/users/frog-land/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frog-land/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 486901329,
      "node_id": "MDU6TGFiZWw0ODY5MDEzMjk=",
      "url": "https://api.github.com/repos/shap/shap/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Indicates an unexpected problem or unintended behaviour"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/shap/shap/milestones/2",
    "html_url": "https://github.com/shap/shap/milestone/2",
    "labels_url": "https://api.github.com/repos/shap/shap/milestones/2/labels",
    "id": 9579906,
    "node_id": "MI_kwDOBHDcK84Aki2C",
    "number": 2,
    "title": "0.43.0",
    "description": "",
    "creator": {
      "login": "thatlittleboy",
      "id": 30731072,
      "node_id": "MDQ6VXNlcjMwNzMxMDcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thatlittleboy",
      "html_url": "https://github.com/thatlittleboy",
      "followers_url": "https://api.github.com/users/thatlittleboy/followers",
      "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
      "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
      "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
      "repos_url": "https://api.github.com/users/thatlittleboy/repos",
      "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 23,
    "state": "open",
    "created_at": "2023-06-25T10:11:50Z",
    "updated_at": "2023-08-26T14:27:48Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 0,
  "created_at": "2022-10-11T03:38:38Z",
  "updated_at": "2023-08-22T01:18:39Z",
  "closed_at": "2023-08-22T01:18:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "When producing a SHAP waterfall plot, I got the 'string index out of range' error.  I had 7 features in my model, and 7 days of predictions in my test set, and I was attempting to produce a waterfall plot for the first day in the test set. After trying many scenarios, I discovered if I simply removed a row of data in the test set, the waterfall plot generated without error.\r\n\r\nOn further investigation it looks like if the number of features is the same as the number of rows in the dataset, then the error occurs. I cannot attach my original code but I have replicated it in a simple example with 12 features where the waterfall plot works correctly if the number of rows is greater than or less than the number of features, but errors when the two are the same.\r\n\r\nimport xgboost\r\nimport shap\r\n\r\n###  Example of waterfall plot NOT working correctly when number of rows (12) == number of features (12) #############\r\nX,y = shap.datasets.adult()\r\nX = X.iloc[0:12]\r\ny = y[0:12]\r\nmodel = xgboost.XGBClassifier(eval_metric=\"logloss\").fit(X, y)\r\nexplainer = shap.Explainer(model, X)\r\nshap_values = explainer(X)\r\nprint(\"Length of X:\",len(X),\"; Length y:\",len(y),\"; Number of features:\",len(shap_values[0].feature_names))\r\nprint(\"\\nFeature Names:\",shap_values[0].feature_names)\r\nshap.plots.waterfall(shap_values[0])\r\n##### Number of features is incorrectly listed as 3. Feature names are incorrectly listed as age only. String Index out of range error.\r\n\r\nOutput:\r\nLength of X: 12 ; Length y: 12 ; Number of features: 3\r\nFeature Names: Age\r\nIndexError: string index out of range \r\n\r\n\r\n###  Example of waterfall plot working correctly when number of rows (13) > number of features (12) ####################\r\nX,y = shap.datasets.adult()\r\nX = X.iloc[0:13]\r\ny = y[0:13]\r\nmodel = xgboost.XGBClassifier(eval_metric=\"logloss\").fit(X, y)\r\nexplainer = shap.Explainer(model, X)\r\nshap_values = explainer(X)\r\nprint(\"Length of X:\",len(X),\"; Length y:\",len(y),\"; Number of features:\",len(shap_values[0].feature_names))\r\nprint(\"\\nFeature Names:\",shap_values[0].feature_names)\r\nshap.plots.waterfall(shap_values[0])\r\n##### Number of features is correctly listed as 12. Feature names are correctly listed. Plot generates.\r\nOutput:\r\nLength of X: 13 ; Length y: 13 ; Number of features: 12\r\nFeature Names: ['Age', 'Workclass', 'Education-Num', 'Marital Status', 'Occupation', 'Relationship', 'Race', 'Sex', 'Capital Gain', 'Capital Loss', 'Hours per week', 'Country']\r\n\r\n![image](https://user-images.githubusercontent.com/98231593/194988734-bcf73312-0acf-4079-95ad-d0235ee02f78.png)\r\n",
  "closed_by": {
    "login": "thatlittleboy",
    "id": 30731072,
    "node_id": "MDQ6VXNlcjMwNzMxMDcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thatlittleboy",
    "html_url": "https://github.com/thatlittleboy",
    "followers_url": "https://api.github.com/users/thatlittleboy/followers",
    "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
    "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
    "repos_url": "https://api.github.com/users/thatlittleboy/repos",
    "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2722/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2722/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
