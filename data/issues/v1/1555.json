{
  "url": "https://api.github.com/repos/shap/shap/issues/1555",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1555/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1555/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1555/events",
  "html_url": "https://github.com/shap/shap/issues/1555",
  "id": 731197879,
  "node_id": "MDU6SXNzdWU3MzExOTc4Nzk=",
  "number": 1555,
  "title": "Additivity check failed for largeish Xgboost Model",
  "user": {
    "login": "Tailorware",
    "id": 13869091,
    "node_id": "MDQ6VXNlcjEzODY5MDkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/13869091?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Tailorware",
    "html_url": "https://github.com/Tailorware",
    "followers_url": "https://api.github.com/users/Tailorware/followers",
    "following_url": "https://api.github.com/users/Tailorware/following{/other_user}",
    "gists_url": "https://api.github.com/users/Tailorware/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Tailorware/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Tailorware/subscriptions",
    "organizations_url": "https://api.github.com/users/Tailorware/orgs",
    "repos_url": "https://api.github.com/users/Tailorware/repos",
    "events_url": "https://api.github.com/users/Tailorware/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Tailorware/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-10-28T07:54:05Z",
  "updated_at": "2020-11-03T02:53:35Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "First of all: Excellent Work! SHAP really provides excellent model explainablity!\r\nI just got an exception that tells me to report on github:\r\nException: Additivity check failed in TreeExplainer! Please ensure the data matrix you passed to the explainer is the same shape that the model was trained on. If your data shape is correct then please report this on GitHub. Consider retrying with the feature_perturbation='interventional' option. This check failed because for one of the samples the sum of the SHAP values was 4.813293, while the model output was 4.815905. If this difference is acceptable you can set check_additivity=False to disable this check.\r\n\r\nI am sure the data matrix is the same because I run TreeExplainer direktly after training the classifier on the same data.\r\n I use an xgboost model (sklearn wrapper) on 57195 samples Ã— 9222 features \r\nThere are 5 classes in the target variable y.\r\n'learning_rate': 0.02\r\n'max_depth': 25,\r\n'n_estimators': 2000,\r\n'tree_method': 'gpu_hist', # run on GPU\r\n\r\nMy guess is that the difference comes from numerical issues caused by quite a large number of features, tree depth and estimators. \r\nFurthermore I learned that training xgboost on GPU causes non-deterministic results.\r\nCould one of those be the cause? \r\n\r\nTreeExplainer is off by only 0.0542%. So I think the Additivity check is a bit too sensitive in this case.\r\n\r\nI will just switch Additivity check off for the moment and continue to use SHAP happily.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1555/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1555/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
