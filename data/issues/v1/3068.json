{
  "url": "https://api.github.com/repos/shap/shap/issues/3068",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/3068/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/3068/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/3068/events",
  "html_url": "https://github.com/shap/shap/pull/3068",
  "id": 1791464456,
  "node_id": "PR_kwDOBHDcK85Uzl4y",
  "number": 3068,
  "title": "MAINT: only publish to TestPyPI on new releases, fix tag condition",
  "user": {
    "login": "connortann",
    "id": 71127464,
    "node_id": "MDQ6VXNlcjcxMTI3NDY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/71127464?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/connortann",
    "html_url": "https://github.com/connortann",
    "followers_url": "https://api.github.com/users/connortann/followers",
    "following_url": "https://api.github.com/users/connortann/following{/other_user}",
    "gists_url": "https://api.github.com/users/connortann/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/connortann/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/connortann/subscriptions",
    "organizations_url": "https://api.github.com/users/connortann/orgs",
    "repos_url": "https://api.github.com/users/connortann/repos",
    "events_url": "https://api.github.com/users/connortann/events{/privacy}",
    "received_events_url": "https://api.github.com/users/connortann/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 486901329,
      "node_id": "MDU6TGFiZWw0ODY5MDEzMjk=",
      "url": "https://api.github.com/repos/shap/shap/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Indicates an unexpected problem or unintended behaviour"
    },
    {
      "id": 5577305596,
      "node_id": "LA_kwDOBHDcK88AAAABTG7t_A",
      "url": "https://api.github.com/repos/shap/shap/labels/ci",
      "name": "ci",
      "color": "006b75",
      "default": false,
      "description": "Relating to Continuous Integration / GitHub Actions"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/shap/shap/milestones/4",
    "html_url": "https://github.com/shap/shap/milestone/4",
    "labels_url": "https://api.github.com/repos/shap/shap/milestones/4/labels",
    "id": 9636792,
    "node_id": "MI_kwDOBHDcK84Akwu4",
    "number": 4,
    "title": "0.42.1",
    "description": "",
    "creator": {
      "login": "connortann",
      "id": 71127464,
      "node_id": "MDQ6VXNlcjcxMTI3NDY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/71127464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/connortann",
      "html_url": "https://github.com/connortann",
      "followers_url": "https://api.github.com/users/connortann/followers",
      "following_url": "https://api.github.com/users/connortann/following{/other_user}",
      "gists_url": "https://api.github.com/users/connortann/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/connortann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/connortann/subscriptions",
      "organizations_url": "https://api.github.com/users/connortann/orgs",
      "repos_url": "https://api.github.com/users/connortann/repos",
      "events_url": "https://api.github.com/users/connortann/events{/privacy}",
      "received_events_url": "https://api.github.com/users/connortann/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 10,
    "state": "closed",
    "created_at": "2023-07-10T12:22:24Z",
    "updated_at": "2023-07-16T09:40:42Z",
    "due_on": null,
    "closed_at": "2023-07-16T09:37:48Z"
  },
  "comments": 1,
  "created_at": "2023-07-06T12:28:38Z",
  "updated_at": "2023-07-16T09:39:48Z",
  "closed_at": "2023-07-08T01:30:16Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/shap/shap/pulls/3068",
    "html_url": "https://github.com/shap/shap/pull/3068",
    "diff_url": "https://github.com/shap/shap/pull/3068.diff",
    "patch_url": "https://github.com/shap/shap/pull/3068.patch",
    "merged_at": "2023-07-08T01:30:16Z"
  },
  "body": "This PR fixes two issues with the `build_wheels` workflow, which I came across in our most recent release.\r\n\r\n## Fixing the \"if\" condition\r\n\r\nTo determine if wheels should be published to PyPi, we currently have the condition `if: github.event_name == 'release' && github.event.action == 'created'`. However, this did not actually trigger in our most recent Release!\r\n\r\nI'm unsure why; perhaps the syntax is outdated. For now, I've triggered an upload to PyPI with a new run of the workflow on a temporary patched branch.\r\n\r\nThis PR updates the condition to `if: startsWith(github.ref, 'refs/tags')`, as recommended by the [packaging guide](https://packaging.python.org/en/latest/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/). This should trigger on any tagged commit.\r\n\r\n## Only publishing to TestPyPI on tags\r\n\r\nThis PR also changes the `build_wheels` workflow so that releases to TestPyPI only occur when GitHub releases are made. This is closer to the previous implementation.\r\n\r\nWith the present setup, we at at risk of inadvertently breaking the release pipeline if we do some steps in the wrong order. This is a possible scenario:\r\n- The version number is incremented to e.g. `1.2.3` , ready for a new release.\r\n- The `build_wheels` workflow is manually triggered, to test cibuildwheel.\r\n  - `shap 1.2.3` is published on TestPyPI\r\n  - It is _not_ published to PyPi\r\n- A GitHub Release `v1.2.3` is created, triggering the workflow again. The TestPyPI step fails, as `1.2.3` already exists. The workflow fails, and the wheels do not arrive at PyPI\r\n\r\n\r\nNow, the practice of regularly releasing to TestPyPi is recommended in some places and would be a nice goal. However, for it to work we need a dynamic version scheme. For now, I'd advocate for keeping this simple and robust.\r\n ",
  "closed_by": {
    "login": "thatlittleboy",
    "id": 30731072,
    "node_id": "MDQ6VXNlcjMwNzMxMDcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thatlittleboy",
    "html_url": "https://github.com/thatlittleboy",
    "followers_url": "https://api.github.com/users/thatlittleboy/followers",
    "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
    "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
    "repos_url": "https://api.github.com/users/thatlittleboy/repos",
    "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/3068/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/3068/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
