{
  "url": "https://api.github.com/repos/shap/shap/issues/1800",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1800/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1800/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1800/events",
  "html_url": "https://github.com/shap/shap/issues/1800",
  "id": 800753857,
  "node_id": "MDU6SXNzdWU4MDA3NTM4NTc=",
  "number": 1800,
  "title": "Kernel Crash with Catboost",
  "user": {
    "login": "ThomasWolf0701",
    "id": 13987553,
    "node_id": "MDQ6VXNlcjEzOTg3NTUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/13987553?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ThomasWolf0701",
    "html_url": "https://github.com/ThomasWolf0701",
    "followers_url": "https://api.github.com/users/ThomasWolf0701/followers",
    "following_url": "https://api.github.com/users/ThomasWolf0701/following{/other_user}",
    "gists_url": "https://api.github.com/users/ThomasWolf0701/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ThomasWolf0701/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ThomasWolf0701/subscriptions",
    "organizations_url": "https://api.github.com/users/ThomasWolf0701/orgs",
    "repos_url": "https://api.github.com/users/ThomasWolf0701/repos",
    "events_url": "https://api.github.com/users/ThomasWolf0701/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ThomasWolf0701/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-02-03T22:31:12Z",
  "updated_at": "2021-07-02T14:38:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n\r\nI attached both the featureMatrix and the model using pickles:\r\nerrorReproduceObjects.zip\r\n\r\nThe model uses MutliRMSE and catboost 0.24.4 and\r\nbestModel.predict(transformedMatrix) works fine\r\n\r\nbestModel.predict(transformedMatrix)\r\nOut[44]:\r\narray([[-4.84283473, -4.66173853],\r\n[-4.03272354, -3.80896785],\r\n[-2.61701992, -2.22272565],\r\n...,\r\n[-4.5486192 , -4.31635738],\r\n[-2.81394494, -2.38203556],\r\n[-4.02415018, -3.65515251]])\r\n\r\n\r\nWhen I use the SHAP package instead of the catboost internal function I get a Kernel crash.\r\n\r\nexplainer = shap.TreeExplainer(bestModel[\"m\"])\r\nbestModelShap = explainer.shap_values( transformedMatrix)\r\n\r\nKernel died, restarting\r\n\r\nRestarting kernel...\r\n\r\n[SpyderKernelApp] WARNING | No such comm: f2b6ca35666511eb9cf99cb6d01cd292\r\n[SpyderKernelApp] WARNING | No such comm: 382dbce3666711eb95589cb6d01cd292\r\n[SpyderKernelApp] WARNING | No such comm: ee4c9163666811ebb4899cb6d01cd292\r\n\r\n\r\nWhen running the catboost internal shap I get a Kernel crash when using multiple cores and an error when\r\nusing only one core:\r\n\r\nbestModelShap = bestModel.get_feature_importance(Pool(scipy.sparse.csr_matrix(transformedMatrix)),type = \"ShapValues\",thread_count = 1 )\r\n\r\nTraceback (most recent call last):\r\n\r\nFile \"\", line 1, in\r\nbestModelShap = bestModel.get_feature_importance(Pool(scipy.sparse.csr_matrix(transformedMatrix)),type = \"ShapValues\",thread_count = 1 )\r\n\r\nFile \"C:\\Users\\Thomas Wolf\\anaconda3\\envs\\ChemPipeline\\lib\\site-packages\\catboost\\core.py\", line 2555, in get_feature_importance\r\nfstr, feature_names = self._calc_fstr(type, data, reference_data, thread_count, verbose, model_output, shap_mode, interaction_indices,\r\n\r\nFile \"C:\\Users\\Thomas Wolf\\anaconda3\\envs\\ChemPipeline\\lib\\site-packages\\catboost\\core.py\", line 1329, in _calc_fstr\r\nreturn self._object._calc_fstr(type.name, pool, reference_data, thread_count, verbose, model_output, shap_mode, interaction_indices, shap_calc_type)\r\n\r\nFile \"_catboost.pyx\", line 4408, in _catboost._CatBoost._calc_fstr\r\n\r\nFile \"_catboost.pyx\", line 4437, in _catboost._CatBoost._calc_fstr\r\n\r\nCatBoostError: c:/program files (x86)/go agent/pipelines/buildmaster/catboost.git/catboost/libs/model/scale_and_bias.h:63: Internal CatBoost Error (contact developers for assistance): Asked one-dimensional bias, has 2.Non single-dimension approxes are not supported\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1800/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1800/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
