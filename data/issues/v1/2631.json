{
  "url": "https://api.github.com/repos/shap/shap/issues/2631",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2631/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2631/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2631/events",
  "html_url": "https://github.com/shap/shap/issues/2631",
  "id": 1318742006,
  "node_id": "I_kwDOBHDcK85Ommf2",
  "number": 2631,
  "title": "Error while pickling kernal explainer from a trained StackingClassifier",
  "user": {
    "login": "tkmamidi",
    "id": 41593805,
    "node_id": "MDQ6VXNlcjQxNTkzODA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/41593805?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkmamidi",
    "html_url": "https://github.com/tkmamidi",
    "followers_url": "https://api.github.com/users/tkmamidi/followers",
    "following_url": "https://api.github.com/users/tkmamidi/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkmamidi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkmamidi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkmamidi/subscriptions",
    "organizations_url": "https://api.github.com/users/tkmamidi/orgs",
    "repos_url": "https://api.github.com/users/tkmamidi/repos",
    "events_url": "https://api.github.com/users/tkmamidi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkmamidi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2022-07-26T20:54:16Z",
  "updated_at": "2022-08-04T16:18:34Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello,\r\nI've trained a StackingClassifier for a model and wanted to save the kernal explainer as a pickle file. I'm using the below code snippet\r\n\r\n```\r\nclf = sklearn.ensemble.StackingClassifier(\r\n        estimators=[\r\n            (\"DecisionTree\", DecisionTreeClassifier(class_weight=\"balanced\")),\r\n            (\r\n                \"RandomForest\",\r\n                RandomForestClassifier(class_weight=\"balanced\", n_jobs=-1),\r\n            ),\r\n        ],\r\n        cv=2,\r\n        stack_method=\"predict_proba\",\r\n        n_jobs=-1,\r\n        passthrough=False,\r\n        final_estimator=LogisticRegression(n_jobs=-1),\r\n        verbose=1,\r\n    )\r\nclf.fit(X_train, Y_train)\r\nbackground = shap.kmeans(X_train, 10)\r\nexplainer = shap.KernelExplainer(clf.predict_proba, background)\r\n```\r\n\r\nWhen I try to save the `explainer` as a pickle object instead of training the model every time, I get the following error\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nPicklingError                             Traceback (most recent call last)\r\n/var/folders/x5/1jk7xryd0rg4d710y586kmvh0000gp/T/ipykernel_5414/1607415220.py in <module>\r\n      1 import pickle\r\n      2 filehandler = open(\"../data/explainer.pkl\", 'wb')\r\n----> 3 pickle.dump(explainer, filehandler)\r\n\r\nPicklingError: Can't pickle <function StackingClassifier.predict_proba at 0x1a8edb550>: it's not the same object as sklearn.ensemble._stacking.StackingClassifier.predict_proba\r\n``` \r\n\r\nAny help is much appreciated!\r\nThank you!",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2631/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2631/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
