{
  "url": "https://api.github.com/repos/shap/shap/issues/1014",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1014/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1014/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1014/events",
  "html_url": "https://github.com/shap/shap/issues/1014",
  "id": 554324747,
  "node_id": "MDU6SXNzdWU1NTQzMjQ3NDc=",
  "number": 1014,
  "title": "KernelExplainer not working with CatBoostRegressor and Pool",
  "user": {
    "login": "harshalchaudhari35",
    "id": 24657672,
    "node_id": "MDQ6VXNlcjI0NjU3Njcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/24657672?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/harshalchaudhari35",
    "html_url": "https://github.com/harshalchaudhari35",
    "followers_url": "https://api.github.com/users/harshalchaudhari35/followers",
    "following_url": "https://api.github.com/users/harshalchaudhari35/following{/other_user}",
    "gists_url": "https://api.github.com/users/harshalchaudhari35/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/harshalchaudhari35/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/harshalchaudhari35/subscriptions",
    "organizations_url": "https://api.github.com/users/harshalchaudhari35/orgs",
    "repos_url": "https://api.github.com/users/harshalchaudhari35/repos",
    "events_url": "https://api.github.com/users/harshalchaudhari35/events{/privacy}",
    "received_events_url": "https://api.github.com/users/harshalchaudhari35/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2020-01-23T18:21:22Z",
  "updated_at": "2020-03-09T17:40:46Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Dear Scott, \r\n\r\nNot sure if this a duplicate but I couldn't find a working example of this usecase.\r\nI'm trying to use the KernelExplainer with CatBoostRegressor. The TreeExplainer works fine but I would like to see the model agnostic explainations for this as well.\r\n\r\nSmall snippet I'm using\r\n```\r\nmodel = CatBoostRegressor(Pool(X_train, Y_train, categorical_feature_indices)\r\nexplainer = shap.KernelExplainer(model.predict, X_test) \r\nshap_values = explainer.shap_values(X_test)\r\n```\r\n\r\nI'm getting the error\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 153, in <module>\r\n    main()\r\n  File \"main.py\", line 147, in main\r\n    shap_values = explainer.shap_values(X_test, nsamples=len(X_test))\r\n  File \"/usr/lib/python3.8/site-packages/shap/explainers/kernel.py\", line 211, in shap_values\r\n    explanations.append(self.explain(data, **kwargs))\r\n  File \"/usr/lib/python3.8/site-packages/shap/explainers/kernel.py\", line 236, in explain\r\n    self.varyingInds = self.varying_groups(instance.x)\r\n  File \"/usr/lib/python3.8/site-packages/shap/explainers/kernel.py\", line 428, in varying_groups\r\n    num_mismatches = np.sum(np.invert(np.isclose(x_group, self.data.data[:, inds], equal_nan=True)))\r\n  File \"<__array_function__ internals>\", line 5, in isclose\r\n  File \"/usr/lib/python3.8/site-packages/numpy/core/numeric.py\", line 2257, in isclose\r\n    xfin = isfinite(x)\r\nTypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\r\n\r\nInstead if I pass the Pool of dataset as such \r\n\r\n```\r\nexplainer = shap.KernelExplainer(model.predict, X_test) \r\nshap_values = explainer.shap_values(Pool(X_test, Y_test, cat_features=categorical_features_indices))\r\n```\r\nI get this error\r\nTraceback (most recent call last):\r\n  File \"main.py\", line 157, in <module>\r\n    main()\r\n  File \"main.py\", line 150, in main\r\n    shap_values = explainer.shap_values(Pool(X_test, Y_test, cat_features=categorical_features_indices))\r\n  File \"/usr/lib/python3.8/site-packages/shap/explainers/kernel.py\", line 180, in shap_values\r\n    assert x_type.endswith(arr_type) or sp.sparse.isspmatrix_lil(X), \"Unknown instance type: \" + x_type\r\nAssertionError: Unknown instance type: <class 'catboost.core.Pool'>\r\n\r\nNot sure on how to use categorical features in KernelExplainer. TreeExplainer on the other hand when passed the Pool() works just fine. The example notes show a usecase of one-hot-encoding but I'm not using that here.\r\n\r\nThanks",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1014/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1014/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
