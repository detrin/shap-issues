{
  "url": "https://api.github.com/repos/shap/shap/issues/1958",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1958/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1958/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1958/events",
  "html_url": "https://github.com/shap/shap/issues/1958",
  "id": 866728528,
  "node_id": "MDU6SXNzdWU4NjY3Mjg1Mjg=",
  "number": 1958,
  "title": "NameError: name 'Model' is not defined",
  "user": {
    "login": "ahmadmustafaanis",
    "id": 47111429,
    "node_id": "MDQ6VXNlcjQ3MTExNDI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/47111429?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ahmadmustafaanis",
    "html_url": "https://github.com/ahmadmustafaanis",
    "followers_url": "https://api.github.com/users/ahmadmustafaanis/followers",
    "following_url": "https://api.github.com/users/ahmadmustafaanis/following{/other_user}",
    "gists_url": "https://api.github.com/users/ahmadmustafaanis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ahmadmustafaanis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ahmadmustafaanis/subscriptions",
    "organizations_url": "https://api.github.com/users/ahmadmustafaanis/orgs",
    "repos_url": "https://api.github.com/users/ahmadmustafaanis/repos",
    "events_url": "https://api.github.com/users/ahmadmustafaanis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ahmadmustafaanis/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-04-24T11:51:20Z",
  "updated_at": "2021-04-26T09:38:21Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Model:\r\n```\r\n#Initializing the LSTM\r\nlstm_model = Sequential()\r\n\r\n#Adding the first LSTM layer and some dropout regularization\r\nlstm_model.add(LSTM(units = 50, return_sequences = True, input_dim=X_train_lstm.shape[2]))\r\nlstm_model.add(Dropout(0.2))\r\n\r\n#Adding second LSTM layer and some dropout regularization\r\nlstm_model.add(LSTM(units = 50, return_sequences = True))\r\nlstm_model.add(Dropout(0.2))\r\n\r\n#Adding third LSTM layer and some dropout regularisation\r\nlstm_model.add(LSTM(units = 50, return_sequences = True))\r\nlstm_model.add(Dropout(0.2))\r\n\r\n#Adding fourth LSTM layer and dropout regularisation\r\nlstm_model.add(LSTM(units = 50))\r\nlstm_model.add(Dropout(0.2))\r\n\r\n#Adding the output layer\r\nlstm_model.add(Dense(units = df.Label.nunique(), activation=\"softmax\"))\r\n\r\n#compiling the RNN\r\nlstm_model.compile(optimizer=\"Adam\", loss=\"categorical_crossentropy\", metrics=['accuracy', 'mse', 'mae'])\r\nlstm_model.summary()\r\n```\r\n\r\nShap Code:\r\n```\r\n!pip install deeplift==0.6.10.0\r\n!pip install shap==0.35.0\r\n\r\nfrom importlib import reload\r\nimport shap\r\nimport shap.explainers.deep.deep_tf\r\nreload(shap.explainers.deep.deep_tf)\r\nreload(shap.explainers.deep)\r\nreload(shap.explainers)\r\nreload(shap)\r\n\r\nseqs_to_explain = X_test_lstm[1:5]\r\ndinuc_shuff_explainer = shap.DeepExplainer((lstm_model.input, lstm_model.output), X_train_lstm[1:100])\r\n```\r\nError Message:\r\n```\r\nNameError                                 Traceback (most recent call last)\r\n<ipython-input-29-a2c0476b8ab2> in <module>()\r\n      1 seqs_to_explain = X_test_lstm[1:5]\r\n----> 2 dinuc_shuff_explainer = shap.DeepExplainer((lstm_model.input, lstm_model.output), X_train_lstm[1:100])\r\n\r\n1 frames\r\n/usr/local/lib/python3.7/dist-packages/shap/explainers/deep/__init__.py in __init__(self, model, data, session, learning_phase_flags)\r\n     78 \r\n     79         if framework == 'tensorflow':\r\n---> 80             self.explainer = TFDeepExplainer(model, data, session, learning_phase_flags)\r\n     81         elif framework == 'pytorch':\r\n     82             self.explainer = PyTorchDeepExplainer(model, data)\r\n\r\n/usr/local/lib/python3.7/dist-packages/shap/explainers/deep/deep_tf.py in __init__(self, model, data, session, learning_phase_flags)\r\n    105             if type(model) is tuple or type(model) is list:\r\n    106                 assert len(model) == 2, \"When a tuple is passed it must be of the form (inputs, outputs)\"\r\n--> 107                 self.model = Model(model[0], model[1])\r\n    108             else:\r\n    109                 self.model = model\r\n\r\nNameError: name 'Model' is not defined\r\n```\r\nI think in line 107 it should be `self.model = model(model[0],model[1])` instead of `Model(model[0],model[1])` Anyways, I don't know why or what is the error. \r\n\r\nI would definitely say that shap is very very difficult to use with Tensorflow 2+ versions.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1958/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1958/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
