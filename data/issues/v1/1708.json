{
  "url": "https://api.github.com/repos/shap/shap/issues/1708",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1708/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1708/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1708/events",
  "html_url": "https://github.com/shap/shap/issues/1708",
  "id": 777313136,
  "node_id": "MDU6SXNzdWU3NzczMTMxMzY=",
  "number": 1708,
  "title": "Please help me solve this error with using SHAP and KernelExplainer for a 1D CNN",
  "user": {
    "login": "jayrmh",
    "id": 21084286,
    "node_id": "MDQ6VXNlcjIxMDg0Mjg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/21084286?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jayrmh",
    "html_url": "https://github.com/jayrmh",
    "followers_url": "https://api.github.com/users/jayrmh/followers",
    "following_url": "https://api.github.com/users/jayrmh/following{/other_user}",
    "gists_url": "https://api.github.com/users/jayrmh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jayrmh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jayrmh/subscriptions",
    "organizations_url": "https://api.github.com/users/jayrmh/orgs",
    "repos_url": "https://api.github.com/users/jayrmh/repos",
    "events_url": "https://api.github.com/users/jayrmh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jayrmh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-01-01T16:38:05Z",
  "updated_at": "2021-01-01T16:46:16Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hey guys, so I've run the demos using iris dataset, and imbd to get familiar with the various functions. However, I'm getting the following error, when it comes to using the SHAP values on my own data set. \r\n\r\n`Provided model function fails when applied to the provided data set.`\r\n`ValueError: Input 0 of layer sequential is incompatible with the layer: : expected min_ndim=3, found ndim=2. Full shape received: [None, 13]`\r\n\r\n\r\nThis is my neural network. \r\nMy dataset dimensions are 2020 x 13 (2020 training samples, and 13 features). \r\nx_train is a numpy float type. \r\n\r\n`model = keras.models.Sequential()`\r\n\r\n       model.add(keras.layers.Conv1D(256, 5, padding='same', input_shape=x_train[0].shape, activation='relu', kernel_constraint=keras.constraints.max_norm(3)))\r\n\r\n        model.add(keras.layers.Activation('relu'))\r\n\r\n        model.add(keras.layers.MaxPool1D(pool_size=2))\r\n\r\n        model.add(keras.layers.BatchNormalization())\r\n\r\n        model.add(keras.layers.Dropout(0.1))\r\n\r\n        model.add(keras.layers.Dense(32, activation = 'relu'))\r\n\r\n        model.add(keras.layers.Flatten())\r\n\r\n        model.add(keras.layers.Dense(4, activation = 'softmax'))`\r\n\r\n`model.compile(optimizer='adam', loss= 'sparse_categorical_crossentropy', metrics = ['accuracy'])\r\nneural_network = model.fit(x_train, y_train, epochs=150, batch_size=32, validation_data=(x_test, y_test), verbose=0)`\r\n\r\nThis is how I am calling the SHAP library. \r\n` shap.initjs()`\r\n   `explainer = shap.KernelExplainer(model.predict_proba, x_train_shap)`\r\n  ` shap_values = explainer.shap_values(x_test_shap.iloc[0,:])`\r\n   `shap.force_plot(explainer.expected_value[0], shap_values[0], x_test_shap.iloc[0,:],  matplotlib=True)`\r\n\r\n\r\nThings I have tried\r\n* Changing the numpy inputs to a Pandas dataframe before putting it into the KernelExplainer\r\n* Using DeepExplainer\r\n* Messing around the shapes of the inputs of the model to (2020, 13).\r\n* Using model.predict instead of predict_proba\r\n* Using only x_train_shap[:100] samples as background\r\n\r\nThe predicted label is the 14th column, and is categorical of 0, 1, 2, 3\r\n\r\nAny help appreciated!!! Thank you!",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1708/reactions",
    "total_count": 2,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 2,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1708/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
