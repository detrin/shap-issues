{
  "url": "https://api.github.com/repos/shap/shap/issues/2156",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2156/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2156/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2156/events",
  "html_url": "https://github.com/shap/shap/issues/2156",
  "id": 981891109,
  "node_id": "MDU6SXNzdWU5ODE4OTExMDk=",
  "number": 2156,
  "title": "Inconsistent procedure to generate beeswarm plot",
  "user": {
    "login": "kevkid",
    "id": 1369930,
    "node_id": "MDQ6VXNlcjEzNjk5MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1369930?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kevkid",
    "html_url": "https://github.com/kevkid",
    "followers_url": "https://api.github.com/users/kevkid/followers",
    "following_url": "https://api.github.com/users/kevkid/following{/other_user}",
    "gists_url": "https://api.github.com/users/kevkid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kevkid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kevkid/subscriptions",
    "organizations_url": "https://api.github.com/users/kevkid/orgs",
    "repos_url": "https://api.github.com/users/kevkid/repos",
    "events_url": "https://api.github.com/users/kevkid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kevkid/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-08-28T17:45:58Z",
  "updated_at": "2021-08-28T18:38:42Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi, I am curious as to how I can generate the beeswarm plot. Here is what my model looks like:\r\n\r\n```\r\nclass Net(nn.Module):\r\n    def __init__(self):\r\n        super(Net, self).__init__()\r\n        self.dropout = nn.Dropout(p=0.3)\r\n        self.bn1 = nn.BatchNorm1d(5)\r\n        self.bn2 = nn.BatchNorm1d(50)\r\n        self.bn3 = nn.BatchNorm1d(10)\r\n        \r\n        self.fc1 = nn.Linear(in_dim, 5)\r\n        self.fc2 = nn.Linear(26, 5)\r\n        self.fc3 = nn.Linear(50, 10)\r\n        self.fc4 = nn.Linear(5, 2)\r\n\r\n    def forward(self, x):# If we have a second input (categorical) then we use it\r\n        x = self.dropout(F.elu(self.fc1(x)))\r\n        #x = self.dropout(F.elu(self.fc2(x)))\r\n        #x = F.elu(self.fc3(x))\r\n        x = self.fc4(x)\r\n        return x\r\n```\r\n\r\nHere is how I am using shap:\r\nbackground = torch.from_numpy(X_train.iloc[np.random.choice(np.arange(len(X_train)), 100, replace=False)].values.astype('float32'))\r\nexplainer = shap.DeepExplainer(net, background)\r\n\r\nIf I follow along with the documentation I get: \r\n```\r\nexplainer(torch.from_numpy(X_test[:100].values.astype('float32')))\r\n---------------------------------------------------------------------------\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-113-ec7f4b00a1d6> in <module>\r\n----> 1 explainer(torch.from_numpy(X_test[:100].values.astype('float32')))\r\n\r\n/conda_envs/opioid_phenotypes/lib/python3.9/site-packages/shap/explainers/_explainer.py in __call__(self, max_evals, main_effects, error_bounds, batch_size, outputs, silent, *args, **kwargs)\r\n    203         #     self._brute_force_fallback\r\n    204 \r\n--> 205         if issubclass(type(self.masker), maskers.OutputComposite) and len(args)==2:\r\n    206             self.masker.model = models.TextGeneration(target_sentences=args[1])\r\n    207             args = args[:1]\r\n\r\nAttributeError: 'Deep' object has no attribute 'masker'\r\n```\r\nBut If I do this:\r\n```\r\nshap_values = explainer.shap_values(torch.from_numpy(X_test[:100].values.astype('float32')))\r\nshap.summary_plot(shap_values)\r\n```\r\nI get a shap plot:\r\n![image](https://user-images.githubusercontent.com/1369930/131226305-ed8a0bc3-a378-4a11-975d-da5bc7b850c8.png)\r\nFurthermore I can get a beeswarm plot by doing:\r\n`shap.summary_plot(shap_values[0])`\r\n![image](https://user-images.githubusercontent.com/1369930/131226334-d9988328-7310-4215-8ee9-92eb3f7057bf.png)\r\n\r\n\r\nI have 2 questions:\r\n\r\n1. Why do I get an error when trying to generate a shap object?\r\n2. ~~Why do I get a bar plot when using the entire shap array yet when I subset it to the 0th sub-array I get a beeswarm plot?~~ Looks like what is happening here is because my NN has 2 outputs (0 and 1, where 1 is the positive class, same as the single output of nn with 1 output)\r\n\r\nThis is very confusing to newcomers and furthermore the documentation really isn't clear.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2156/reactions",
    "total_count": 6,
    "+1": 6,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2156/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
