{
  "url": "https://api.github.com/repos/shap/shap/issues/1305",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1305/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1305/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1305/events",
  "html_url": "https://github.com/shap/shap/issues/1305",
  "id": 654116041,
  "node_id": "MDU6SXNzdWU2NTQxMTYwNDE=",
  "number": 1305,
  "title": "Cant produce dependece plots for CatBoost model with categorical data",
  "user": {
    "login": "pplonski",
    "id": 6959032,
    "node_id": "MDQ6VXNlcjY5NTkwMzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6959032?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pplonski",
    "html_url": "https://github.com/pplonski",
    "followers_url": "https://api.github.com/users/pplonski/followers",
    "following_url": "https://api.github.com/users/pplonski/following{/other_user}",
    "gists_url": "https://api.github.com/users/pplonski/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pplonski/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pplonski/subscriptions",
    "organizations_url": "https://api.github.com/users/pplonski/orgs",
    "repos_url": "https://api.github.com/users/pplonski/repos",
    "events_url": "https://api.github.com/users/pplonski/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pplonski/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-07-09T14:41:41Z",
  "updated_at": "2020-07-09T14:42:57Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I've trained CatBoost on Income Adult UCI data set. It has several categoricals. I leave categorical unconverted, because CatBoost do the job. When trying to create a dependence plot I got the error:\r\n\r\n```py\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-100-c416e23e6fdd> in <module>\r\n----> 1 shap.dependence_plot(\"workclass\", shap_values, X_test, interaction_index=None)\r\n\r\n~/sandbox/mljar-examples/Income_classification/venv4/lib/python3.7/site-packages/shap/plots/dependence.py in dependence_plot(ind, shap_values, features, feature_names, display_features, interaction_index, color, axis_color, cmap, dot_size, x_jitter, alpha, title, xmin, xmax, ax, show)\r\n    154     oinds = np.arange(shap_values.shape[0]) # we randomize the ordering so plotting overlaps are not related to data ordering\r\n    155     np.random.shuffle(oinds)\r\n--> 156     xv = features[oinds, ind].astype(np.float64)\r\n    157     xd = display_features[oinds, ind]\r\n    158     s = shap_values[oinds, ind]\r\n\r\nValueError: could not convert string to float: 'Private'\r\n```\r\n\r\nCatBoost version: 0.23.1\r\nshap version 0.35.0\r\n\r\nThe error is only for categorical features, for numerical features plots are produced.\r\n\r\nThe code to reproduce:\r\n\r\n```py\r\nimport numpy as np\r\nimport pandas as pd\r\nimport catboost\r\nimport shap\r\nfrom sklearn.model_selection import train_test_split\r\n\r\ndf = pd.read_csv(\r\n    \"https://raw.githubusercontent.com/pplonski/datasets-for-start/master/adult/data.csv\",\r\n    skipinitialspace=True,\r\n)\r\n\r\nX = df[df.columns[:-1]]\r\ny = df[\"income\"]\r\n\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, shuffle=True, stratify=y, random_state=1)\r\n# fill missing values\r\nX_train = X_train.fillna(X_train.mode().iloc[0])\r\nX_test = X_test.fillna(X_train.mode().iloc[0])\r\n\r\nmodel = catboost.CatBoostClassifier(verbose=False)\r\nmodel.fit(X_train, y_train, cat_features=['workclass', 'education', \r\n       'marital-status', 'occupation', 'relationship', 'race', 'sex',\r\n       'native-country'])\r\n\r\n# SHAP\r\nexplainer = shap.TreeExplainer(model)\r\nshap_values = explainer.shap_values(X_test)\r\n\r\n# works on numerical feature\r\nshap.dependence_plot(\"age\", shap_values, X_test, interaction_index=None)\r\n\r\n# procudes the error\r\nshap.dependence_plot(\"workclass\", shap_values, X_test, interaction_index=None)\r\n\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1305/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1305/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
