{
  "url": "https://api.github.com/repos/shap/shap/issues/1863",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1863/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1863/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1863/events",
  "html_url": "https://github.com/shap/shap/issues/1863",
  "id": 823886709,
  "node_id": "MDU6SXNzdWU4MjM4ODY3MDk=",
  "number": 1863,
  "title": "Additivity check failed ,TreeExplainer varying difference with different amount of data ",
  "user": {
    "login": "harsh-miv",
    "id": 73358775,
    "node_id": "MDQ6VXNlcjczMzU4Nzc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/73358775?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/harsh-miv",
    "html_url": "https://github.com/harsh-miv",
    "followers_url": "https://api.github.com/users/harsh-miv/followers",
    "following_url": "https://api.github.com/users/harsh-miv/following{/other_user}",
    "gists_url": "https://api.github.com/users/harsh-miv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/harsh-miv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/harsh-miv/subscriptions",
    "organizations_url": "https://api.github.com/users/harsh-miv/orgs",
    "repos_url": "https://api.github.com/users/harsh-miv/repos",
    "events_url": "https://api.github.com/users/harsh-miv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/harsh-miv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-03-07T10:47:57Z",
  "updated_at": "2021-03-07T11:05:37Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am using an LGBMClassifier in a Kaggle kernel, using the whole data was taking a lot of time so I was using a stratified fold a s sample for shap\r\n\r\nx_valid=train_data[train_data['kfold']==0].drop(['id','kfold','target'],axis=1)\r\ny_valid=train_data[train_data['kfold']==0]['target']\r\n    \r\nmodel_lgb=lgb.LGBMClassifier(random_state=SEED,n_estimators=1000)\r\nmodel_lgb.fit(x_valid,y_valid,early_stopping_rounds=200,eval_set=[(x_valid,y_valid)],verbose=False)\r\n\r\nexplainer=shap.Explainer(model_lgb,x_valid)\r\nshap_values_lgb=explainer(x_valid) \r\n\r\nException: Additivity check failed in TreeExplainer! Please ensure the data matrix you passed to the explainer is the same shape that the model was trained on. If your data shape is correct then please report this on GitHub. This check failed because for one of the samples the sum of the SHAP values was -5.450916, while the model output was -5.674141. If this difference is acceptable you can set check_additivity=False to disable this check.\r\n\r\nfor a larger sample of data, the difference in sum and model output increases\r\n\r\ntill what difference using check_additivity=False will yield proper results ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1863/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1863/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
