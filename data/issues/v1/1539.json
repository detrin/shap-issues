{
  "url": "https://api.github.com/repos/shap/shap/issues/1539",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1539/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1539/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1539/events",
  "html_url": "https://github.com/shap/shap/issues/1539",
  "id": 726023285,
  "node_id": "MDU6SXNzdWU3MjYwMjMyODU=",
  "number": 1539,
  "title": "TreeExplainer breaks for large XGB models",
  "user": {
    "login": "sparshgupta8130",
    "id": 25448178,
    "node_id": "MDQ6VXNlcjI1NDQ4MTc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/25448178?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sparshgupta8130",
    "html_url": "https://github.com/sparshgupta8130",
    "followers_url": "https://api.github.com/users/sparshgupta8130/followers",
    "following_url": "https://api.github.com/users/sparshgupta8130/following{/other_user}",
    "gists_url": "https://api.github.com/users/sparshgupta8130/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sparshgupta8130/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sparshgupta8130/subscriptions",
    "organizations_url": "https://api.github.com/users/sparshgupta8130/orgs",
    "repos_url": "https://api.github.com/users/sparshgupta8130/repos",
    "events_url": "https://api.github.com/users/sparshgupta8130/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sparshgupta8130/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-10-20T23:57:03Z",
  "updated_at": "2020-10-21T00:03:03Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have an XGBoost model (~70MB in size when saved as pickle) with 20 estimators and max_depth 100. This is the `xgboost.XGBClassifier` model. When I try to run `shap_values` from `TreeExplainer` for this model, it gives me the following error:\r\n\r\n`Exception: Additivity check failed in TreeExplainer! Please ensure the data matrix you passed to the explainer is the sameshape that the model was trained on. If your data shape is correct then please report this on GitHub. Consider retrying with the feature_perturbation='interventional' option. This check failed because for one of the samples the sum of the SHAP values was 60682497708523520.000000, while the model output was -1.346103. If this difference is acceptable you can set check_additivity=False to disable this check.`\r\n\r\nEven when I add `feature_perturbation='interventional'` argument while initializing `TreeExplainer` object following this error message, it breaks.\r\n\r\nBut when I switched to another XGB model, trained using the exact same code, but max_depth set to 20 instead of 100, it works perfectly with `TreeExplainer`.\r\n\r\nCan you please help me figure out what could be the issue? Data matrix size is exactly the same as used for training, since I am running `predict_proba` using the same featurized matrix and it works ok. Plus I printed the size and verified that the matrix sizes are the same.\r\n\r\nApologies for the poorly formatted error message here, I couldn't figure out how to wrap text correctly here.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1539/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1539/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
