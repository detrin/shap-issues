{
  "url": "https://api.github.com/repos/shap/shap/issues/3206",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/3206/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/3206/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/3206/events",
  "html_url": "https://github.com/shap/shap/issues/3206",
  "id": 1860138342,
  "node_id": "I_kwDOBHDcK85u33Vm",
  "number": 3206,
  "title": "Partial Dependence Plots doesn’t work with custom ax",
  "user": {
    "login": "sergiocalde94",
    "id": 22750693,
    "node_id": "MDQ6VXNlcjIyNzUwNjkz",
    "avatar_url": "https://avatars.githubusercontent.com/u/22750693?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sergiocalde94",
    "html_url": "https://github.com/sergiocalde94",
    "followers_url": "https://api.github.com/users/sergiocalde94/followers",
    "following_url": "https://api.github.com/users/sergiocalde94/following{/other_user}",
    "gists_url": "https://api.github.com/users/sergiocalde94/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sergiocalde94/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sergiocalde94/subscriptions",
    "organizations_url": "https://api.github.com/users/sergiocalde94/orgs",
    "repos_url": "https://api.github.com/users/sergiocalde94/repos",
    "events_url": "https://api.github.com/users/sergiocalde94/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sergiocalde94/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 486901329,
      "node_id": "MDU6TGFiZWw0ODY5MDEzMjk=",
      "url": "https://api.github.com/repos/shap/shap/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Indicates an unexpected problem or unintended behaviour"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/shap/shap/milestones/6",
    "html_url": "https://github.com/shap/shap/milestone/6",
    "labels_url": "https://api.github.com/repos/shap/shap/milestones/6/labels",
    "id": 9842090,
    "node_id": "MI_kwDOBHDcK84Ali2q",
    "number": 6,
    "title": "0.44.0",
    "description": null,
    "creator": {
      "login": "thatlittleboy",
      "id": 30731072,
      "node_id": "MDQ6VXNlcjMwNzMxMDcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thatlittleboy",
      "html_url": "https://github.com/thatlittleboy",
      "followers_url": "https://api.github.com/users/thatlittleboy/followers",
      "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
      "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
      "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
      "repos_url": "https://api.github.com/users/thatlittleboy/repos",
      "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 4,
    "closed_issues": 0,
    "state": "open",
    "created_at": "2023-08-26T04:30:20Z",
    "updated_at": "2023-08-26T05:27:29Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 2,
  "created_at": "2023-08-21T20:57:21Z",
  "updated_at": "2023-08-26T04:30:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Issue Description\n\nHi! This issue is the same as [this](https://stackoverflow.com/questions/74381596/shap-partial-dependence-subplots-issue) stack Overflow question.\r\n\r\nI want to plot different feature pdp in different axes but doing like this it doesn’t work as expected. Only the first feature is plotted but in the last ax. The rest are like overlapping the first.\n\n### Minimal Reproducible Example\n\n```python\nimport shap\r\nimport lightgbm as lgbm\r\nimport matplotlib.pyplot as plt\r\nimport pandas as pd\r\n\r\n# Load the \"adult\" dataset from shap\r\nX, y = shap.datasets.adult()\r\nfeatures = X.columns\r\n\r\n# Split into training and testing sets\r\ndf = pd.concat([X, pd.Series(y, name='y_test')], axis=1)\r\n\r\n# Your code snippet\r\nX = df.loc[:, features]\r\nX = X.fillna(X.median())\r\ny_test = df.loc[:, 'y_test'].values\r\nmodel = lgbm.LGBMRegressor()\r\nmodel.fit(X, y_test)\r\nexplainer = shap.TreeExplainer(model)\r\nshap_values = explainer.shap_values(X)\r\n\r\nfig, axes = plt.subplots(nrows=3, ncols=3, figsize=(16, 16))\r\naxes_dic = {\r\n    0: axes[0, 0],\r\n    1: axes[0, 1],\r\n    2: axes[0, 2],\r\n    3: axes[1, 0],\r\n    4: axes[1, 1],\r\n    5: axes[1, 2],\r\n    6: axes[2, 0],\r\n    7: axes[2, 1],\r\n    8: axes[2, 2]\r\n}\r\nfig, axes = plt.subplots(nrows=3, ncols=3, figsize=(16, 16))\r\nfig.suptitle('Partial Dependence SHAP plots', fontsize=20)\r\nfor i in range(min(len(axes_dic), len(features))):\r\n   shap.partial_dependence_plot(\r\n       features[i], model.predict, X, model_expected_value=True,\r\n       feature_expected_value=True, ice=False, show=False, ax=axes_dic[i]\r\n   )\r\nplt.tight_layout()\r\nplt.show()\n```\n\n\n### Traceback\n\n_No response_\n\n### Expected Behavior\n\n_No response_\n\n### Bug report checklist\n\n- [X] I have checked that this issue has not already been reported.\n- [X] I have confirmed this bug exists on the [latest release](https://github.com/shap/shap/releases) of shap.\n- [X] I have confirmed this bug exists on the [master branch](https://github.com/shap/shap/blob/master/CONTRIBUTING.md#installing-from-the-master-branch) of shap.\n- [ ] I'd be interested in making a PR to fix this bug\n\n### Installed Versions\n\n0.42.0",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/3206/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/3206/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
