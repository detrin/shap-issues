{
  "url": "https://api.github.com/repos/shap/shap/issues/1049",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1049/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1049/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1049/events",
  "html_url": "https://github.com/shap/shap/issues/1049",
  "id": 566134131,
  "node_id": "MDU6SXNzdWU1NjYxMzQxMzE=",
  "number": 1049,
  "title": "Loosing timezone info on dataframe creation with keep_index=True and with KernelExplainer",
  "user": {
    "login": "mathPi",
    "id": 37483265,
    "node_id": "MDQ6VXNlcjM3NDgzMjY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/37483265?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mathPi",
    "html_url": "https://github.com/mathPi",
    "followers_url": "https://api.github.com/users/mathPi/followers",
    "following_url": "https://api.github.com/users/mathPi/following{/other_user}",
    "gists_url": "https://api.github.com/users/mathPi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mathPi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mathPi/subscriptions",
    "organizations_url": "https://api.github.com/users/mathPi/orgs",
    "repos_url": "https://api.github.com/users/mathPi/repos",
    "events_url": "https://api.github.com/users/mathPi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mathPi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-02-17T08:27:47Z",
  "updated_at": "2020-02-17T10:07:12Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\nI'm having an issue with the KernelExplainer. I have a model that I want to explain which needs as input a dataframe indexed by time and this time must contains the timezone.\r\nIn order to be able to use a dataframe, I uses the option keep_index=True.\r\nBut the dataframe given as input of my model contains dates as index but without timezones.\r\n\r\nI looked the code and found that it can be from this line in KernelExplainer's shap_values method:\r\n`index_value = X.index.values`\r\n\r\nIn fact, numpy doesn't keep the timezone in its datetime structure so by doing this conversion, we are loosing the timezones.\r\n\r\nIf you agree with me that it is an issue and that it has to be fixed, I can propose a pull request fixing it.\r\n\r\nSteps to reproduce:\r\n\r\n```\r\nimport pandas as pd\r\nimport numpy as np\r\nfrom datetime import timezone\r\nimport shap\r\n\r\nnum_samples = 100\r\ndates = pd.date_range(\r\n  start=pd.datetime.now(),\r\n  end=pd.datetime.now() + timedelta(hours=self.num_samples - 1),\r\n  freq=\"H\",\r\n  tz=timezone.utc\r\n)\r\nX = pd.DataFrame(np.random.rand(self.num_samples, 3), index=dates, columns=[42, 43, 44])\r\n\r\ndef f(X: pd.DataFrame) -> None:\r\n  assert X.index[0].tzinfo == timezone.utc\r\n\r\nexplainer = shap.KernelExplainer(f, X, keep_index=True, keep_index_ordered=True)\r\nexplainer.shap_values(X)\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1049/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1049/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
