{
  "url": "https://api.github.com/repos/shap/shap/issues/960",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/960/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/960/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/960/events",
  "html_url": "https://github.com/shap/shap/issues/960",
  "id": 539071515,
  "node_id": "MDU6SXNzdWU1MzkwNzE1MTU=",
  "number": 960,
  "title": "Does SHAP give very high importance to outliers? ",
  "user": {
    "login": "pidahbus",
    "id": 44110256,
    "node_id": "MDQ6VXNlcjQ0MTEwMjU2",
    "avatar_url": "https://avatars.githubusercontent.com/u/44110256?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pidahbus",
    "html_url": "https://github.com/pidahbus",
    "followers_url": "https://api.github.com/users/pidahbus/followers",
    "following_url": "https://api.github.com/users/pidahbus/following{/other_user}",
    "gists_url": "https://api.github.com/users/pidahbus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pidahbus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pidahbus/subscriptions",
    "organizations_url": "https://api.github.com/users/pidahbus/orgs",
    "repos_url": "https://api.github.com/users/pidahbus/repos",
    "events_url": "https://api.github.com/users/pidahbus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pidahbus/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-12-17T13:38:07Z",
  "updated_at": "2020-03-23T08:28:30Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi @slundberg , I have some confusion while calculating the SHAP values to calculate feature importance. You have already mentioned that for linear regression the SHAP value equation is, \r\n\r\n`shap_values = regression_coefficients *  (X - X.mean(0)) `\r\n\r\nSeeing that equation I find that the feature importance of a data point is directly proportional to the absolute value of that feature for the data point. This means if there is any outlier (assuming very large value in X) with respect to any feature then that feature may get important most of the time because of its large X value. \r\n\r\nFor example, we have a fitted regression line:  **y_hat = b0 + b1 * x1 + b2 * x2**, where b0 =3, b1=0.08 and b2=0.9 gives, **y_hat = 3 + 0.08 * x1 + 0.9 x2**\r\nNow let's say we have one data point where x1 = 900 and x2 = 5 for which I want to calculate the SHAP values,\r\nHere we see that in spite of the b1 having a very less value, feature 1 comes most important because of the very large value of x1 and also in spite of b2 having very large value, feature 2 comes less important with respect to feature 1 because of it's less absolute value for that data point.\r\n\r\nTo describe the issue, I have compared the case with both SHAP and LIME. \r\n\r\n- The result of SHAP and LIME is given for the test point below.\r\n<img width=\"956\" alt=\"Screenshot 2019-12-17 at 5 09 26 PM\" src=\"https://user-images.githubusercontent.com/44110256/70995491-ab86c000-20f6-11ea-956a-b2d8a5e94a0e.png\">\r\n\r\n- Now I have introduced one outlier value in the test point replacing `Capital Loss` from 0 to 20,000 (some arbitrary large number). Doing so, I found that because of the large value of `Capital Loss`, it becomes the most important variable for SHAP as it considers the absolute value of the feature. But, LIME calculates the feature importances by the regression coefficients  that is the reason this outlier did not affect much but the overall result changes because of the new values of the regression coefficients because of the introduction of the outlier. \r\n**Is my thought process correct? If yes, is it a good measure to consider the absolute value of a feature to calculate it's feature importance? If not then it would be really helpful if you would help me describing the difference between these two results.** \r\n\r\n<img width=\"964\" alt=\"Screenshot 2019-12-17 at 5 09 40 PM\" src=\"https://user-images.githubusercontent.com/44110256/70995945-bd1c9780-20f7-11ea-93bf-a7d9da5d6bd5.png\">\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/960/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/960/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
