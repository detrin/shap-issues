{
  "url": "https://api.github.com/repos/shap/shap/issues/1803",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1803/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1803/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1803/events",
  "html_url": "https://github.com/shap/shap/issues/1803",
  "id": 802364984,
  "node_id": "MDU6SXNzdWU4MDIzNjQ5ODQ=",
  "number": 1803,
  "title": "Additivity check fails for imblearn BalancedRandomForestClassifier",
  "user": {
    "login": "mirko-m",
    "id": 38224237,
    "node_id": "MDQ6VXNlcjM4MjI0MjM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/38224237?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mirko-m",
    "html_url": "https://github.com/mirko-m",
    "followers_url": "https://api.github.com/users/mirko-m/followers",
    "following_url": "https://api.github.com/users/mirko-m/following{/other_user}",
    "gists_url": "https://api.github.com/users/mirko-m/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mirko-m/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mirko-m/subscriptions",
    "organizations_url": "https://api.github.com/users/mirko-m/orgs",
    "repos_url": "https://api.github.com/users/mirko-m/repos",
    "events_url": "https://api.github.com/users/mirko-m/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mirko-m/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-02-05T18:00:55Z",
  "updated_at": "2021-02-05T18:00:55Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am having issues getting shap values for an imblearn BalancedRandomForestClassifier . Below is a minimal example that gives an exception\r\n\r\n```\r\nimport numpy as np\r\nimport sklearn\r\nimport shap\r\nimport imblearn.datasets\r\nfrom imblearn.ensemble import BalancedRandomForestClassifier\r\n\r\ndata = imblearn.datasets.fetch_datasets()\r\nX = data['oil']['data']\r\ny = data['oil']['target']\r\n# y[y==-1] = 0 # does not make a difference\r\nmodel = BalancedRandomForestClassifier(**{'n_estimators': 250,\r\n                                             'max_features': 'sqrt',\r\n                                             'criterion': 'entropy',\r\n                                             'bootstrap': True})\r\nmodel.fit(X, y)\r\nexplainer = shap.TreeExplainer(model, X, nsamples=1002)\r\nshap_values = explainer.shap_values(X)\r\n```\r\n\r\nThe exception I get is\r\n```\r\nException: Additivity check failed in TreeExplainer! Please ensure the data matrix you passed to the explainer is the same shape that the model was trained on. If your data shape is correct then please report this on GitHub. This check failed because for one of the samples the sum of the SHAP values was 0.811720, while the model output was 0.824000. If this difference is acceptable you can set check_additivity=False to disable this check.\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1803/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1803/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
