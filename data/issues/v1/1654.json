{
  "url": "https://api.github.com/repos/shap/shap/issues/1654",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1654/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1654/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1654/events",
  "html_url": "https://github.com/shap/shap/issues/1654",
  "id": 766950319,
  "node_id": "MDU6SXNzdWU3NjY5NTAzMTk=",
  "number": 1654,
  "title": "Methods for combining one hot encoded columns",
  "user": {
    "login": "peterdhansen",
    "id": 19173854,
    "node_id": "MDQ6VXNlcjE5MTczODU0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19173854?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/peterdhansen",
    "html_url": "https://github.com/peterdhansen",
    "followers_url": "https://api.github.com/users/peterdhansen/followers",
    "following_url": "https://api.github.com/users/peterdhansen/following{/other_user}",
    "gists_url": "https://api.github.com/users/peterdhansen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/peterdhansen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/peterdhansen/subscriptions",
    "organizations_url": "https://api.github.com/users/peterdhansen/orgs",
    "repos_url": "https://api.github.com/users/peterdhansen/repos",
    "events_url": "https://api.github.com/users/peterdhansen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/peterdhansen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-12-14T21:35:48Z",
  "updated_at": "2021-07-26T19:31:19Z",
  "closed_at": "2021-07-26T19:31:19Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Sometimes I'm trying to use shap with a one-hot-encoded column which has many options (more than 100) but the addition of all the one hot encoded columns is easier to use in the explanation plots. \r\n\r\nhere is an example function that combines a group of one hot encoded columns into a single features in an Explanation object:\r\n```\r\n\r\ndef combine_one_hot(shap_values, name, mask):\r\n   \"\"\"  shap_values: an Explanation object\r\n         name: name of new feature\r\n         mask: bool array same lenght as features\r\n      \r\n        This function assumes that shap_values[:, mask] make up a one-hot-encoded feature\r\n   \"\"\"\r\n    sv = shap.Explanation(shap_values)\r\n    mask_col_names = np.array(shap_values.feature_names)[mask]\r\n    \r\n    new_data = mask_col_names[\r\n            (shap_values.data[:, mask]*np.arange(sum(mask))).sum(axis=1).astype(int)\r\n        ]\r\n    sv.data = np.concatenate([\r\n        shap_values.data[:, ~mask],\r\n        new_data.reshape(-1,1)\r\n    ], axis=1)\r\n    \r\n    new_values = shap_values.values[:, mask].sum(axis=1)\r\n    sv.values = np.concatenate([\r\n        shap_values.values[:, ~mask],\r\n        new_values.reshape(-1,1)\r\n    ], axis=1)\r\n    sv.feature_names = list(np.array(shap_values.feature_names)[~mask]) + [name]\r\n    print(sv.data.shape)\r\n    return sv\r\n\r\nsv = combine_shap(shap_values, 'County', X_test.columns.str.contains(\"County\"))\r\n```",
  "closed_by": {
    "login": "peterdhansen",
    "id": 19173854,
    "node_id": "MDQ6VXNlcjE5MTczODU0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19173854?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/peterdhansen",
    "html_url": "https://github.com/peterdhansen",
    "followers_url": "https://api.github.com/users/peterdhansen/followers",
    "following_url": "https://api.github.com/users/peterdhansen/following{/other_user}",
    "gists_url": "https://api.github.com/users/peterdhansen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/peterdhansen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/peterdhansen/subscriptions",
    "organizations_url": "https://api.github.com/users/peterdhansen/orgs",
    "repos_url": "https://api.github.com/users/peterdhansen/repos",
    "events_url": "https://api.github.com/users/peterdhansen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/peterdhansen/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1654/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1654/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
