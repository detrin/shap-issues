{
  "url": "https://api.github.com/repos/shap/shap/issues/2889",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2889/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2889/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2889/events",
  "html_url": "https://github.com/shap/shap/issues/2889",
  "id": 1648086567,
  "node_id": "I_kwDOBHDcK85iO84n",
  "number": 2889,
  "title": "shap.force_plot() > contribution_threshold not properly displaying negative contributing features",
  "user": {
    "login": "joshjacquet",
    "id": 22757146,
    "node_id": "MDQ6VXNlcjIyNzU3MTQ2",
    "avatar_url": "https://avatars.githubusercontent.com/u/22757146?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/joshjacquet",
    "html_url": "https://github.com/joshjacquet",
    "followers_url": "https://api.github.com/users/joshjacquet/followers",
    "following_url": "https://api.github.com/users/joshjacquet/following{/other_user}",
    "gists_url": "https://api.github.com/users/joshjacquet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/joshjacquet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joshjacquet/subscriptions",
    "organizations_url": "https://api.github.com/users/joshjacquet/orgs",
    "repos_url": "https://api.github.com/users/joshjacquet/repos",
    "events_url": "https://api.github.com/users/joshjacquet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/joshjacquet/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 486901329,
      "node_id": "MDU6TGFiZWw0ODY5MDEzMjk=",
      "url": "https://api.github.com/repos/shap/shap/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Indicates an unexpected problem or unintended behaviour"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "thatlittleboy",
    "id": 30731072,
    "node_id": "MDQ6VXNlcjMwNzMxMDcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thatlittleboy",
    "html_url": "https://github.com/thatlittleboy",
    "followers_url": "https://api.github.com/users/thatlittleboy/followers",
    "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
    "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
    "repos_url": "https://api.github.com/users/thatlittleboy/repos",
    "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "thatlittleboy",
      "id": 30731072,
      "node_id": "MDQ6VXNlcjMwNzMxMDcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thatlittleboy",
      "html_url": "https://github.com/thatlittleboy",
      "followers_url": "https://api.github.com/users/thatlittleboy/followers",
      "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
      "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
      "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
      "repos_url": "https://api.github.com/users/thatlittleboy/repos",
      "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/shap/shap/milestones/2",
    "html_url": "https://github.com/shap/shap/milestone/2",
    "labels_url": "https://api.github.com/repos/shap/shap/milestones/2/labels",
    "id": 9579906,
    "node_id": "MI_kwDOBHDcK84Aki2C",
    "number": 2,
    "title": "0.43.0",
    "description": "",
    "creator": {
      "login": "thatlittleboy",
      "id": 30731072,
      "node_id": "MDQ6VXNlcjMwNzMxMDcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30731072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thatlittleboy",
      "html_url": "https://github.com/thatlittleboy",
      "followers_url": "https://api.github.com/users/thatlittleboy/followers",
      "following_url": "https://api.github.com/users/thatlittleboy/following{/other_user}",
      "gists_url": "https://api.github.com/users/thatlittleboy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thatlittleboy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thatlittleboy/subscriptions",
      "organizations_url": "https://api.github.com/users/thatlittleboy/orgs",
      "repos_url": "https://api.github.com/users/thatlittleboy/repos",
      "events_url": "https://api.github.com/users/thatlittleboy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thatlittleboy/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 23,
    "state": "open",
    "created_at": "2023-06-25T10:11:50Z",
    "updated_at": "2023-08-26T14:27:48Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 1,
  "created_at": "2023-03-30T18:12:35Z",
  "updated_at": "2023-07-02T15:34:56Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### This is a fantastic package that is very useful for model explainability - thank you.\r\n\r\nA parameter in shap.force_plot() seems to behaving inconsistently with expectations - **any clarifiers/pointers if this is user error is greatly appreciated**.\r\n- I saw this was added in [PR 1584 ](https://github.com/slundberg/shap/commit/f9bcf8a9610dcd0716dde8270f1266c2a24bd394) by @shiva-z a while ago.\r\n- I didn't immediately see any other issues mentioning this.\r\n\r\nTo be clear, talking specifically when I'm generating a force plot using the following:\r\n`shap.force_plot(base_value, shap_values, contribution_threshold, matplotlib=True, show=False)`\r\n\r\n### **Expectation**:\r\n- `contribution_threshold` is some float between 0 & 1, where setting to 0 would show a label for **every** feature (including negative contributing features).\r\n- Setting above 0 will show **every** contribution in which absolute value / sum(absolute values) is greater than the threshold.\r\n\r\n### **Reality**:\r\n- Setting `contribution_threshold` arbitrarily low will show all matching **positive** contributors, but cut off at a random number of **negative** ones.\r\n- Anecdotally, the more features there are, the fewer negative ones show.\r\n### Python 3.9.5, Windows machine:\r\n```\r\nshap==0.41.0\r\nmatplotlib==3.6.3\r\nnumpy==1.23.5\r\n```\r\n\r\n### Reproducible example:\r\n```\r\nimport shap\r\nimport numpy as np\r\n\r\nbase_value= -5.96385670e+00\r\ncontributions=np.array(\r\n    [\r\n        2.62079178e-04,  1.03836309e-03, -4.80703916e-03,  3.47535330e-04,\r\n       -7.19331438e-03,  2.00609677e-03,  7.54139200e-02, -1.20536340e-02,\r\n       -3.57733807e-03,  2.56002939e-04,  5.51301939e-03, -4.02830541e-03,\r\n        1.91734266e-02,  1.76921394e-03,  3.41030653e-03,  3.97255382e-04,\r\n        8.85525224e-05, -2.79973671e-02,  3.44877085e-03, -1.18466816e-03,\r\n       -3.29642966e-02,  3.60896252e-06,  1.12464791e-03, -3.37032927e-03\r\n    ]\r\n)\r\n\r\nfor i in [0.05, 0.025, 0.01, 0]:\r\n\r\n    shap.force_plot(base_value=base_value,\r\n        shap_values=contributions, \r\n        contribution_threshold = i,\r\n        matplotlib = True, # use matplotlib\r\n        show = True\r\n    )\r\n```\r\n\r\n### Visually, note how in the `contribution_threshold=0` chart not all negative contributions are labeled.\r\n- `contribution_threshold=0`\r\n- Expected to see all labels.\r\n- Practically, I have a larger model/feature set where I can't even get two negative contributing features to show.\r\n![image](https://user-images.githubusercontent.com/22757146/228919698-52068a02-4e96-456b-bd54-b61700841950.png)\r\n\r\n\r\n## I appreciate anyone's time who gets to this & tags me back. Thank you!\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2889/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2889/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
