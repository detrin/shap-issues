{
  "url": "https://api.github.com/repos/shap/shap/issues/2778",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2778/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2778/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2778/events",
  "html_url": "https://github.com/shap/shap/issues/2778",
  "id": 1465309588,
  "node_id": "I_kwDOBHDcK85XVtmU",
  "number": 2778,
  "title": "SHAP -Additivity check fails only in TreeExplainer",
  "user": {
    "login": "sotgot",
    "id": 119102979,
    "node_id": "U_kgDOBxleAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/119102979?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sotgot",
    "html_url": "https://github.com/sotgot",
    "followers_url": "https://api.github.com/users/sotgot/followers",
    "following_url": "https://api.github.com/users/sotgot/following{/other_user}",
    "gists_url": "https://api.github.com/users/sotgot/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sotgot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sotgot/subscriptions",
    "organizations_url": "https://api.github.com/users/sotgot/orgs",
    "repos_url": "https://api.github.com/users/sotgot/repos",
    "events_url": "https://api.github.com/users/sotgot/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sotgot/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-27T02:23:59Z",
  "updated_at": "2022-12-04T12:08:34Z",
  "closed_at": "2022-12-04T12:08:34Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have a problem with implementing SHAP.\r\nWhen I try random forest and TreeExplainer for SHAP in a specific dataset, I always get the same error:  Additivity check failed in TreeExplainer!\r\n\r\nI looked some discussion through and found it seems related to rounding error or the version difference, so I try `round()` for the data frame and update of SHAP, but they didn't work. Also, using fewer data for SHAP value which comes from [https://github.com/slundberg/shap/issues/941](url) seems to work at first, but it leads to getting vectors for instances, and failures in getting waterfall, feature importance, and so on.\r\n\r\nBut I can use logistic regression and LinearExplainer for shap with the same dataset(why it happens?).\r\n\r\nCould you give some comments about this problem?\r\n\r\nI use bankruptcy prediction data set from kaggle: \r\nhttps://www.kaggle.com/datasets/fedesoriano/company-bankruptcy-prediction\r\nand I use 20% undersampling\r\n\r\n```\r\ncode: \r\nexplainer = shap.TreeExplainer(\r\n    model=rf,  \r\n    data=X_test, \r\n    feature_perturbation=\"interventional\",  \r\n    masker=X_test\r\n)\r\n\r\nshap_values = explainer(X_test) \r\nshap_values[0]\r\n```\r\n\r\nthe error:\r\nExplainerError: Additivity check failed in TreeExplainer! Please ensure the data matrix you passed to the explainer is the same shape that the model was trained on. If your data shape is correct then please report this on GitHub. This check failed because for one of the samples the sum of the SHAP values was 0.929200, while the model output was 0.950000. If this difference is acceptable you can set check_additivity=False to disable this check.\r\n\r\n\r\n",
  "closed_by": {
    "login": "sotgot",
    "id": 119102979,
    "node_id": "U_kgDOBxleAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/119102979?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sotgot",
    "html_url": "https://github.com/sotgot",
    "followers_url": "https://api.github.com/users/sotgot/followers",
    "following_url": "https://api.github.com/users/sotgot/following{/other_user}",
    "gists_url": "https://api.github.com/users/sotgot/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sotgot/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sotgot/subscriptions",
    "organizations_url": "https://api.github.com/users/sotgot/orgs",
    "repos_url": "https://api.github.com/users/sotgot/repos",
    "events_url": "https://api.github.com/users/sotgot/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sotgot/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2778/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2778/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
