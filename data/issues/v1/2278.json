{
  "url": "https://api.github.com/repos/shap/shap/issues/2278",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/2278/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/2278/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/2278/events",
  "html_url": "https://github.com/shap/shap/issues/2278",
  "id": 1058933101,
  "node_id": "I_kwDOBHDcK84_Hglt",
  "number": 2278,
  "title": "Feature importance for pycaret lightgbm multi-class  model.",
  "user": {
    "login": "sorenwacker",
    "id": 3391614,
    "node_id": "MDQ6VXNlcjMzOTE2MTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3391614?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sorenwacker",
    "html_url": "https://github.com/sorenwacker",
    "followers_url": "https://api.github.com/users/sorenwacker/followers",
    "following_url": "https://api.github.com/users/sorenwacker/following{/other_user}",
    "gists_url": "https://api.github.com/users/sorenwacker/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sorenwacker/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sorenwacker/subscriptions",
    "organizations_url": "https://api.github.com/users/sorenwacker/orgs",
    "repos_url": "https://api.github.com/users/sorenwacker/repos",
    "events_url": "https://api.github.com/users/sorenwacker/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sorenwacker/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-11-19T21:32:28Z",
  "updated_at": "2023-01-04T17:29:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Using a multi-class model created with ``.\r\n\r\n```\r\nfrom pycaret.classification import *\r\nimport shap\r\nshap.initjs()\r\n\r\nexperiment = setup(df, 'AGE_GRP', silent=True,  session_id=42)\r\n\r\nmodel = create_model('lightgbm')\r\n\r\nX_train, X_test, y_train, y_test = get_config('X_train'), get_config('X_test'), get_config('y_train'), get_config('y_test')\r\n\r\nexplainer = shap.Explainer(model, X_test)\r\nshap_values = explainer(X_test)\r\n\r\n```\r\nI can calculate the shap_values but then \r\n\r\n```\r\n\r\nshap.plots.bar(shap_values, max_display=40, show=False)\r\ntitle('Most important genomic predictors of patient mortality')\r\n```\r\n\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n/tmp/ipykernel_4175983/2044458289.py in <module>\r\n----> 1 shap.plots.bar(shap_values, max_display=40, show=False)\r\n      2 title('Most important genomic predictors of patient mortality')\r\n\r\n/bulk/LSARP/envs/conda/pycaret/lib/python3.9/site-packages/shap/plots/_bar.py in bar(shap_values, max_display, order, clustering, clustering_cutoff, merge_cohorts, show_data, show)\r\n    169     # see how many individual (vs. grouped at the end) features we are plotting\r\n    170     if num_features < len(values[0]):\r\n--> 171         num_cut = np.sum([len(orig_inds[feature_order[i]]) for i in range(num_features-1, len(values[0]))])\r\n    172         values[:,feature_order[num_features-1]] = np.sum([values[:,feature_order[i]] for i in range(num_features-1, len(values[0]))], 0)\r\n    173 \r\n\r\n/bulk/LSARP/envs/conda/pycaret/lib/python3.9/site-packages/shap/plots/_bar.py in <listcomp>(.0)\r\n    169     # see how many individual (vs. grouped at the end) features we are plotting\r\n    170     if num_features < len(values[0]):\r\n--> 171         num_cut = np.sum([len(orig_inds[feature_order[i]]) for i in range(num_features-1, len(values[0]))])\r\n    172         values[:,feature_order[num_features-1]] = np.sum([values[:,feature_order[i]] for i in range(num_features-1, len(values[0]))], 0)\r\n    173 \r\n\r\nTypeError: only integer scalar arrays can be converted to a scalar index\r\n\r\n```\r\n\r\n\r\n\r\npycaret: 2.3.4\r\nshap: 0.40.0\r\n\r\n\r\nNot sure whether I should report this here or in the pycaret repo. As this is about the connection of the two packages. \r\n\r\nhttps://github.com/pycaret/pycaret/issues/1873",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/2278/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/2278/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
