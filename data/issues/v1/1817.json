{
  "url": "https://api.github.com/repos/shap/shap/issues/1817",
  "repository_url": "https://api.github.com/repos/shap/shap",
  "labels_url": "https://api.github.com/repos/shap/shap/issues/1817/labels{/name}",
  "comments_url": "https://api.github.com/repos/shap/shap/issues/1817/comments",
  "events_url": "https://api.github.com/repos/shap/shap/issues/1817/events",
  "html_url": "https://github.com/shap/shap/issues/1817",
  "id": 806538977,
  "node_id": "MDU6SXNzdWU4MDY1Mzg5Nzc=",
  "number": 1817,
  "title": "Raise exception early if data to explain does not match data the model was trained on",
  "user": {
    "login": "freddyaboulton",
    "id": 41651716,
    "node_id": "MDQ6VXNlcjQxNjUxNzE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/41651716?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/freddyaboulton",
    "html_url": "https://github.com/freddyaboulton",
    "followers_url": "https://api.github.com/users/freddyaboulton/followers",
    "following_url": "https://api.github.com/users/freddyaboulton/following{/other_user}",
    "gists_url": "https://api.github.com/users/freddyaboulton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/freddyaboulton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/freddyaboulton/subscriptions",
    "organizations_url": "https://api.github.com/users/freddyaboulton/orgs",
    "repos_url": "https://api.github.com/users/freddyaboulton/repos",
    "events_url": "https://api.github.com/users/freddyaboulton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/freddyaboulton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-02-11T16:17:35Z",
  "updated_at": "2021-02-11T16:19:52Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Repro with sklearn 0.24.1 and shap 0.38.1:\r\n```python\r\nimport numpy as np\r\nfrom sklearn.ensemble import RandomForestRegressor\r\nimport shap\r\n\r\nX, y = shap.datasets.diabetes()\r\nrf = RandomForestRegressor()\r\nrf.fit(X, y)\r\nexplainer = shap.TreeExplainer(rf)\r\nshap_values = explainer.shap_values(X.iloc[:2,:3])\r\n```\r\n\r\nThe code above sometimes raises a helpful exception saying that the data I passed in may not match the data the model was trained on but other times it crashes with:\r\n\r\n```\r\npython(2596,0x1117aedc0) malloc: Incorrect checksum for freed object 0x7fcdb25d3aa8: probably modified after being freed.\r\nCorrupt value: 0x400e784885675ad8\r\npython(2596,0x1117aedc0) malloc: *** set a breakpoint in malloc_error_break to debug\r\n```\r\n\r\nI think and exception saying that the data is not the expected shape should be raised before the shap values are computed instead of after. That way users get feedback early and we can avoid crashing with a mysterious and scary malloc error. \r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/shap/shap/issues/1817/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/shap/shap/issues/1817/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
